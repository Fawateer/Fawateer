<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام فواتير - نظام إدارة متكامل</title>
    
    <!-- الخطوط -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- مكتبات خارجية -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        /* متغيرات التصميم */
        :root {
            --primary: #8B5CF6;
            --primary-dark: #7C3AED;
            --primary-light: #A78BFA;
            --secondary: #10B981;
            --secondary-dark: #059669;
            --accent: #F59E0B;
            --danger: #EF4444;
            --danger-dark: #DC2626;
            --warning: #F59E0B;
            --success: #10B981;
            --dark-1: #0F172A;
            --dark-2: #1E293B;
            --dark-3: #334155;
            --light-1: #F8FAFC;
            --light-2: #E2E8F0;
            --glass: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.12);
            --shadow-3d: 0 20px 60px rgba(0, 0, 0, 0.4), 
                         0 0 0 1px rgba(255, 255, 255, 0.05),
                         inset 0 1px 0 rgba(255, 255, 255, 0.1);
            --shadow-float: 0 30px 80px rgba(139, 92, 246, 0.3);
            --radius-xl: 24px;
            --radius-lg: 20px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* تصميم عام */
        body {
            background: linear-gradient(135deg, var(--dark-1) 0%, #1a1a2e 100%);
            color: var(--light-1);
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        /* شاشة تسجيل الدخول */
        .login-container {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--dark-1) 0%, #1a1a2e 100%);
            z-index: 9999;
            transition: var(--transition-slow);
        }

        .login-container.hidden {
            opacity: 0;
            visibility: hidden;
            transform: translateY(-20px);
        }

        .login-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 48px 40px;
            width: 90%;
            max-width: 440px;
            transform-style: preserve-3d;
            transform: perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0);
            box-shadow: var(--shadow-3d);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0) translateY(0px); }
            50% { transform: perspective(1000px) rotateX(1deg) rotateY(-1deg) translateZ(20px) translateY(-10px); }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 40px;
            transform-style: preserve-3d;
        }

        .login-logo .logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transform: translateZ(30px);
            box-shadow: var(--shadow-float);
        }

        .login-logo .logo-icon svg {
            width: 40px;
            height: 40px;
            color: white;
        }

        .login-logo h1 {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-light) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transform: translateZ(20px);
        }

        .login-logo p {
            color: var(--light-2);
            font-size: 16px;
            margin-top: 8px;
            transform: translateZ(10px);
        }

        .form-group {
            margin-bottom: 24px;
            transform-style: preserve-3d;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--light-2);
            transform: translateZ(15px);
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-md);
            color: var(--light-1);
            font-size: 16px;
            transition: var(--transition);
            transform: translateZ(0);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
            transform: translateZ(10px);
        }

        .btn {
            padding: 16px 32px;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transform-style: preserve-3d;
            position: relative;
            overflow: hidden;
        }

        .btn:active {
            transform: translateZ(0) scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .btn-primary:hover {
            transform: translateZ(10px);
            box-shadow: var(--shadow-float);
        }

        .btn-block {
            width: 100%;
        }

        /* التصميم الرئيسي */
        .app-container {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .app-container.visible {
            display: block;
            opacity: 1;
        }

        /* شريط التنقل العلوي */
        .top-nav {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 16px 24px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transform-style: preserve-3d;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateZ(20px);
        }

        .nav-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        .nav-logo svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .nav-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-info {
            text-align: left;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-role {
            font-size: 12px;
            color: var(--light-2);
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: translateY(-2px);
        }

        /* قائمة التنقل الجانبية */
        .sidebar {
            position: fixed;
            top: 73px;
            right: 0;
            width: 280px;
            height: calc(100vh - 73px);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--glass-border);
            padding: 24px;
            overflow-y: auto;
            transform-style: preserve-3d;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: var(--radius-md);
            color: var(--light-2);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            transform-style: preserve-3d;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light-1);
            transform: translateX(-8px) translateZ(10px);
        }

        .nav-link.active {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(124, 58, 237, 0.1) 100%);
            color: var(--primary-light);
            border-left: 3px solid var(--primary);
        }

        .nav-link svg {
            width: 20px;
            height: 20px;
        }

        /* المحتوى الرئيسي */
        .main-content {
            margin-right: 280px;
            margin-top: 73px;
            padding: 24px;
            min-height: calc(100vh - 73px);
        }

        /* بطاقات ثلاثية الأبعاد */
        .card-3d {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-3d);
            transform-style: preserve-3d;
            transition: var(--transition);
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .card-3d:hover {
            transform: translateY(-10px) translateZ(20px);
            box-shadow: var(--shadow-float);
        }

        .card-3d:active {
            transform: translateY(-5px) translateZ(10px) scale(0.98);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--glass-border);
            transform: translateZ(20px);
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title svg {
            width: 24px;
            height: 24px;
            color: var(--primary-light);
        }

        /* الشبكة */
        .grid {
            display: grid;
            gap: 24px;
        }

        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

        /* بطاقات الإحصائيات */
        .stat-card {
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            transform: translateZ(30px);
        }

        .stat-icon svg {
            width: 32px;
            height: 32px;
            color: white;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 4px;
            background: linear-gradient(135deg, white 0%, var(--light-2) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transform: translateZ(20px);
        }

        .stat-label {
            color: var(--light-2);
            font-size: 14px;
            transform: translateZ(10px);
        }

        /* الأزرار */
        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light-1);
            border: 1px solid var(--glass-border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px) translateZ(10px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #D97706 100%);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* الجداول */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-lg);
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.2);
            transform-style: preserve-3d;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px 20px;
            text-align: right;
            font-weight: 700;
            color: var(--light-2);
            border-bottom: 1px solid var(--glass-border);
            transform: translateZ(10px);
        }

        .data-table td {
            padding: 14px 20px;
            border-bottom: 1px solid var(--glass-border);
            transform: translateZ(5px);
            transition: var(--transition);
        }

        .data-table tr:hover td {
            background: rgba(255, 255, 255, 0.03);
            transform: translateZ(10px);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* النماذج */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* زر الفعل العائم */
        .fab {
            position: fixed;
            bottom: 32px;
            left: 32px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: var(--shadow-float);
            transition: var(--transition);
            z-index: 100;
            transform-style: preserve-3d;
            animation: pulse 2s infinite;
        }

        .fab:hover {
            transform: scale(1.1) translateZ(20px);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.4);
        }

        .fab:active {
            transform: scale(0.95) translateZ(10px);
        }

        .fab svg {
            width: 28px;
            height: 28px;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }

        /* الماسح الضوئي */
        .scanner-overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .scanner-overlay.active {
            display: flex;
        }

        .scanner-container {
            width: 90%;
            max-width: 600px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-3d);
            transform-style: preserve-3d;
        }

        #qr-reader {
            width: 100%;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 24px;
            transform: translateZ(20px);
        }

        .scanner-result {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .scanner-result.active {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* القوائم المنسدلة */
        .select-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-md);
            color: var(--light-1);
            font-size: 16px;
            transition: var(--transition);
            cursor: pointer;
        }

        .select-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
        }

        /* الصفحات المخفية */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* الدليل الأول */
        .welcome-guide {
            text-align: center;
            padding: 60px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .guide-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            transform: translateZ(40px);
            box-shadow: var(--shadow-float);
        }

        .guide-icon svg {
            width: 60px;
            height: 60px;
            color: white;
        }

        .guide-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary-light) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .guide-text {
            color: var(--light-2);
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .guide-steps {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }

        .guide-step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: right;
            transition: var(--transition);
            cursor: pointer;
        }

        .guide-step:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-10px);
        }

        .guide-step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 20px;
            margin-bottom: 12px;
        }

        .guide-step-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--light-1);
        }

        .guide-step-desc {
            color: var(--light-2);
            font-size: 14px;
            line-height: 1.5;
        }

        /* الفاتورة */
        .invoice-preview {
            background: white;
            color: #1E293B;
            padding: 40px;
            border-radius: var(--radius-xl);
            max-width: 500px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .invoice-header {
            text-align: center;
            border-bottom: 2px dashed #CBD5E1;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .invoice-store {
            font-size: 28px;
            font-weight: 900;
            color: var(--dark-1);
            margin-bottom: 8px;
        }

        .invoice-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--dark-3);
        }

        .invoice-items {
            margin-bottom: 30px;
        }

        .invoice-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #E2E8F0;
        }

        .invoice-totals {
            border-top: 2px solid var(--dark-1);
            padding-top: 20px;
            margin-top: 20px;
        }

        .invoice-total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .invoice-grand-total {
            font-size: 24px;
            font-weight: 900;
            color: var(--primary);
        }

        /* التنبيهات */
        .alert {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%) translateZ(50px);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-3d);
            z-index: 2000;
            display: none;
            align-items: center;
            gap: 16px;
            min-width: 300px;
            max-width: 400px;
            animation: slideDown 0.3s ease;
        }

        .alert.active {
            display: flex;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px) translateZ(50px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0) translateZ(50px); }
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .alert-success .alert-icon {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .alert-error .alert-icon {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .alert-warning .alert-icon {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .alert-info .alert-icon {
            background: rgba(139, 92, 246, 0.2);
            color: var(--primary);
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .alert-message {
            font-size: 14px;
            color: var(--light-2);
        }

        /* التجاوب */
        @media (max-width: 1200px) {
            .grid-cols-4 { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .grid-cols-2, .grid-cols-3, .grid-cols-4 {
                grid-template-columns: repeat(1, 1fr);
            }
            
            .form-row {
                flex-direction: column;
                gap: 16px;
            }
            
            .login-card {
                padding: 32px 24px;
            }
        }

        /* تأثيرات اللمس */
        .touch-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* أداة التحميل */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--glass-border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- شاشة تسجيل الدخول -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <h1>نظام فواتير</h1>
                <p>نظام إدارة متكامل للمتاجر والمحلات</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">اسم المستخدم</label>
                    <input type="text" class="form-input" id="username" placeholder="أدخل اسم المستخدم" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-input" id="password" placeholder="أدخل كلمة المرور" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block" id="loginBtn">
                    <span>تسجيل الدخول</span>
                </button>
                
                <div class="form-group" style="text-align: center; margin-top: 20px;">
                    <small style="color: var(--light-2);">
                        المستخدم الافتراضي: admin / admin
                    </small>
                </div>
            </form>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div class="app-container" id="appContainer">
        <!-- شريط التنقل العلوي -->
        <nav class="top-nav">
            <div class="nav-brand">
                <div class="nav-logo">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <div class="nav-title">نظام فواتير</div>
            </div>
            
            <div class="nav-user">
                <div class="user-info">
                    <div class="user-name" id="currentUser">المسؤول</div>
                    <div class="user-role">مدير النظام</div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                    <span>تسجيل خروج</span>
                </button>
            </div>
        </nav>

        <!-- القائمة الجانبية -->
        <aside class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-page="dashboard">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                        <span>لوحة التحكم</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="pos">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3zm0 10c-2.76 0-5-2.24-5-5h2c0 1.66 1.34 3 3 3s3-1.34 3-3h2c0 2.76-2.24 5-5 5z"/>
                        </svg>
                        <span>نقطة البيع</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="inventory">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
                        </svg>
                        <span>إدارة المخزون</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="scanner">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2 6h4v12H2zm5 0h4v12H7zm5 0h4v12h-4zm5 0h4v12h-4z"/>
                        </svg>
                        <span>ماسح الباركود</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="reports">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span>التقارير</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="customers">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                        </svg>
                        <span>عملاء ومديونيات</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="settings">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                        </svg>
                        <span>الإعدادات</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <!-- صفحة لوحة التحكم -->
            <div class="page active" id="dashboard">
                <!-- دليل الترحيب -->
                <div class="card-3d" id="welcomeGuide" style="display: none;">
                    <div class="welcome-guide">
                        <div class="guide-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <h2 class="guide-title">مرحباً بك في نظام فواتير!</h2>
                        <p class="guide-text">
                            نظام إدارة متكامل لمحلات السوبر ماركت والأدوات الصحية والكهربائية.
                            ابدأ بإضافة منتجاتك الأولى لعرض الإحصائيات والتقارير.
                        </p>
                        
                        <div class="guide-steps">
                            <div class="guide-step" onclick="showPage('inventory')">
                                <div class="guide-step-number">1</div>
                                <div class="guide-step-title">إضافة المنتجات</div>
                                <div class="guide-step-desc">أضف منتجاتك مع الأسعار والكميات والأكواد</div>
                            </div>
                            <div class="guide-step" onclick="showPage('customers')">
                                <div class="guide-step-number">2</div>
                                <div class="guide-step-title">تسجيل العملاء</div>
                                <div class="guide-step-desc">سجل عملائك مع بيانات التواصل والمديونيات</div>
                            </div>
                            <div class="guide-step" onclick="showPage('pos')">
                                <div class="guide-step-number">3</div>
                                <div class="guide-step-title">إتمام أول بيع</div>
                                <div class="guide-step-desc">ابدأ بيع المنتجات وإنشاء الفواتير</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="hideWelcomeGuide()">
                            <span>بدأ الاستخدام</span>
                        </button>
                    </div>
                </div>

                <!-- إحصائيات النظام -->
                <div class="grid grid-cols-4" id="statsContainer" style="display: none;">
                    <div class="card-3d stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/>
                            </svg>
                        </div>
                        <div class="stat-value" id="totalSales">0 ج.م</div>
                        <div class="stat-label">إجمالي المبيعات اليوم</div>
                    </div>
                    
                    <div class="card-3d stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4z"/>
                            </svg>
                        </div>
                        <div class="stat-value" id="totalProfit">0 ج.م</div>
                        <div class="stat-label">صافي الربح اليوم</div>
                    </div>
                    
                    <div class="card-3d stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                            </svg>
                        </div>
                        <div class="stat-value" id="lowStock">0</div>
                        <div class="stat-label">منتجات منخفضة المخزون</div>
                    </div>
                    
                    <div class="card-3d stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                        </div>
                        <div class="stat-value" id="totalDebt">0 ج.م</div>
                        <div class="stat-label">إجمالي المديونيات</div>
                    </div>
                </div>

                <!-- الرسوم البيانية -->
                <div class="grid grid-cols-2" id="chartsContainer" style="display: none;">
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                                </svg>
                                <span>مبيعات آخر 7 أيام</span>
                            </h3>
                        </div>
                        <canvas id="salesChart" height="250"></canvas>
                    </div>
                    
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M11 2v20c-5.07-.5-9-4.79-9-10s3.93-9.5 9-10zm2.03 0v8.99H22c-.47-4.74-4.24-8.52-8.97-8.99zm0 11.01V22c4.74-.47 8.5-4.25 8.97-8.99h-8.97z"/>
                                </svg>
                                <span>توزيع المبيعات</span>
                            </h3>
                        </div>
                        <canvas id="categoriesChart" height="250"></canvas>
                    </div>
                </div>

                <!-- آخر المبيعات -->
                <div class="card-3d" id="recentSalesContainer" style="display: none;">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4z"/>
                            </svg>
                            <span>آخر المعاملات</span>
                        </h3>
                        <button class="btn btn-secondary btn-small" onclick="showPage('pos')">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            <span>بيع جديد</span>
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>رقم الفاتورة</th>
                                    <th>التاريخ</th>
                                    <th>العميل</th>
                                    <th>المبلغ</th>
                                    <th>الحالة</th>
                                </tr>
                            </thead>
                            <tbody id="recentSales">
                                <!-- البيانات تظهر هنا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- صفحة نقطة البيع -->
            <div class="page" id="pos">
                <div class="grid grid-cols-3">
                    <div class="card-3d" style="grid-column: span 2;">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3zm0 10c-2.76 0-5-2.24-5-5h2c0 1.66 1.34 3 3 3s3-1.34 3-3h2c0 2.76-2.24 5-5 5z"/>
                                </svg>
                                <span>نقطة البيع</span>
                            </h3>
                            <div class="flex gap-2">
                                <button class="btn btn-secondary btn-small" onclick="openScanner()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M2 6h4v12H2zm5 0h4v12H7zm5 0h4v12h-4zm5 0h4v12h-4z"/>
                                    </svg>
                                    <span>مسح باركود</span>
                                </button>
                                <button class="btn btn-danger btn-small" onclick="clearCart()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                    </svg>
                                    <span>تفريغ السلة</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- البحث السريع -->
                        <div class="form-group">
                            <input type="text" class="form-input" id="productSearch" 
                                   placeholder="ابحث عن منتج بالاسم أو الباركود" 
                                   onkeyup="searchProducts(event)">
                        </div>
                        
                        <!-- سلة المشتريات -->
                        <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>المنتج</th>
                                        <th>السعر</th>
                                        <th>الكمية</th>
                                        <th>الإجمالي</th>
                                        <th>إجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="cartItems">
                                    <!-- عناصر السلة تظهر هنا -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- إضافة منتج يدوي -->
                        <div class="form-row mt-4">
                            <div class="form-group">
                                <select class="select-input" id="productSelect" onchange="addSelectedProduct()">
                                    <option value="">اختر منتج للإضافة</option>
                                </select>
                            </div>
                            <div class="form-group" style="max-width: 120px;">
                                <input type="number" class="form-input" id="productQty" value="1" min="1">
                            </div>
                            <button class="btn btn-primary" onclick="addProductManually()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>إضافة</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- ملخص الفاتورة -->
                    <div class="card-3d">
                        <h3 class="card-title mb-4">ملخص الفاتورة</h3>
                        
                        <div class="form-group">
                            <label class="form-label">العميل</label>
                            <select class="select-input" id="customerSelect">
                                <option value="walkin">زبون مباشر</option>
                            </select>
                        </div>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between">
                                <span>الإجمالي الفرعي:</span>
                                <span id="subtotal">0 ج.م</span>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">الضريبة (%)</label>
                                    <input type="number" class="form-input" id="taxRate" value="14" min="0" max="100" onchange="updateInvoice()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">الخصم (ج.م)</label>
                                    <input type="number" class="form-input" id="discount" value="0" min="0" onchange="updateInvoice()">
                                </div>
                            </div>
                            
                            <div class="flex justify-between">
                                <span>الضريبة:</span>
                                <span id="taxAmount">0 ج.م</span>
                            </div>
                            
                            <div class="flex justify-between">
                                <span>الخصم:</span>
                                <span id="discountAmount">0 ج.م</span>
                            </div>
                            
                            <div class="flex justify-between text-lg font-bold border-t border-gray-700 pt-3 mt-3">
                                <span>الإجمالي النهائي:</span>
                                <span id="totalAmount">0 ج.م</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">طريقة الدفع</label>
                            <select class="select-input" id="paymentMethod" onchange="togglePaymentFields()">
                                <option value="cash">نقدي</option>
                                <option value="card">بطاقة</option>
                                <option value="credit">آجل</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="cashFields">
                            <label class="form-label">المبلغ المدفوع</label>
                            <input type="number" class="form-input" id="amountPaid" value="0" min="0" onchange="updateChange()">
                        </div>
                        
                        <div class="flex justify-between mb-6" id="changeField">
                            <span>الباقي:</span>
                            <span id="changeAmount">0 ج.م</span>
                        </div>
                        
                        <button class="btn btn-success w-full mb-3" onclick="completeSale()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            <span>إتمام البيع</span>
                        </button>
                        
                        <button class="btn btn-secondary w-full" onclick="previewInvoice()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                                <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                            </svg>
                            <span>معاينة الفاتورة</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- صفحة إدارة المخزون -->
            <div class="page" id="inventory">
                <div class="card-3d">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
                            </svg>
                            <span>إدارة المخزون</span>
                        </h3>
                        <button class="btn btn-primary" onclick="openProductModal()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            <span>إضافة منتج</span>
                        </button>
                    </div>
                    
                    <!-- فلاتر البحث -->
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="form-input" id="inventorySearch" 
                                   placeholder="ابحث في المخزون" onkeyup="searchInventory()">
                        </div>
                        <div class="form-group">
                            <select class="select-input" id="categoryFilter" onchange="filterInventory()">
                                <option value="">جميع الفئات</option>
                                <option value="سوبرماركت">سوبرماركت</option>
                                <option value="أدوات صحية">أدوات صحية</option>
                                <option value="أدوات كهربائية">أدوات كهربائية</option>
                                <option value="مواد بناء">مواد بناء</option>
                                <option value="مستلزمات مكتبية">مستلزمات مكتبية</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- جدول المخزون -->
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>المنتج</th>
                                    <th>الفئة</th>
                                    <th>السعر</th>
                                    <th>سعر الشراء</th>
                                    <th>المخزون</th>
                                    <th>الباركود</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable">
                                <!-- البيانات تظهر هنا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- صفحة الماسح الضوئي -->
            <div class="page" id="scanner">
                <div class="card-3d">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2 6h4v12H2zm5 0h4v12H7zm5 0h4v12h-4zm5 0h4v12h-4z"/>
                            </svg>
                            <span>ماسح الباركود</span>
                        </h3>
                    </div>
                    
                    <div class="text-center py-12">
                        <div class="mb-8">
                            <div id="qr-reader" style="width: 100%; max-width: 500px; margin: 0 auto;"></div>
                        </div>
                        
                        <div class="scanner-result" id="scannerResult">
                            <h4 class="text-lg font-bold mb-3">نتيجة المسح</h4>
                            <div id="scannedProductDetails"></div>
                            <button class="btn btn-primary mt-4" onclick="addScannedToCart()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>إضافة للسلة</span>
                            </button>
                        </div>
                        
                        <button class="btn btn-secondary mt-8" onclick="stopScanner()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            <span>إيقاف الماسح</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- صفحة التقارير -->
            <div class="page" id="reports">
                <div class="card-3d">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                            </svg>
                            <span>التقارير والإحصائيات</span>
                        </h3>
                        <div class="flex gap-2">
                            <select class="select-input" id="reportPeriod" onchange="updateReports()">
                                <option value="week">أسبوع</option>
                                <option value="month">شهر</option>
                                <option value="year">سنة</option>
                            </select>
                            <button class="btn btn-secondary" onclick="exportReport()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                                </svg>
                                <span>تصدير</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div class="card-3d">
                            <h4 class="text-lg font-bold mb-4">المبيعات اليومية</h4>
                            <canvas id="dailyReportChart" height="200"></canvas>
                        </div>
                        <div class="card-3d">
                            <h4 class="text-lg font-bold mb-4">المبيعات حسب الفئة</h4>
                            <canvas id="categoryReportChart" height="200"></canvas>
                        </div>
                    </div>
                    
                    <!-- تقرير الربح والخسارة -->
                    <div class="card-3d">
                        <h4 class="text-lg font-bold mb-4">تقرير الربح والخسارة</h4>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>التاريخ</th>
                                        <th>إجمالي المبيعات</th>
                                        <th>تكلفة البضاعة</th>
                                        <th>الربح الإجمالي</th>
                                        <th>المصاريف</th>
                                        <th>صافي الربح</th>
                                    </tr>
                                </thead>
                                <tbody id="profitLossTable">
                                    <!-- البيانات تظهر هنا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- صفحة العملاء والمديونيات -->
            <div class="page" id="customers">
                <div class="grid grid-cols-2 gap-6">
                    <!-- قائمة العملاء -->
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                                </svg>
                                <span>إدارة العملاء</span>
                            </h3>
                            <button class="btn btn-primary" onclick="openCustomerModal()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>إضافة عميل</span>
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <input type="text" class="form-input" id="customerSearch" 
                                   placeholder="ابحث عن عميل" onkeyup="searchCustomers()">
                        </div>
                        
                        <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>الاسم</th>
                                        <th>الهاتف</th>
                                        <th>الرصيد</th>
                                        <th>إجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="customersTable">
                                    <!-- البيانات تظهر هنا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- المديونيات -->
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                                </svg>
                                <span>المديونيات</span>
                            </h3>
                            <button class="btn btn-secondary" onclick="openPaymentModal()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                                <span>سداد دفعة</span>
                            </button>
                        </div>
                        
                        <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>العميل</th>
                                        <th>المبلغ</th>
                                        <th>آخر سداد</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody id="debtsTable">
                                    <!-- البيانات تظهر هنا -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- سجل المدفوعات -->
                        <div class="mt-6">
                            <h4 class="text-lg font-bold mb-4">سجل المدفوعات</h4>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>التاريخ</th>
                                            <th>العميل</th>
                                            <th>المبلغ</th>
                                            <th>الطريقة</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentsTable">
                                        <!-- البيانات تظهر هنا -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- صفحة الإعدادات -->
            <div class="page" id="settings">
                <div class="grid grid-cols-2 gap-6">
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                                </svg>
                                <span>إعدادات المتجر</span>
                            </h3>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="form-group">
                                <label class="form-label">اسم المتجر</label>
                                <input type="text" class="form-input" id="storeName" value="متجري">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">العنوان</label>
                                <textarea class="form-input" id="storeAddress" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">رقم الهاتف</label>
                                <input type="text" class="form-input" id="storePhone">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">نسبة الضريبة (%)</label>
                                <input type="number" class="form-input" id="taxRateSetting" value="14">
                            </div>
                            
                            <button class="btn btn-primary w-full" onclick="saveStoreSettings()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                                </svg>
                                <span>حفظ الإعدادات</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- إدارة البيانات -->
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">إدارة البيانات</h3>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold mb-2">تصدير البيانات</h4>
                                <p class="text-sm text-gray-400 mb-3">احفظ نسخة احتياطية من جميع بياناتك</p>
                                <button class="btn btn-secondary w-full" onclick="exportData()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                                    </svg>
                                    <span>تصدير جميع البيانات</span>
                                </button>
                            </div>
                            
                            <div>
                                <h4 class="font-bold mb-2">استيراد البيانات</h4>
                                <p class="text-sm text-gray-400 mb-3">استر بيانات من نسخة احتياطية</p>
                                <input type="file" class="form-input" id="importFile" accept=".json">
                                <button class="btn btn-warning w-full mt-2" onclick="importData()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
                                    </svg>
                                    <span>استيراد البيانات</span>
                                </button>
                            </div>
                            
                            <div>
                                <h4 class="font-bold mb-2 text-red-400">خطر</h4>
                                <p class="text-sm text-gray-400 mb-3">حذف جميع البيانات بشكل دائم</p>
                                <button class="btn btn-danger w-full" onclick="resetSystem()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </svg>
                                    <span>حذف جميع البيانات</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- زر الفعل العائم -->
        <div class="fab" onclick="quickAction()">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
        </div>

        <!-- الماسح الضوئي -->
        <div class="scanner-overlay" id="scannerOverlay">
            <div class="scanner-container">
                <div class="card-header">
                    <h3 class="card-title">ماسح الباركود</h3>
                    <button class="btn btn-secondary btn-small" onclick="closeScanner()">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
                <div id="scanner"></div>
            </div>
        </div>
    </div>

    <!-- نافذة التنبيه -->
    <div class="alert" id="alert">
        <div class="alert-icon">
            <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
        </div>
        <div class="alert-content">
            <div class="alert-title" id="alertTitle">تم!</div>
            <div class="alert-message" id="alertMessage">تمت العملية بنجاح</div>
        </div>
    </div>

    <!-- البرنامج النصي -->
    <script>
        // ============================================
        // المتغيرات العامة وقاعدة البيانات
        // ============================================

        let db = {
            products: [],
            customers: [],
            sales: [],
            settings: {},
            user: null
        };

        let cart = [];
        let currentScanner = null;
        let charts = {};

        // ============================================
        // نظام المصادقة
        // ============================================

        function initAuth() {
            // تحقق من وجود جلسة سابقة
            const session = localStorage.getItem('fawateer_session');
            if (session) {
                const { user, timestamp } = JSON.parse(session);
                const now = new Date().getTime();
                const hoursElapsed = (now - timestamp) / (1000 * 60 * 60);
                
                if (hoursElapsed < 24) { // الجلسة صالحة لمدة 24 ساعة
                    db.user = user;
                    showApp();
                    return;
                }
            }
            
            // إذا لم تكن هناك جلسة صالحة، عرض شاشة تسجيل الدخول
            showLogin();
        }

        function login(username, password) {
            // مصادقة بسيطة - في النسخة الحقيقية يجب تشفير كلمات المرور
            if (username === 'admin' && password === 'admin') {
                db.user = {
                    id: 1,
                    name: 'المسؤول',
                    username: 'admin',
                    role: 'admin'
                };
                
                // حفظ الجلسة
                const session = {
                    user: db.user,
                    timestamp: new Date().getTime()
                };
                localStorage.setItem('fawateer_session', JSON.stringify(session));
                
                showApp();
                showAlert('success', 'مرحباً بعودتك!', 'تم تسجيل الدخول بنجاح');
                return true;
            }
            
            showAlert('error', 'خطأ في المصادقة', 'اسم المستخدم أو كلمة المرور غير صحيحة');
            return false;
        }

        function logout() {
            localStorage.removeItem('fawateer_session');
            db.user = null;
            cart = [];
            showLogin();
        }

        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('appContainer').classList.remove('visible');
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.add('visible');
            loadData();
            initDashboard();
        }

        // ============================================
        // إدارة البيانات في localStorage
        // ============================================

        function loadData() {
            // تحميل البيانات من localStorage
            db.products = JSON.parse(localStorage.getItem('fawateer_products')) || [];
            db.customers = JSON.parse(localStorage.getItem('fawateer_customers')) || [];
            db.sales = JSON.parse(localStorage.getItem('fawateer_sales')) || [];
            db.settings = JSON.parse(localStorage.getItem('fawateer_settings')) || {
                storeName: 'متجري',
                storeAddress: '',
                storePhone: '',
                taxRate: 14
            };
            
            // تحديث واجهة المستخدم
            updateProductSelect();
            updateCustomerSelect();
            loadStoreSettings();
            
            // عرض دليل الترحيب إذا كان النظام جديداً
            if (db.products.length === 0 && db.sales.length === 0) {
                showWelcomeGuide();
            }
        }

        function saveData() {
            localStorage.setItem('fawateer_products', JSON.stringify(db.products));
            localStorage.setItem('fawateer_customers', JSON.stringify(db.customers));
            localStorage.setItem('fawateer_sales', JSON.stringify(db.sales));
            localStorage.setItem('fawateer_settings', JSON.stringify(db.settings));
        }

        // ============================================
        // نظام التنقل
        // ============================================

        function showPage(pageId) {
            // إخفاء جميع الصفحات
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // إلغاء تنشيط جميع روابط التنقل
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // عرض الصفحة المطلوبة
            document.getElementById(pageId).classList.add('active');
            
            // تنشيط رابط التنقل المناسب
            document.querySelector(`.nav-link[data-page="${pageId}"]`).classList.add('active');
            
            // تهيئة الصفحة إذا لزم الأمر
            switch(pageId) {
                case 'dashboard':
                    initDashboard();
                    break;
                case 'inventory':
                    loadInventoryTable();
                    break;
                case 'customers':
                    loadCustomersTable();
                    loadDebtsTable();
                    loadPaymentsTable();
                    break;
                case 'reports':
                    updateReports();
                    break;
                case 'scanner':
                    initScanner();
                    break;
            }
        }

        // ============================================
        // نظام التنبيهات
        // ============================================

        function showAlert(type, title, message) {
            const alert = document.getElementById('alert');
            const alertTitle = document.getElementById('alertTitle');
            const alertMessage = document.getElementById('alertMessage');
            
            alert.className = `alert alert-${type}`;
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            alert.classList.add('active');
            
            // إخفاء التنبيه بعد 3 ثوانٍ
            setTimeout(() => {
                alert.classList.remove('active');
            }, 3000);
        }

        // ============================================
        // لوحة التحكم
        // ============================================

        function initDashboard() {
            const hasData = db.products.length > 0 || db.sales.length > 0;
            
            if (hasData) {
                document.getElementById('welcomeGuide').style.display = 'none';
                document.getElementById('statsContainer').style.display = 'grid';
                document.getElementById('chartsContainer').style.display = 'grid';
                document.getElementById('recentSalesContainer').style.display = 'block';
                
                updateStats();
                loadRecentSales();
                initCharts();
            } else {
                document.getElementById('welcomeGuide').style.display = 'block';
                document.getElementById('statsContainer').style.display = 'none';
                document.getElementById('chartsContainer').style.display = 'none';
                document.getElementById('recentSalesContainer').style.display = 'none';
            }
        }

        function showWelcomeGuide() {
            document.getElementById('welcomeGuide').style.display = 'block';
        }

        function hideWelcomeGuide() {
            document.getElementById('welcomeGuide').style.display = 'none';
            document.getElementById('statsContainer').style.display = 'grid';
            document.getElementById('chartsContainer').style.display = 'grid';
            document.getElementById('recentSalesContainer').style.display = 'block';
        }

        function updateStats() {
            const today = new Date().toDateString();
            
            // المبيعات اليومية
            const todaySales = db.sales.filter(sale => {
                const saleDate = new Date(sale.date).toDateString();
                return saleDate === today;
            });
            
            const totalSales = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            document.getElementById('totalSales').textContent = formatCurrency(totalSales);
            
            // الربح اليومي
            const todayProfit = todaySales.reduce((sum, sale) => sum + sale.profit, 0);
            document.getElementById('totalProfit').textContent = formatCurrency(todayProfit);
            
            // المخزون المنخفض
            const lowStockCount = db.products.filter(p => p.quantity <= (p.lowStockThreshold || 5)).length;
            document.getElementById('lowStock').textContent = lowStockCount;
            
            // المديونيات
            const totalDebt = db.customers.reduce((sum, customer) => sum + (customer.balance || 0), 0);
            document.getElementById('totalDebt').textContent = formatCurrency(totalDebt);
        }

        function loadRecentSales() {
            const table = document.getElementById('recentSales');
            table.innerHTML = '';
            
            const recentSales = [...db.sales]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
            
            recentSales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${sale.id}</td>
                    <td>${new Date(sale.date).toLocaleDateString('ar-SA')}</td>
                    <td>${sale.customerName || 'زبون مباشر'}</td>
                    <td>${formatCurrency(sale.total)}</td>
                    <td><span class="text-green-400">مكتمل</span></td>
                `;
                table.appendChild(row);
            });
        }

        function initCharts() {
            // مخطط المبيعات
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            const dates = [];
            const salesData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('ar-SA', { weekday: 'short' }));
                
                const daySales = db.sales.filter(sale => {
                    const saleDate = new Date(sale.date).toDateString();
                    return saleDate === date.toDateString();
                }).reduce((sum, sale) => sum + sale.total, 0);
                
                salesData.push(daySales);
            }
            
            if (charts.salesChart) charts.salesChart.destroy();
            
            charts.salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'المبيعات',
                        data: salesData,
                        borderColor: '#8B5CF6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#94A3B8' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#94A3B8' }
                        }
                    }
                }
            });
            
            // مخطط الفئات
            const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
            const categoryData = {};
            
            db.sales.forEach(sale => {
                sale.items.forEach(item => {
                    const product = db.products.find(p => p.id === item.productId);
                    if (product) {
                        categoryData[product.category] = (categoryData[product.category] || 0) + item.quantity;
                    }
                });
            });
            
            const categoryLabels = Object.keys(categoryData);
            const categoryValues = Object.values(categoryData);
            
            if (charts.categoriesChart) charts.categoriesChart.destroy();
            
            charts.categoriesChart = new Chart(categoriesCtx, {
                type: 'doughnut',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: categoryValues,
                        backgroundColor: [
                            '#8B5CF6', '#10B981', '#F59E0B', '#EF4444', '#3B82F6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'left',
                            labels: { color: '#E2E8F0' }
                        }
                    }
                }
            });
        }

        // ============================================
        // نقطة البيع
        // ============================================

        function searchProducts(event) {
            if (event.key === 'Enter') {
                const searchTerm = event.target.value.toLowerCase();
                const product = db.products.find(p => 
                    p.name.toLowerCase().includes(searchTerm) || 
                    p.barcode === searchTerm
                );
                
                if (product) {
                    addToCart(product.id, 1);
                    event.target.value = '';
                    showAlert('success', 'تم', `تمت إضافة ${product.name} إلى السلة`);
                }
            }
        }

        function addSelectedProduct() {
            const select = document.getElementById('productSelect');
            const productId = parseInt(select.value);
            const quantity = parseInt(document.getElementById('productQty').value) || 1;
            
            if (productId) {
                addToCart(productId, quantity);
                select.value = '';
                document.getElementById('productQty').value = 1;
            }
        }

        function addProductManually() {
            const select = document.getElementById('productSelect');
            const productId = parseInt(select.value);
            const quantity = parseInt(document.getElementById('productQty').value) || 1;
            
            if (!productId) {
                showAlert('error', 'خطأ', 'يرجى اختيار منتج أولاً');
                return;
            }
            
            addToCart(productId, quantity);
            select.value = '';
            document.getElementById('productQty').value = 1;
        }

        function addToCart(productId, quantity = 1) {
            const product = db.products.find(p => p.id === productId);
            
            if (!product) {
                showAlert('error', 'خطأ', 'المنتج غير موجود');
                return;
            }
            
            if (product.quantity < quantity) {
                showAlert('error', 'خطأ', `الكمية غير متوفرة. المتوفر: ${product.quantity}`);
                return;
            }
            
            // البحث إذا كان المنتج موجوداً في السلة
            const existingItemIndex = cart.findIndex(item => item.productId === productId);
            
            if (existingItemIndex !== -1) {
                const newQuantity = cart[existingItemIndex].quantity + quantity;
                if (product.quantity < newQuantity) {
                    showAlert('error', 'خطأ', `الكمية غير متوفرة. المتوفر: ${product.quantity}`);
                    return;
                }
                cart[existingItemIndex].quantity = newQuantity;
                cart[existingItemIndex].total = cart[existingItemIndex].price * newQuantity;
            } else {
                cart.push({
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: quantity,
                    total: product.price * quantity
                });
            }
            
            updateCartDisplay();
            updateInvoice();
        }

        function updateCartDisplay() {
            const table = document.getElementById('cartItems');
            table.innerHTML = '';
            
            cart.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <button class="btn btn-secondary btn-small" onclick="updateCartQuantity(${index}, -1)">-</button>
                            <span>${item.quantity}</span>
                            <button class="btn btn-secondary btn-small" onclick="updateCartQuantity(${index}, 1)">+</button>
                        </div>
                    </td>
                    <td>${formatCurrency(item.total)}</td>
                    <td>
                        <button class="btn btn-danger btn-small" onclick="removeFromCart(${index})">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                            </svg>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function updateCartQuantity(index, change) {
            const item = cart[index];
            const product = db.products.find(p => p.id === item.productId);
            
            const newQuantity = item.quantity + change;
            
            if (newQuantity < 1) {
                removeFromCart(index);
                return;
            }
            
            if (product.quantity < newQuantity) {
                showAlert('error', 'خطأ', `الكمية غير متوفرة. المتوفر: ${product.quantity}`);
                return;
            }
            
            cart[index].quantity = newQuantity;
            cart[index].total = cart[index].price * newQuantity;
            
            updateCartDisplay();
            updateInvoice();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
            updateInvoice();
        }

        function clearCart() {
            if (cart.length === 0) return;
            
            if (confirm('هل تريد تفريغ سلة المشتريات؟')) {
                cart = [];
                updateCartDisplay();
                updateInvoice();
                showAlert('success', 'تم', 'تم تفريغ السلة');
            }
        }

        function updateInvoice() {
            const subtotal = cart.reduce((sum, item) => sum + item.total, 0);
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            
            const taxAmount = subtotal * (taxRate / 100);
            const total = subtotal + taxAmount - discount;
            
            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
            document.getElementById('discountAmount').textContent = formatCurrency(discount);
            document.getElementById('totalAmount').textContent = formatCurrency(total);
            
            updateChange();
        }

        function togglePaymentFields() {
            const method = document.getElementById('paymentMethod').value;
            const cashFields = document.getElementById('cashFields');
            const changeField = document.getElementById('changeField');
            
            if (method === 'cash') {
                cashFields.style.display = 'block';
                changeField.style.display = 'flex';
                document.getElementById('amountPaid').value = document.getElementById('totalAmount').textContent.replace(/[^0-9.]/g, '');
            } else {
                cashFields.style.display = 'none';
                changeField.style.display = 'none';
            }
        }

        function updateChange() {
            const total = parseFloat(document.getElementById('totalAmount').textContent.replace(/[^0-9.]/g, '')) || 0;
            const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
            const change = amountPaid - total;
            
            document.getElementById('changeAmount').textContent = formatCurrency(change);
            
            const changeElement = document.getElementById('changeAmount');
            if (change < 0) {
                changeElement.style.color = '#EF4444';
            } else {
                changeElement.style.color = '#10B981';
            }
        }

        function completeSale() {
            if (cart.length === 0) {
                showAlert('error', 'خطأ', 'سلة المشتريات فارغة');
                return;
            }
            
            const total = parseFloat(document.getElementById('totalAmount').textContent.replace(/[^0-9.]/g, ''));
            const paymentMethod = document.getElementById('paymentMethod').value;
            const customerId = document.getElementById('customerSelect').value;
            
            if (paymentMethod === 'cash') {
                const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
                if (amountPaid < total) {
                    showAlert('error', 'خطأ', 'المبلغ المدفوع أقل من الإجمالي');
                    return;
                }
            }
            
            // إنشاء فاتورة جديدة
            const saleId = db.sales.length > 0 ? Math.max(...db.sales.map(s => s.id)) + 1 : 1;
            const customer = db.customers.find(c => c.id == customerId);
            
            // حساب الربح
            let profit = 0;
            cart.forEach(item => {
                const product = db.products.find(p => p.id === item.productId);
                if (product && product.cost) {
                    profit += (item.price - product.cost) * item.quantity;
                }
            });
            
            const sale = {
                id: saleId,
                date: new Date().toISOString(),
                customerId: customerId === 'walkin' ? null : parseInt(customerId),
                customerName: customer ? customer.name : 'زبون مباشر',
                items: [...cart],
                subtotal: cart.reduce((sum, item) => sum + item.total, 0),
                tax: parseFloat(document.getElementById('taxAmount').textContent.replace(/[^0-9.]/g, '')) || 0,
                discount: parseFloat(document.getElementById('discount').value) || 0,
                total: total,
                profit: profit,
                paymentMethod: paymentMethod,
                amountPaid: paymentMethod === 'cash' ? parseFloat(document.getElementById('amountPaid').value) || 0 : total,
                change: paymentMethod === 'cash' ? (parseFloat(document.getElementById('amountPaid').value) || 0) - total : 0,
                status: 'completed'
            };
            
            // تحديث المخزون
            cart.forEach(item => {
                const productIndex = db.products.findIndex(p => p.id === item.productId);
                if (productIndex !== -1) {
                    db.products[productIndex].quantity -= item.quantity;
                }
            });
            
            // تحديث رصيد العميل إذا كان البيع آجل
            if (paymentMethod === 'credit' && customer) {
                customer.balance = (customer.balance || 0) + total;
            }
            
            // حفظ الفاتورة
            db.sales.push(sale);
            saveData();
            
            // إشعار النجاح
            showAlert('success', 'تم البيع', `تم إتمام البيع بنجاح. رقم الفاتورة: #${saleId}`);
            
            // طباعة الفاتورة
            previewInvoice(sale);
            
            // إعادة تعيين السلة
            cart = [];
            updateCartDisplay();
            updateInvoice();
            
            // تحديث لوحة التحكم
            updateStats();
            updateProductSelect();
            
            // تحديث قائمة العملاء إذا كانت هناك مديونية
            if (paymentMethod === 'credit') {
                loadCustomersTable();
                loadDebtsTable();
            }
        }

        function previewInvoice(sale = null) {
            if (!sale) {
                // معاينة الفاتورة الحالية
                const subtotal = cart.reduce((sum, item) => sum + item.total, 0);
                const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
                const discount = parseFloat(document.getElementById('discount').value) || 0;
                const taxAmount = subtotal * (taxRate / 100);
                const total = subtotal + taxAmount - discount;
                
                sale = {
                    id: 'معاينة',
                    date: new Date().toISOString(),
                    customerName: document.getElementById('customerSelect').value === 'walkin' ? 'زبون مباشر' : 'عميل',
                    items: [...cart],
                    subtotal: subtotal,
                    tax: taxAmount,
                    discount: discount,
                    total: total,
                    paymentMethod: document.getElementById('paymentMethod').value
                };
            }
            
            // إنشاء نافذة طباعة
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>فاتورة #${sale.id}</title>
                    <style>
                        body { font-family: 'Cairo', sans-serif; padding: 20px; }
                        .invoice { max-width: 500px; margin: 0 auto; }
                        .header { text-align: center; border-bottom: 2px dashed #ccc; padding-bottom: 20px; }
                        .store-name { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
                        .details { display: flex; justify-content: space-between; margin: 20px 0; }
                        .items { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        .items th, .items td { padding: 10px; border-bottom: 1px solid #ddd; text-align: right; }
                        .total { border-top: 2px solid #000; padding-top: 10px; margin-top: 20px; font-weight: bold; }
                        .footer { text-align: center; margin-top: 30px; color: #666; }
                        @media print {
                            body { padding: 0; }
                            button { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="invoice">
                        <div class="header">
                            <div class="store-name">${db.settings.storeName || 'متجري'}</div>
                            <div>${db.settings.storeAddress || ''}</div>
                            <div>${db.settings.storePhone || ''}</div>
                            <div>فاتورة #${sale.id}</div>
                            <div>${new Date(sale.date).toLocaleDateString('ar-SA')} ${new Date(sale.date).toLocaleTimeString('ar-SA')}</div>
                        </div>
                        
                        <div class="details">
                            <div>العميل: ${sale.customerName}</div>
                            <div>طريقة الدفع: ${sale.paymentMethod === 'cash' ? 'نقدي' : sale.paymentMethod === 'card' ? 'بطاقة' : 'آجل'}</div>
                        </div>
                        
                        <table class="items">
                            <thead>
                                <tr>
                                    <th>المنتج</th>
                                    <th>الكمية</th>
                                    <th>السعر</th>
                                    <th>الإجمالي</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sale.items.map(item => `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td>${item.quantity}</td>
                                        <td>${formatCurrency(item.price)}</td>
                                        <td>${formatCurrency(item.total)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        
                        <div class="total">
                            <div>الإجمالي الفرعي: ${formatCurrency(sale.subtotal)}</div>
                            ${sale.tax > 0 ? `<div>الضريبة: ${formatCurrency(sale.tax)}</div>` : ''}
                            ${sale.discount > 0 ? `<div>الخصم: ${formatCurrency(sale.discount)}</div>` : ''}
                            <div style="font-size: 18px; margin-top: 10px;">الإجمالي النهائي: ${formatCurrency(sale.total)}</div>
                        </div>
                        
                        ${sale.amountPaid ? `
                        <div class="details">
                            <div>المبلغ المدفوع: ${formatCurrency(sale.amountPaid)}</div>
                            <div>الباقي: ${formatCurrency(sale.change)}</div>
                        </div>
                        ` : ''}
                        
                        <div class="footer">
                            شكراً لتعاملكم معنا<br>
                            ${new Date().toLocaleDateString('ar-SA')}
                        </div>
                        
                        <button onclick="window.print()" style="padding: 10px 20px; margin-top: 20px; background: #8B5CF6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            طباعة الفاتورة
                        </button>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // ============================================
        // إدارة المخزون
        // ============================================

        function loadInventoryTable() {
            const table = document.getElementById('inventoryTable');
            table.innerHTML = '';
            
            db.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${formatCurrency(product.price)}</td>
                    <td>${formatCurrency(product.cost || 0)}</td>
                    <td>
                        <span class="${product.quantity <= (product.lowStockThreshold || 5) ? 'text-red-400' : ''}">
                            ${product.quantity}
                        </span>
                    </td>
                    <td>${product.barcode || '-'}</td>
                    <td>
                        <button class="btn btn-secondary btn-small" onclick="editProduct(${product.id})">تعديل</button>
                        <button class="btn btn-danger btn-small" onclick="deleteProduct(${product.id})">حذف</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function searchInventory() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            const filteredProducts = db.products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) ||
                (product.barcode && product.barcode.includes(searchTerm)) ||
                product.category.toLowerCase().includes(searchTerm)
            );
            
            const table = document.getElementById('inventoryTable');
            table.innerHTML = '';
            
            filteredProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${formatCurrency(product.price)}</td>
                    <td>${formatCurrency(product.cost || 0)}</td>
                    <td>
                        <span class="${product.quantity <= (product.lowStockThreshold || 5) ? 'text-red-400' : ''}">
                            ${product.quantity}
                        </span>
                    </td>
                    <td>${product.barcode || '-'}</td>
                    <td>
                        <button class="btn btn-secondary btn-small" onclick="editProduct(${product.id})">تعديل</button>
                        <button class="btn btn-danger btn-small" onclick="deleteProduct(${product.id})">حذف</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function filterInventory() {
            const category = document.getElementById('categoryFilter').value;
            const filteredProducts = category ? 
                db.products.filter(product => product.category === category) : 
                db.products;
            
            const table = document.getElementById('inventoryTable');
            table.innerHTML = '';
            
            filteredProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${formatCurrency(product.price)}</td>
                    <td>${formatCurrency(product.cost || 0)}</td>
                    <td>
                        <span class="${product.quantity <= (product.lowStockThreshold || 5) ? 'text-red-400' : ''}">
                            ${product.quantity}
                        </span>
                    </td>
                    <td>${product.barcode || '-'}</td>
                    <td>
                        <button class="btn btn-secondary btn-small" onclick="editProduct(${product.id})">تعديل</button>
                        <button class="btn btn-danger btn-small" onclick="deleteProduct(${product.id})">حذف</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function openProductModal(productId = null) {
            if (productId) {
                // وضع التعديل
                const product = db.products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('modalProductId').value = product.id;
                    document.getElementById('modalProductName').value = product.name;
                    document.getElementById('modalProductCategory').value = product.category;
                    document.getElementById('modalProductPrice').value = product.price;
                    document.getElementById('modalProductCost').value = product.cost || '';
                    document.getElementById('modalProductQuantity').value = product.quantity;
                    document.getElementById('modalProductLowStock').value = product.lowStockThreshold || 5;
                    document.getElementById('modalProductBarcode').value = product.barcode || '';
                }
            } else {
                // وضع الإضافة
                document.getElementById('modalProductId').value = '';
                document.getElementById('modalProductName').value = '';
                document.getElementById('modalProductCategory').value = 'سوبرماركت';
                document.getElementById('modalProductPrice').value = '';
                document.getElementById('modalProductCost').value = '';
                document.getElementById('modalProductQuantity').value = '0';
                document.getElementById('modalProductLowStock').value = '5';
                document.getElementById('modalProductBarcode').value = '';
            }
            
            document.getElementById('productModal').style.display = 'flex';
        }

        function saveProduct() {
            const id = document.getElementById('modalProductId').value;
            const name = document.getElementById('modalProductName').value;
            const category = document.getElementById('modalProductCategory').value;
            const price = parseFloat(document.getElementById('modalProductPrice').value);
            const cost = parseFloat(document.getElementById('modalProductCost').value) || 0;
            const quantity = parseInt(document.getElementById('modalProductQuantity').value);
            const lowStock = parseInt(document.getElementById('modalProductLowStock').value);
            const barcode = document.getElementById('modalProductBarcode').value;
            
            if (!name || !price || isNaN(quantity)) {
                showAlert('error', 'خطأ', 'يرجى ملء جميع الحقول المطلوبة');
                return;
            }
            
            if (id) {
                // تحديث المنتج
                const index = db.products.findIndex(p => p.id == id);
                if (index !== -1) {
                    db.products[index] = {
                        ...db.products[index],
                        name,
                        category,
                        price,
                        cost,
                        quantity,
                        lowStockThreshold: lowStock,
                        barcode
                    };
                }
            } else {
                // إضافة منتج جديد
                const newId = db.products.length > 0 ? Math.max(...db.products.map(p => p.id)) + 1 : 1;
                db.products.push({
                    id: newId,
                    name,
                    category,
                    price,
                    cost,
                    quantity,
                    lowStockThreshold: lowStock,
                    barcode: barcode || generateBarcode(),
                    createdAt: new Date().toISOString()
                });
            }
            
            saveData();
            loadInventoryTable();
            updateProductSelect();
            updateStats();
            
            document.getElementById('productModal').style.display = 'none';
            showAlert('success', 'تم', 'تم حفظ المنتج بنجاح');
        }

        function deleteProduct(productId) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                db.products = db.products.filter(p => p.id !== productId);
                saveData();
                loadInventoryTable();
                updateProductSelect();
                showAlert('success', 'تم', 'تم حذف المنتج بنجاح');
            }
        }

        function editProduct(productId) {
            openProductModal(productId);
        }

        function generateBarcode() {
            return 'EG' + Date.now() + Math.floor(Math.random() * 1000);
        }

        function updateProductSelect() {
            const select = document.getElementById('productSelect');
            select.innerHTML = '<option value="">اختر منتج للإضافة</option>';
            
            db.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} - ${formatCurrency(product.price)} (${product.quantity} متبقي)`;
                select.appendChild(option);
            });
        }

        // ============================================
        // الماسح الضوئي
        // ============================================

        function initScanner() {
            const scannerElement = document.getElementById('qr-reader');
            scannerElement.innerHTML = '';
            
            const html5QrCode = new Html5Qrcode("qr-reader");
            
            const config = { 
                fps: 10,
                qrbox: { width: 250, height: 250 },
                rememberLastUsedCamera: true
            };
            
            html5QrCode.start(
                { facingMode: "environment" },
                config,
                onScanSuccess,
                onScanError
            ).catch(err => {
                console.error("Unable to start scanning", err);
                showAlert('error', 'خطأ', 'تعذر فتح الكاميرا');
            });
            
            currentScanner = html5QrCode;
        }

        function onScanSuccess(decodedText, decodedResult) {
            // البحث عن المنتج باستخدام الباركود
            const product = db.products.find(p => p.barcode === decodedText);
            
            if (product) {
                document.getElementById('scannedProductDetails').innerHTML = `
                    <p><strong>المنتج:</strong> ${product.name}</p>
                    <p><strong>السعر:</strong> ${formatCurrency(product.price)}</p>
                    <p><strong>المخزون:</strong> ${product.quantity}</p>
                    <p><strong>الفئة:</strong> ${product.category}</p>
                `;
                document.getElementById('scannerResult').classList.add('active');
                
                // إيقاف الماسح مؤقتاً
                if (currentScanner) {
                    currentScanner.pause();
                }
            } else {
                showAlert('error', 'غير معروف', 'لم يتم العثور على منتج بهذا الباركود');
            }
        }

        function onScanError(error) {
            // تجاهل أخطاء المسح
        }

        function addScannedToCart() {
            const productDetails = document.getElementById('scannedProductDetails');
            const productName = productDetails.querySelector('p:nth-child(1)')?.textContent.split(':')[1]?.trim();
            
            if (productName) {
                const product = db.products.find(p => p.name === productName);
                if (product) {
                    addToCart(product.id, 1);
                    document.getElementById('scannerResult').classList.remove('active');
                    
                    // استئناف المسح
                    if (currentScanner) {
                        currentScanner.resume();
                    }
                }
            }
        }

        function stopScanner() {
            if (currentScanner) {
                currentScanner.stop().then(() => {
                    showAlert('success', 'تم', 'تم إيقاف الماسح');
                }).catch(err => {
                    console.error("Error stopping scanner", err);
                });
            }
        }

        function openScanner() {
            document.getElementById('scannerOverlay').classList.add('active');
            
            // تهيئة الماسح
            setTimeout(() => {
                const scannerElement = document.getElementById('scanner');
                scannerElement.innerHTML = '';
                
                const html5QrCode = new Html5Qrcode("scanner");
                
                const config = { 
                    fps: 10,
                    qrbox: { width: 250, height: 250 }
                };
                
                html5QrCode.start(
                    { facingMode: "environment" },
                    config,
                    (decodedText) => {
                        const product = db.products.find(p => p.barcode === decodedText);
                        if (product) {
                            addToCart(product.id, 1);
                            closeScanner();
                            showAlert('success', 'تم المسح', `تمت إضافة ${product.name} إلى السلة`);
                        } else {
                            showAlert('error', 'غير معروف', 'المنتج غير موجود في المخزون');
                        }
                    },
                    (error) => {
                        // تجاهل الأخطاء
                    }
                );
                
                window.scannerInstance = html5QrCode;
            }, 100);
        }

        function closeScanner() {
            if (window.scannerInstance) {
                window.scannerInstance.stop();
            }
            document.getElementById('scannerOverlay').classList.remove('active');
        }

        // ============================================
        // التقارير
        // ============================================

        function updateReports() {
            updateDailyReportChart();
            updateCategoryReportChart();
            updateProfitLossTable();
        }

        function updateDailyReportChart() {
            const period = document.getElementById('reportPeriod').value;
            let days = 7;
            
            if (period === 'month') days = 30;
            if (period === 'year') days = 365;
            
            const dates = [];
            const salesData = [];
            const profitData = [];
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('ar-SA'));
                
                const daySales = db.sales.filter(sale => {
                    const saleDate = new Date(sale.date).toDateString();
                    return saleDate === date.toDateString();
                });
                
                const totalSales = daySales.reduce((sum, sale) => sum + sale.total, 0);
                const totalProfit = daySales.reduce((sum, sale) => sum + sale.profit, 0);
                
                salesData.push(totalSales);
                profitData.push(totalProfit);
            }
            
            const ctx = document.getElementById('dailyReportChart').getContext('2d');
            
            if (charts.dailyReport) charts.dailyReport.destroy();
            
            charts.dailyReport = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'المبيعات',
                            data: salesData,
                            backgroundColor: 'rgba(139, 92, 246, 0.7)',
                            borderColor: '#8B5CF6',
                            borderWidth: 1
                        },
                        {
                            label: 'الربح',
                            data: profitData,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: '#10B981',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#94A3B8' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#94A3B8' }
                        }
                    }
                }
            });
        }

        function updateCategoryReportChart() {
            const categoryData = {};
            
            db.sales.forEach(sale => {
                sale.items.forEach(item => {
                    const product = db.products.find(p => p.id === item.productId);
                    if (product) {
                        categoryData[product.category] = (categoryData[product.category] || 0) + item.total;
                    }
                });
            });
            
            const ctx = document.getElementById('categoryReportChart').getContext('2d');
            
            if (charts.categoryReport) charts.categoryReport.destroy();
            
            charts.categoryReport = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{
                        data: Object.values(categoryData),
                        backgroundColor: [
                            '#8B5CF6', '#10B981', '#F59E0B', '#EF4444', '#3B82F6',
                            '#8B5CF6', '#10B981', '#F59E0B'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'left',
                            labels: { color: '#E2E8F0' }
                        }
                    }
                }
            });
        }

        function updateProfitLossTable() {
            const table = document.getElementById('profitLossTable');
            table.innerHTML = '';
            
            const period = document.getElementById('reportPeriod').value;
            let days = 7;
            
            if (period === 'month') days = 30;
            if (period === 'year') days = 365;
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                
                const daySales = db.sales.filter(sale => {
                    const saleDate = new Date(sale.date).toDateString();
                    return saleDate === date.toDateString();
                });
                
                const totalSales = daySales.reduce((sum, sale) => sum + sale.total, 0);
                const totalCost = daySales.reduce((sum, sale) => {
                    return sum + sale.items.reduce((itemSum, item) => {
                        const product = db.products.find(p => p.id === item.productId);
                        return itemSum + (product?.cost || 0) * item.quantity;
                    }, 0);
                }, 0);
                const grossProfit = totalSales - totalCost;
                const expenses = grossProfit * 0.1; // نفقات تقديرية 10%
                const netProfit = grossProfit - expenses;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${date.toLocaleDateString('ar-SA')}</td>
                    <td>${formatCurrency(totalSales)}</td>
                    <td>${formatCurrency(totalCost)}</td>
                    <td>${formatCurrency(grossProfit)}</td>
                    <td>${formatCurrency(expenses)}</td>
                    <td>${formatCurrency(netProfit)}</td>
                `;
                table.appendChild(row);
            }
        }

        function exportReport() {
            const period = document.getElementById('reportPeriod').value;
            const reportData = {
                period: period,
                generatedAt: new Date().toISOString(),
                sales: db.sales.filter(sale => {
                    if (period === 'week') {
                        const weekAgo = new Date();
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        return new Date(sale.date) >= weekAgo;
                    } else if (period === 'month') {
                        const monthAgo = new Date();
                        monthAgo.setMonth(monthAgo.getMonth() - 1);
                        return new Date(sale.date) >= monthAgo;
                    }
                    return true;
                }),
                summary: {
                    totalSales: db.sales.reduce((sum, sale) => sum + sale.total, 0),
                    totalProfit: db.sales.reduce((sum, sale) => sum + sale.profit, 0),
                    totalCustomers: db.customers.length,
                    totalProducts: db.products.length
                }
            };
            
            const dataStr = JSON.stringify(reportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', `تقرير_فواتير_${new Date().toISOString().split('T')[0]}.json`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('success', 'تم', 'تم تصدير التقرير بنجاح');
        }

        // ============================================
        // العملاء والمديونيات
        // ============================================

        function loadCustomersTable() {
            const table = document.getElementById('customersTable');
            table.innerHTML = '';
            
            db.customers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.phone || '-'}</td>
                    <td>
                        <span class="${(customer.balance || 0) > 0 ? 'text-red-400' : 'text-green-400'}">
                            ${formatCurrency(customer.balance || 0)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-secondary btn-small" onclick="editCustomer(${customer.id})">تعديل</button>
                        <button class="btn btn-danger btn-small" onclick="deleteCustomerRecord(${customer.id})">حذف</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const filteredCustomers = db.customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) ||
                (customer.phone && customer.phone.includes(searchTerm))
            );
            
            const table = document.getElementById('customersTable');
            table.innerHTML = '';
            
            filteredCustomers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.phone || '-'}</td>
                    <td>
                        <span class="${(customer.balance || 0) > 0 ? 'text-red-400' : 'text-green-400'}">
                            ${formatCurrency(customer.balance || 0)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-secondary btn-small" onclick="editCustomer(${customer.id})">تعديل</button>
                        <button class="btn btn-danger btn-small" onclick="deleteCustomerRecord(${customer.id})">حذف</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadDebtsTable() {
            const table = document.getElementById('debtsTable');
            table.innerHTML = '';
            
            const customersWithDebt = db.customers.filter(c => (c.balance || 0) > 0);
            
            customersWithDebt.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td class="text-red-400">${formatCurrency(customer.balance || 0)}</td>
                    <td>${customer.lastPayment ? new Date(customer.lastPayment).toLocaleDateString('ar-SA') : '-'}</td>
                    <td>
                        <span class="text-red-400 font-bold">مدين</span>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadPaymentsTable() {
            const table = document.getElementById('paymentsTable');
            table.innerHTML = '';
            
            const payments = [];
            db.sales.forEach(sale => {
                if (sale.paymentMethod === 'credit') {
                    payments.push({
                        date: sale.date,
                        customerName: sale.customerName,
                        amount: sale.total,
                        method: 'آجل'
                    });
                }
            });
            
            payments.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            payments.slice(0, 10).forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(payment.date).toLocaleDateString('ar-SA')}</td>
                    <td>${payment.customerName}</td>
                    <td>${formatCurrency(payment.amount)}</td>
                    <td>${payment.method}</td>
                `;
                table.appendChild(row);
            });
        }

        function openCustomerModal(customerId = null) {
            if (customerId) {
                // وضع التعديل
                const customer = db.customers.find(c => c.id === customerId);
                if (customer) {
                    document.getElementById('modalCustomerId').value = customer.id;
                    document.getElementById('modalCustomerName').value = customer.name;
                    document.getElementById('modalCustomerPhone').value = customer.phone || '';
                    document.getElementById('modalCustomerEmail').value = customer.email || '';
                    document.getElementById('modalCustomerAddress').value = customer.address || '';
                    document.getElementById('modalCustomerBalance').value = Math.abs(customer.balance || 0);
                }
            } else {
                // وضع الإضافة
                document.getElementById('modalCustomerId').value = '';
                document.getElementById('modalCustomerName').value = '';
                document.getElementById('modalCustomerPhone').value = '';
                document.getElementById('modalCustomerEmail').value = '';
                document.getElementById('modalCustomerAddress').value = '';
                document.getElementById('modalCustomerBalance').value = '0';
            }
            
            document.getElementById('customerModal').style.display = 'flex';
        }

        function saveCustomer() {
            const id = document.getElementById('modalCustomerId').value;
            const name = document.getElementById('modalCustomerName').value;
            const phone = document.getElementById('modalCustomerPhone').value;
            const email = document.getElementById('modalCustomerEmail').value;
            const address = document.getElementById('modalCustomerAddress').value;
            const balance = parseFloat(document.getElementById('modalCustomerBalance').value) || 0;
            
            if (!name) {
                showAlert('error', 'خطأ', 'يرجى إدخال اسم العميل');
                return;
            }
            
            if (id) {
                // تحديث العميل
                const index = db.customers.findIndex(c => c.id == id);
                if (index !== -1) {
                    db.customers[index] = {
                        ...db.customers[index],
                        name,
                        phone,
                        email,
                        address,
                        balance: balance
                    };
                }
            } else {
                // إضافة عميل جديد
                const newId = db.customers.length > 0 ? Math.max(...db.customers.map(c => c.id)) + 1 : 1;
                db.customers.push({
                    id: newId,
                    name,
                    phone,
                    email,
                    address,
                    balance: balance,
                    createdAt: new Date().toISOString()
                });
            }
            
            saveData();
            loadCustomersTable();
            updateCustomerSelect();
            loadDebtsTable();
            
            document.getElementById('customerModal').style.display = 'none';
            showAlert('success', 'تم', 'تم حفظ بيانات العميل بنجاح');
        }

        function deleteCustomerRecord(customerId) {
            // التحقق من وجود فواتير مرتبطة
            const hasSales = db.sales.some(sale => sale.customerId === customerId);
            
            if (hasSales) {
                showAlert('error', 'خطأ', 'لا يمكن حذف عميل لديه فواتير مرتبطة');
                return;
            }
            
            if (confirm('هل أنت متأكد من حذف هذا العميل؟')) {
                db.customers = db.customers.filter(c => c.id !== customerId);
                saveData();
                loadCustomersTable();
                updateCustomerSelect();
                showAlert('success', 'تم', 'تم حذف العميل بنجاح');
            }
        }

        function editCustomer(customerId) {
            openCustomerModal(customerId);
        }

        function openPaymentModal() {
            document.getElementById('paymentModal').style.display = 'flex';
        }

        function updateCustomerSelect() {
            const select = document.getElementById('customerSelect');
            select.innerHTML = '<option value="walkin">زبون مباشر</option>';
            
            db.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} ${customer.balance ? `(${formatCurrency(customer.balance)})` : ''}`;
                select.appendChild(option);
            });
        }

        // ============================================
        // الإعدادات
        // ============================================

        function loadStoreSettings() {
            document.getElementById('storeName').value = db.settings.storeName || '';
            document.getElementById('storeAddress').value = db.settings.storeAddress || '';
            document.getElementById('storePhone').value = db.settings.storePhone || '';
            document.getElementById('taxRateSetting').value = db.settings.taxRate || 14;
        }

        function saveStoreSettings() {
            db.settings.storeName = document.getElementById('storeName').value;
            db.settings.storeAddress = document.getElementById('storeAddress').value;
            db.settings.storePhone = document.getElementById('storePhone').value;
            db.settings.taxRate = parseFloat(document.getElementById('taxRateSetting').value) || 14;
            
            saveData();
            showAlert('success', 'تم', 'تم حفظ الإعدادات بنجاح');
        }

        function exportData() {
            const exportData = {
                exportedAt: new Date().toISOString(),
                products: db.products,
                customers: db.customers,
                sales: db.sales,
                settings: db.settings
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', `نسخة_احتياطية_فواتير_${new Date().toISOString().split('T')[0]}.json`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('success', 'تم', 'تم تصدير جميع البيانات بنجاح');
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('error', 'خطأ', 'يرجى اختيار ملف للاستيراد');
                return;
            }
            
            if (!confirm('تحذير: هذا سوف يستبدل جميع البيانات الحالية. هل أنت متأكد؟')) {
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    db.products = importedData.products || [];
                    db.customers = importedData.customers || [];
                    db.sales = importedData.sales || [];
                    db.settings = importedData.settings || {};
                    
                    saveData();
                    
                    // تحديث جميع الواجهات
                    loadInventoryTable();
                    loadCustomersTable();
                    loadDebtsTable();
                    updateProductSelect();
                    updateCustomerSelect();
                    updateStats();
                    loadStoreSettings();
                    
                    showAlert('success', 'تم', 'تم استيراد البيانات بنجاح');
                    
                    // إعادة تعيين مدخل الملف
                    fileInput.value = '';
                } catch (error) {
                    showAlert('error', 'خطأ', 'خطأ في قراءة الملف. تأكد من صحة تنسيق JSON');
                }
            };
            
            reader.readAsText(file);
        }

        function resetSystem() {
            if (!confirm('تحذير: هذا سوف يحذف جميع البيانات بشكل دائم. هل أنت متأكد؟')) {
                return;
            }
            
            if (!confirm('للتأكيد النهائي، اكتب "نعم" في الحقل التالي:')) {
                return;
            }
            
            const confirmation = prompt('اكتب "نعم" للحذف:');
            if (confirmation !== 'نعم') {
                return;
            }
            
            // حذف جميع البيانات
            localStorage.removeItem('fawateer_products');
            localStorage.removeItem('fawateer_customers');
            localStorage.removeItem('fawateer_sales');
            localStorage.removeItem('fawateer_settings');
            
            // إعادة تعيين قاعدة البيانات
            db.products = [];
            db.customers = [];
            db.sales = [];
            db.settings = {
                storeName: 'متجري',
                storeAddress: '',
                storePhone: '',
                taxRate: 14
            };
            
            // إعادة تعيين السلة
            cart = [];
            
            // تحديث الواجهات
            loadInventoryTable();
            loadCustomersTable();
            updateProductSelect();
            updateCustomerSelect();
            updateStats();
            loadStoreSettings();
            
            showAlert('success', 'تم', 'تم إعادة تعيين النظام بنجاح');
            showWelcomeGuide();
        }

        // ============================================
        // أدوات مساعدة
        // ============================================

        function formatCurrency(amount) {
            return new Intl.NumberFormat('ar-EG', {
                style: 'currency',
                currency: 'EGP',
                minimumFractionDigits: 2
            }).format(amount);
        }

        function quickAction() {
            showPage('pos');
        }

        // ============================================
        // تهيئة النظام
        // ============================================

        // إنشاء عناصر النماذج الديناميكية
        function createModals() {
            // نموذج المنتج
            const productModal = document.createElement('div');
            productModal.id = 'productModal';
            productModal.className = 'scanner-container';
            productModal.style.display = 'none';
            productModal.innerHTML = `
                <div class="card-3d" style="max-width: 500px; width: 90%;">
                    <div class="card-header">
                        <h3 class="card-title" id="productModalTitle">إضافة منتج جديد</h3>
                        <button class="btn btn-secondary btn-small" onclick="document.getElementById('productModal').style.display = 'none'">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <input type="hidden" id="modalProductId">
                    
                    <div class="form-group">
                        <label class="form-label">اسم المنتج *</label>
                        <input type="text" class="form-input" id="modalProductName" placeholder="أدخل اسم المنتج">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">الفئة *</label>
                            <select class="select-input" id="modalProductCategory">
                                <option value="سوبرماركت">سوبرماركت</option>
                                <option value="أدوات صحية">أدوات صحية</option>
                                <option value="أدوات كهربائية">أدوات كهربائية</option>
                                <option value="مواد بناء">مواد بناء</option>
                                <option value="مستلزمات مكتبية">مستلزمات مكتبية</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">سعر البيع (ج.م) *</label>
                            <input type="number" class="form-input" id="modalProductPrice" placeholder="0.00" step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">سعر الشراء (ج.م)</label>
                            <input type="number" class="form-input" id="modalProductCost" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">الكمية في المخزون *</label>
                            <input type="number" class="form-input" id="modalProductQuantity" placeholder="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">حد التنبيه بالكمية</label>
                            <input type="number" class="form-input" id="modalProductLowStock" placeholder="5" value="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">رقم الباركود</label>
                            <input type="text" class="form-input" id="modalProductBarcode" placeholder="اتركه فارغاً للإنشاء التلقائي">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button class="btn btn-primary flex-1" onclick="saveProduct()">حفظ المنتج</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('productModal').style.display = 'none'">إلغاء</button>
                    </div>
                </div>
            `;
            document.body.appendChild(productModal);
            
            // نموذج العميل
            const customerModal = document.createElement('div');
            customerModal.id = 'customerModal';
            customerModal.className = 'scanner-container';
            customerModal.style.display = 'none';
            customerModal.innerHTML = `
                <div class="card-3d" style="max-width: 500px; width: 90%;">
                    <div class="card-header">
                        <h3 class="card-title" id="customerModalTitle">إضافة عميل جديد</h3>
                        <button class="btn btn-secondary btn-small" onclick="document.getElementById('customerModal').style.display = 'none'">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <input type="hidden" id="modalCustomerId">
                    
                    <div class="form-group">
                        <label class="form-label">اسم العميل *</label>
                        <input type="text" class="form-input" id="modalCustomerName" placeholder="أدخل اسم العميل">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">رقم الهاتف</label>
                            <input type="text" class="form-input" id="modalCustomerPhone" placeholder="أدخل رقم الهاتف">
                        </div>
                        <div class="form-group">
                            <label class="form-label">البريد الإلكتروني</label>
                            <input type="email" class="form-input" id="modalCustomerEmail" placeholder="أدخل البريد الإلكتروني">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">العنوان</label>
                        <textarea class="form-input" id="modalCustomerAddress" rows="3" placeholder="أدخل العنوان"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">الرصيد الحالي (ج.م)</label>
                        <input type="number" class="form-input" id="modalCustomerBalance" placeholder="0.00" step="0.01">
                        <small class="text-gray-400">أدخل الرصيد الإيجابي للدين، والسالب للرصيد الدائن</small>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button class="btn btn-primary flex-1" onclick="saveCustomer()">حفظ العميل</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('customerModal').style.display = 'none'">إلغاء</button>
                    </div>
                </div>
            `;
            document.body.appendChild(customerModal);
            
            // نموذج السداد
            const paymentModal = document.createElement('div');
            paymentModal.id = 'paymentModal';
            paymentModal.className = 'scanner-container';
            paymentModal.style.display = 'none';
            paymentModal.innerHTML = `
                <div class="card-3d" style="max-width: 400px; width: 90%;">
                    <div class="card-header">
                        <h3 class="card-title">سداد دفعة</h3>
                        <button class="btn btn-secondary btn-small" onclick="document.getElementById('paymentModal').style.display = 'none'">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">العميل</label>
                        <select class="select-input" id="paymentCustomerSelect">
                            <option value="">اختر العميل</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">المبلغ (ج.م) *</label>
                        <input type="number" class="form-input" id="paymentAmount" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">طريقة السداد</label>
                        <select class="select-input" id="paymentMethodSelect">
                            <option value="cash">نقدي</option>
                            <option value="transfer">تحويل بنكي</option>
                            <option value="check">شيك</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ملاحظات</label>
                        <textarea class="form-input" id="paymentNotes" rows="3" placeholder="ملاحظات إضافية"></textarea>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button class="btn btn-success flex-1" onclick="processPayment()">تسجيل السداد</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('paymentModal').style.display = 'none'">إلغاء</button>
                    </div>
                </div>
            `;
            document.body.appendChild(paymentModal);
        }

        // ============================================
        // تهيئة الصفحة
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            // إنشاء النماذج الديناميكية
            createModals();
            
            // إعداد مستمعي الأحداث
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                login(username, password);
            });
            
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // إعداد التنقل
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });
            
            // تهيئة المصادقة
            initAuth();
            
            // تهيئة حقول الدفع
            togglePaymentFields();
            
            // إضافة تأثيرات اللمس
            document.querySelectorAll('.btn, .card-3d, .nav-link').forEach(element => {
                element.addEventListener('touchstart', function(e) {
                    const touch = e.touches[0];
                    const ripple = document.createElement('div');
                    ripple.className = 'touch-effect';
                    ripple.style.left = (touch.clientX - this.getBoundingClientRect().left) + 'px';
                    ripple.style.top = (touch.clientY - this.getBoundingClientRect().top) + 'px';
                    this.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 600);
                });
            });
        });

        // ============================================
        // وظائف عامة للوصول من HTML
        // ============================================

        window.showPage = showPage;
        window.openProductModal = openProductModal;
        window.openCustomerModal = openCustomerModal;
        window.openPaymentModal = openPaymentModal;
        window.openScanner = openScanner;
        window.closeScanner = closeScanner;
        window.clearCart = clearCart;
        window.completeSale = completeSale;
        window.previewInvoice = previewInvoice;
        window.hideWelcomeGuide = hideWelcomeGuide;
        window.quickAction = quickAction;
        window.exportData = exportData;
        window.importData = importData;
        window.resetSystem = resetSystem;
        window.saveStoreSettings = saveStoreSettings;
        window.exportReport = exportReport;
    </script>
</body>
</html>
