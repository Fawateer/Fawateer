<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام فواتير - نظام إدارة متكامل</title>
    
    <!-- الخطوط -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- مكتبات خارجية -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        /* متغيرات التصميم */
        :root {
            --primary: #8B5CF6;
            --primary-dark: #7C3AED;
            --primary-light: #A78BFA;
            --secondary: #10B981;
            --secondary-dark: #059669;
            --accent: #F59E0B;
            --danger: #EF4444;
            --danger-dark: #DC2626;
            --warning: #F59E0B;
            --success: #10B981;
            --dark-1: #0F172A;
            --dark-2: #1E293B;
            --dark-3: #334155;
            --light-1: #F8FAFC;
            --light-2: #E2E8F0;
            --glass: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.12);
            --shadow-3d: 0 20px 60px rgba(0, 0, 0, 0.4), 
                         0 0 0 1px rgba(255, 255, 255, 0.05),
                         inset 0 1px 0 rgba(255, 255, 255, 0.1);
            --shadow-float: 0 30px 80px rgba(139, 92, 246, 0.3);
            --radius-xl: 24px;
            --radius-lg: 20px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* تصميم عام */
        body {
            background: linear-gradient(135deg, var(--dark-1) 0%, #1a1a2e 100%);
            color: var(--light-1);
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        /* شاشة تسجيل الدخول */
        .login-container {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--dark-1) 0%, #1a1a2e 100%);
            z-index: 9999;
            transition: var(--transition-slow);
        }

        .login-container.hidden {
            opacity: 0;
            visibility: hidden;
            transform: translateY(-20px);
        }

        .login-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 48px 40px;
            width: 90%;
            max-width: 440px;
            transform-style: preserve-3d;
            transform: perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0);
            box-shadow: var(--shadow-3d);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0) translateY(0px); }
            50% { transform: perspective(1000px) rotateX(1deg) rotateY(-1deg) translateZ(20px) translateY(-10px); }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 40px;
            transform-style: preserve-3d;
        }

        .login-logo .logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transform: translateZ(30px);
            box-shadow: var(--shadow-float);
        }

        .login-logo .logo-icon svg {
            width: 40px;
            height: 40px;
            color: white;
        }

        .login-logo h1 {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-light) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transform: translateZ(20px);
        }

        .login-logo p {
            color: var(--light-2);
            font-size: 16px;
            margin-top: 8px;
            transform: translateZ(10px);
        }

        .form-group {
            margin-bottom: 24px;
            transform-style: preserve-3d;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--light-2);
            transform: translateZ(15px);
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-md);
            color: var(--light-1);
            font-size: 16px;
            transition: var(--transition);
            transform: translateZ(0);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
            transform: translateZ(10px);
        }

        .btn {
            padding: 16px 32px;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transform-style: preserve-3d;
            position: relative;
            overflow: hidden;
        }

        .btn:active {
            transform: translateZ(0) scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .btn-primary:hover {
            transform: translateZ(10px);
            box-shadow: var(--shadow-float);
        }

        .btn-block {
            width: 100%;
        }

        /* رابط إنشاء حساب */
        .create-account-link {
            text-align: center;
            margin-top: 24px;
            color: var(--light-2);
            font-size: 14px;
        }

        .create-account-link a {
            color: var(--primary-light);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .create-account-link a:hover {
            color: white;
            text-decoration: underline;
        }

        /* نافذة إنشاء حساب */
        .create-account-modal {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
        }

        .create-account-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .create-account-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 40px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform-style: preserve-3d;
            box-shadow: var(--shadow-3d);
        }

        .create-account-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .create-account-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--light-1);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--light-2);
            cursor: pointer;
            font-size: 20px;
            transition: var(--transition);
        }

        .close-btn:hover {
            color: var(--primary-light);
        }

        .password-strength {
            margin-top: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .password-strength-bar {
            flex: 1;
            height: 4px;
            background: var(--dark-3);
            border-radius: 2px;
            overflow: hidden;
        }

        .password-strength-fill {
            height: 100%;
            width: 0%;
            background: var(--danger);
            transition: width 0.3s ease;
        }

        .password-strength-fill.weak { width: 25%; background: var(--danger); }
        .password-strength-fill.fair { width: 50%; background: var(--warning); }
        .password-strength-fill.good { width: 75%; background: var(--accent); }
        .password-strength-fill.strong { width: 100%; background: var(--success); }

        .password-requirements {
            margin-top: 12px;
            font-size: 12px;
            color: var(--light-2);
        }

        .password-requirements ul {
            list-style: none;
            padding-right: 20px;
        }

        .password-requirements li {
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .password-requirements li.valid {
            color: var(--success);
        }

        .password-requirements li.invalid {
            color: var(--light-2);
        }

        /* التصميم الرئيسي */
        .app-container {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .app-container.visible {
            display: block;
            opacity: 1;
        }

        /* شريط التنقل العلوي */
        .top-nav {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 16px 24px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transform-style: preserve-3d;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateZ(20px);
        }

        .nav-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        .nav-logo svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .nav-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-info {
            text-align: left;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-role {
            font-size: 12px;
            color: var(--light-2);
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: translateY(-2px);
        }

        /* قائمة التنقل الجانبية */
        .sidebar {
            position: fixed;
            top: 73px;
            right: 0;
            width: 280px;
            height: calc(100vh - 73px);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--glass-border);
            padding: 24px;
            overflow-y: auto;
            transform-style: preserve-3d;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: var(--radius-md);
            color: var(--light-2);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            transform-style: preserve-3d;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light-1);
            transform: translateX(-8px) translateZ(10px);
        }

        .nav-link.active {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(124, 58, 237, 0.1) 100%);
            color: var(--primary-light);
            border-left: 3px solid var(--primary);
        }

        .nav-link svg {
            width: 20px;
            height: 20px;
        }

        /* المحتوى الرئيسي */
        .main-content {
            margin-right: 280px;
            margin-top: 73px;
            padding: 24px;
            min-height: calc(100vh - 73px);
        }

        /* بطاقات ثلاثية الأبعاد */
        .card-3d {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-3d);
            transform-style: preserve-3d;
            transition: var(--transition);
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .card-3d:hover {
            transform: translateY(-10px) translateZ(20px);
            box-shadow: var(--shadow-float);
        }

        .card-3d:active {
            transform: translateY(-5px) translateZ(10px) scale(0.98);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--glass-border);
            transform: translateZ(20px);
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title svg {
            width: 24px;
            height: 24px;
            color: var(--primary-light);
        }

        /* الشبكة */
        .grid {
            display: grid;
            gap: 24px;
        }

        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

        /* بطاقات الإحصائيات */
        .stat-card {
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            transform: translateZ(30px);
        }

        .stat-icon svg {
            width: 32px;
            height: 32px;
            color: white;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 4px;
            background: linear-gradient(135deg, white 0%, var(--light-2) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transform: translateZ(20px);
        }

        .stat-label {
            color: var(--light-2);
            font-size: 14px;
            transform: translateZ(10px);
        }

        /* الأزرار */
        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light-1);
            border: 1px solid var(--glass-border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px) translateZ(10px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #D97706 100%);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* الجداول */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-lg);
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.2);
            transform-style: preserve-3d;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px 20px;
            text-align: right;
            font-weight: 700;
            color: var(--light-2);
            border-bottom: 1px solid var(--glass-border);
            transform: translateZ(10px);
        }

        .data-table td {
            padding: 14px 20px;
            border-bottom: 1px solid var(--glass-border);
            transform: translateZ(5px);
            transition: var(--transition);
        }

        .data-table tr:hover td {
            background: rgba(255, 255, 255, 0.03);
            transform: translateZ(10px);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* النماذج */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* زر الفعل العائم */
        .fab {
            position: fixed;
            bottom: 32px;
            left: 32px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: var(--shadow-float);
            transition: var(--transition);
            z-index: 100;
            transform-style: preserve-3d;
            animation: pulse 2s infinite;
        }

        .fab:hover {
            transform: scale(1.1) translateZ(20px);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.4);
        }

        .fab:active {
            transform: scale(0.95) translateZ(10px);
        }

        .fab svg {
            width: 28px;
            height: 28px;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }

        /* الماسح الضوئي */
        .scanner-overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .scanner-overlay.active {
            display: flex;
        }

        .scanner-container {
            width: 90%;
            max-width: 600px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-3d);
            transform-style: preserve-3d;
        }

        #qr-reader {
            width: 100%;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 24px;
            transform: translateZ(20px);
        }

        .scanner-result {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .scanner-result.active {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* القوائم المنسدلة */
        .select-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-md);
            color: var(--light-1);
            font-size: 16px;
            transition: var(--transition);
            cursor: pointer;
        }

        .select-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
        }

        /* الصفحات المخفية */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* الدليل الأول */
        .welcome-guide {
            text-align: center;
            padding: 60px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .guide-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            transform: translateZ(40px);
            box-shadow: var(--shadow-float);
        }

        .guide-icon svg {
            width: 60px;
            height: 60px;
            color: white;
        }

        .guide-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary-light) 0%, white 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .guide-text {
            color: var(--light-2);
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .guide-steps {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }

        .guide-step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: right;
            transition: var(--transition);
            cursor: pointer;
        }

        .guide-step:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-10px);
        }

        .guide-step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 20px;
            margin-bottom: 12px;
        }

        .guide-step-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--light-1);
        }

        .guide-step-desc {
            color: var(--light-2);
            font-size: 14px;
            line-height: 1.5;
        }

        /* الفاتورة */
        .invoice-preview {
            background: white;
            color: #1E293B;
            padding: 40px;
            border-radius: var(--radius-xl);
            max-width: 500px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .invoice-header {
            text-align: center;
            border-bottom: 2px dashed #CBD5E1;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .invoice-store {
            font-size: 28px;
            font-weight: 900;
            color: var(--dark-1);
            margin-bottom: 8px;
        }

        .invoice-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--dark-3);
        }

        .invoice-items {
            margin-bottom: 30px;
        }

        .invoice-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #E2E8F0;
        }

        .invoice-totals {
            border-top: 2px solid var(--dark-1);
            padding-top: 20px;
            margin-top: 20px;
        }

        .invoice-total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .invoice-grand-total {
            font-size: 24px;
            font-weight: 900;
            color: var(--primary);
        }

        /* التنبيهات */
        .alert {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%) translateZ(50px);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-3d);
            z-index: 2000;
            display: none;
            align-items: center;
            gap: 16px;
            min-width: 300px;
            max-width: 400px;
            animation: slideDown 0.3s ease;
        }

        .alert.active {
            display: flex;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px) translateZ(50px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0) translateZ(50px); }
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .alert-success .alert-icon {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .alert-error .alert-icon {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .alert-warning .alert-icon {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .alert-info .alert-icon {
            background: rgba(139, 92, 246, 0.2);
            color: var(--primary);
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .alert-message {
            font-size: 14px;
            color: var(--light-2);
        }

        /* التجاوب */
        @media (max-width: 1200px) {
            .grid-cols-4 { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .grid-cols-2, .grid-cols-3, .grid-cols-4 {
                grid-template-columns: repeat(1, 1fr);
            }
            
            .form-row {
                flex-direction: column;
                gap: 16px;
            }
            
            .login-card {
                padding: 32px 24px;
            }
        }

        /* تأثيرات اللمس */
        .touch-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* أداة التحميل */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--glass-border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- شاشة تسجيل الدخول -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <h1>نظام فواتير</h1>
                <p>نظام إدارة متكامل للمتاجر والمحلات</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">اسم المستخدم</label>
                    <input type="text" class="form-input" id="username" placeholder="أدخل اسم المستخدم" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-input" id="password" placeholder="أدخل كلمة المرور" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block" id="loginBtn">
                    <span>تسجيل الدخول</span>
                </button>
                
                <div class="create-account-link">
                    <span>ليس لديك حساب؟</span>
                    <a id="showCreateAccount">إنشاء حساب جديد</a>
                </div>
                
                <div class="form-group" style="text-align: center; margin-top: 20px;">
                    <small style="color: var(--light-2);">
                        للمستخدمين الجدد: يمكنك إنشاء حساب جديد
                    </small>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة إنشاء حساب جديد -->
    <div class="create-account-modal" id="createAccountModal">
        <div class="create-account-card">
            <div class="create-account-header">
                <h2 class="create-account-title">إنشاء حساب جديد</h2>
                <button class="close-btn" id="closeCreateAccount">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <form id="createAccountForm">
                <div class="form-group">
                    <label class="form-label">الاسم الكامل *</label>
                    <input type="text" class="form-input" id="fullName" placeholder="أدخل اسمك الكامل" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">اسم المستخدم *</label>
                    <input type="text" class="form-input" id="newUsername" placeholder="اختر اسم مستخدم" required>
                    <small style="color: var(--light-2); font-size: 12px; display: block; margin-top: 4px;">
                        يجب أن يكون اسم المستخدم فريداً وغير مستخدم من قبل
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-input" id="email" placeholder="أدخل بريدك الإلكتروني">
                </div>
                
                <div class="form-group">
                    <label class="form-label">رقم الهاتف</label>
                    <input type="tel" class="form-input" id="phone" placeholder="أدخل رقم هاتفك">
                </div>
                
                <div class="form-group">
                    <label class="form-label">كلمة المرور *</label>
                    <input type="password" class="form-input" id="newPassword" placeholder="اختر كلمة مرور قوية" required>
                    <div class="password-strength">
                        <span>قوة الكلمة:</span>
                        <div class="password-strength-bar">
                            <div class="password-strength-fill" id="passwordStrengthFill"></div>
                        </div>
                        <span id="passwordStrengthText">ضعيفة</span>
                    </div>
                    <div class="password-requirements">
                        <ul>
                            <li id="reqLength" class="invalid">• 8 أحرف على الأقل</li>
                            <li id="reqUpper" class="invalid">• تحتوي على حرف كبير</li>
                            <li id="reqLower" class="invalid">• تحتوي على حرف صغير</li>
                            <li id="reqNumber" class="invalid">• تحتوي على رقم</li>
                            <li id="reqSpecial" class="invalid">• تحتوي على رمز خاص</li>
                        </ul>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">تأكيد كلمة المرور *</label>
                    <input type="password" class="form-input" id="confirmPassword" placeholder="أعد إدخال كلمة المرور" required>
                    <small id="passwordMatch" style="color: var(--danger); font-size: 12px; display: none; margin-top: 4px;">
                        كلمتا المرور غير متطابقتين
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">نوع الحساب *</label>
                    <select class="form-input" id="accountType" required>
                        <option value="">اختر نوع الحساب</option>
                        <option value="owner">مالك/مدير</option>
                        <option value="admin">مسؤول نظام</option>
                        <option value="cashier">كاشير/بائع</option>
                        <option value="inventory">مسؤول مخزون</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="termsAgreement" required style="width: 16px; height: 16px;">
                        <span style="font-size: 14px;">أوافق على <a href="#" style="color: var(--primary-light);">الشروط والأحكام</a> و <a href="#" style="color: var(--primary-light);">سياسة الخصوصية</a></span>
                    </label>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block" id="createAccountBtn">
                        <span>إنشاء الحساب</span>
                    </button>
                </div>
                
                <div class="create-account-link">
                    <span>لديك حساب بالفعل؟</span>
                    <a id="backToLogin">العودة لتسجيل الدخول</a>
                </div>
            </form>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div class="app-container" id="appContainer">
        <!-- شريط التنقل العلوي -->
        <nav class="top-nav">
            <div class="nav-brand">
                <div class="nav-logo">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <div class="nav-title">نظام فواتير</div>
            </div>
            
            <div class="nav-user">
                <div class="user-info">
                    <div class="user-name" id="currentUser">المسؤول</div>
                    <div class="user-role">مدير النظام</div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                    <span>تسجيل خروج</span>
                </button>
            </div>
        </nav>

        <!-- القائمة الجانبية -->
        <aside class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-page="dashboard">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                        <span>لوحة التحكم</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="pos">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3zm0 10c-2.76 0-5-2.24-5-5h2c0 1.66 1.34 3 3 3s3-1.34 3-3h2c0 2.76-2.24 5-5 5z"/>
                        </svg>
                        <span>نقطة البيع</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="inventory">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
                        </svg>
                        <span>إدارة المخزون</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="scanner">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2 6h4v12H2zm5 0h4v12H7zm5 0h4v12h-4zm5 0h4v12h-4z"/>
                        </svg>
                        <span>ماسح الباركود</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="reports">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span>التقارير</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="customers">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                        </svg>
                        <span>عملاء ومديونيات</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="settings">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                        </svg>
                        <span>الإعدادات</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <!-- صفحة لوحة التحكم -->
            <div class="page active" id="dashboard">
                <!-- دليل الترحيب -->
                <div class="card-3d" id="welcomeGuide" style="display: none;">
                    <div class="welcome-guide">
                        <div class="guide-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <h2 class="guide-title">مرحباً بك في نظام فواتير!</h2>
                        <p class="guide-text">
                            نظام إدارة متكامل لمحلات السوبر ماركت والأدوات الصحية والكهربائية.
                            ابدأ بإضافة منتجاتك الأولى لعرض الإحصائيات والتقارير.
                        </p>
                        
                        <div class="guide-steps">
                            <div class="guide-step" onclick="showPage('inventory')">
                                <div class="guide-step-number">1</div>
                                <div class="guide-step-title">إضافة المنتجات</div>
                                <div class="guide-step-desc">أضف منتجاتك مع الأسعار والكميات والأكواد</div>
                            </div>
                            <div class="guide-step" onclick="showPage('customers')">
                                <div class="guide-step-number">2</div>
                                <div class="guide-step-title">تسجيل العملاء</div>
                                <div class="guide-step-desc">سجل عملائك مع بيانات التواصل والمديونيات</div>
                            </div>
                            <div class="guide-step" onclick="showPage('pos')">
                                <div class="guide-step-number">3</div>
                                <div class="guide-step-title">إتمام أول بيع</div>
                                <div class="guide-step-desc">ابدأ بيع المنتجات وإنشاء الفواتير</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="hideWelcomeGuide()">
                            <span>بدأ الاستخدام</span>
                        </button>
                    </div>
                </div>

                <!-- إحصائيات النظام -->
                <div class="grid grid-cols-4" id="statsContainer" style="display: none;">
                    <div class="card-3d stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/>
                            </svg>
                        </div>
                        <div class="stat-value" id="totalSales">0 ج.م</div>
                        <div class="stat-label">إجمالي المبيعات اليوم</div>
                    </div>
                    
                    <div class="card-3d stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4z"/>
                            </svg>
                        </div>
                        <div class="stat-value" id="totalProfit">0 ج.م</div>
                        <div class="stat-label">صافي الربح اليوم</div>
                    </div>
                    
                    <div class="card-3d stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                            </svg>
                        </div>
                        <div class="stat-value" id="lowStock">0</div>
                        <div class="stat-label">منتجات منخفضة المخزون</div>
                    </div>
                    
                    <div class="card-3d stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                        </div>
                        <div class="stat-value" id="totalDebt">0 ج.م</div>
                        <div class="stat-label">إجمالي المديونيات</div>
                    </div>
                </div>

                <!-- الرسوم البيانية -->
                <div class="grid grid-cols-2" id="chartsContainer" style="display: none;">
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                                </svg>
                                <span>مبيعات آخر 7 أيام</span>
                            </h3>
                        </div>
                        <canvas id="salesChart" height="250"></canvas>
                    </div>
                    
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M11 2v20c-5.07-.5-9-4.79-9-10s3.93-9.5 9-10zm2.03 0v8.99H22c-.47-4.74-4.24-8.52-8.97-8.99zm0 11.01V22c4.74-.47 8.5-4.25 8.97-8.99h-8.97z"/>
                                </svg>
                                <span>توزيع المبيعات</span>
                            </h3>
                        </div>
                        <canvas id="categoriesChart" height="250"></canvas>
                    </div>
                </div>

                <!-- آخر المبيعات -->
                <div class="card-3d" id="recentSalesContainer" style="display: none;">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4z"/>
                            </svg>
                            <span>آخر المعاملات</span>
                        </h3>
                        <button class="btn btn-secondary btn-small" onclick="showPage('pos')">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            <span>بيع جديد</span>
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>رقم الفاتورة</th>
                                    <th>التاريخ</th>
                                    <th>العميل</th>
                                    <th>المبلغ</th>
                                    <th>الحالة</th>
                                </tr>
                            </thead>
                            <tbody id="recentSales">
                                <!-- البيانات تظهر هنا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- صفحة نقطة البيع -->
            <div class="page" id="pos">
                <div class="grid grid-cols-3">
                    <div class="card-3d" style="grid-column: span 2;">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3zm0 10c-2.76 0-5-2.24-5-5h2c0 1.66 1.34 3 3 3s3-1.34 3-3h2c0 2.76-2.24 5-5 5z"/>
                                </svg>
                                <span>نقطة البيع</span>
                            </h3>
                            <div class="flex gap-2">
                                <button class="btn btn-secondary btn-small" onclick="openScanner()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M2 6h4v12H2zm5 0h4v12H7zm5 0h4v12h-4zm5 0h4v12h-4z"/>
                                    </svg>
                                    <span>مسح باركود</span>
                                </button>
                                <button class="btn btn-danger btn-small" onclick="clearCart()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                    </svg>
                                    <span>تفريغ السلة</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- البحث السريع -->
                        <div class="form-group">
                            <input type="text" class="form-input" id="productSearch" 
                                   placeholder="ابحث عن منتج بالاسم أو الباركود" 
                                   onkeyup="searchProducts(event)">
                        </div>
                        
                        <!-- سلة المشتريات -->
                        <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>المنتج</th>
                                        <th>السعر</th>
                                        <th>الكمية</th>
                                        <th>الإجمالي</th>
                                        <th>إجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="cartItems">
                                    <!-- عناصر السلة تظهر هنا -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- إضافة منتج يدوي -->
                        <div class="form-row mt-4">
                            <div class="form-group">
                                <select class="select-input" id="productSelect" onchange="addSelectedProduct()">
                                    <option value="">اختر منتج للإضافة</option>
                                </select>
                            </div>
                            <div class="form-group" style="max-width: 120px;">
                                <input type="number" class="form-input" id="productQty" value="1" min="1">
                            </div>
                            <button class="btn btn-primary" onclick="addProductManually()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>إضافة</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- ملخص الفاتورة -->
                    <div class="card-3d">
                        <h3 class="card-title mb-4">ملخص الفاتورة</h3>
                        
                        <div class="form-group">
                            <label class="form-label">العميل</label>
                            <select class="select-input" id="customerSelect">
                                <option value="walkin">زبون مباشر</option>
                            </select>
                        </div>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between">
                                <span>الإجمالي الفرعي:</span>
                                <span id="subtotal">0 ج.م</span>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">الضريبة (%)</label>
                                    <input type="number" class="form-input" id="taxRate" value="14" min="0" max="100" onchange="updateInvoice()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">الخصم (ج.م)</label>
                                    <input type="number" class="form-input" id="discount" value="0" min="0" onchange="updateInvoice()">
                                </div>
                            </div>
                            
                            <div class="flex justify-between">
                                <span>الضريبة:</span>
                                <span id="taxAmount">0 ج.م</span>
                            </div>
                            
                            <div class="flex justify-between">
                                <span>الخصم:</span>
                                <span id="discountAmount">0 ج.م</span>
                            </div>
                            
                            <div class="flex justify-between text-lg font-bold border-t border-gray-700 pt-3 mt-3">
                                <span>الإجمالي النهائي:</span>
                                <span id="totalAmount">0 ج.م</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">طريقة الدفع</label>
                            <select class="select-input" id="paymentMethod" onchange="togglePaymentFields()">
                                <option value="cash">نقدي</option>
                                <option value="card">بطاقة</option>
                                <option value="credit">آجل</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="cashFields">
                            <label class="form-label">المبلغ المدفوع</label>
                            <input type="number" class="form-input" id="amountPaid" value="0" min="0" onchange="updateChange()">
                        </div>
                        
                        <div class="flex justify-between mb-6" id="changeField">
                            <span>الباقي:</span>
                            <span id="changeAmount">0 ج.م</span>
                        </div>
                        
                        <button class="btn btn-success w-full mb-3" onclick="completeSale()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            <span>إتمام البيع</span>
                        </button>
                        
                        <button class="btn btn-secondary w-full" onclick="previewInvoice()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                                <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                            </svg>
                            <span>معاينة الفاتورة</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- صفحة إدارة المخزون -->
            <div class="page" id="inventory">
                <div class="card-3d">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
                            </svg>
                            <span>إدارة المخزون</span>
                        </h3>
                        <button class="btn btn-primary" onclick="openProductModal()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            <span>إضافة منتج</span>
                        </button>
                    </div>
                    
                    <!-- فلاتر البحث -->
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="form-input" id="inventorySearch" 
                                   placeholder="ابحث في المخزون" onkeyup="searchInventory()">
                        </div>
                        <div class="form-group">
                            <select class="select-input" id="categoryFilter" onchange="filterInventory()">
                                <option value="">جميع الفئات</option>
                                <option value="سوبرماركت">سوبرماركت</option>
                                <option value="أدوات صحية">أدوات صحية</option>
                                <option value="أدوات كهربائية">أدوات كهربائية</option>
                                <option value="مواد بناء">مواد بناء</option>
                                <option value="مستلزمات مكتبية">مستلزمات مكتبية</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- جدول المخزون -->
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>المنتج</th>
                                    <th>الفئة</th>
                                    <th>السعر</th>
                                    <th>سعر الشراء</th>
                                    <th>المخزون</th>
                                    <th>الباركود</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable">
                                <!-- البيانات تظهر هنا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- صفحة الماسح الضوئي -->
            <div class="page" id="scanner">
                <div class="card-3d">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2 6h4v12H2zm5 0h4v12H7zm5 0h4v12h-4zm5 0h4v12h-4z"/>
                            </svg>
                            <span>ماسح الباركود</span>
                        </h3>
                    </div>
                    
                    <div class="text-center py-12">
                        <div class="mb-8">
                            <div id="qr-reader" style="width: 100%; max-width: 500px; margin: 0 auto;"></div>
                        </div>
                        
                        <div class="scanner-result" id="scannerResult">
                            <h4 class="text-lg font-bold mb-3">نتيجة المسح</h4>
                            <div id="scannedProductDetails"></div>
                            <button class="btn btn-primary mt-4" onclick="addScannedToCart()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>إضافة للسلة</span>
                            </button>
                        </div>
                        
                        <button class="btn btn-secondary mt-8" onclick="stopScanner()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            <span>إيقاف الماسح</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- صفحة التقارير -->
            <div class="page" id="reports">
                <div class="card-3d">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                            </svg>
                            <span>التقارير والإحصائيات</span>
                        </h3>
                        <div class="flex gap-2">
                            <select class="select-input" id="reportPeriod" onchange="updateReports()">
                                <option value="week">أسبوع</option>
                                <option value="month">شهر</option>
                                <option value="year">سنة</option>
                            </select>
                            <button class="btn btn-secondary" onclick="exportReport()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                                </svg>
                                <span>تصدير</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div class="card-3d">
                            <h4 class="text-lg font-bold mb-4">المبيعات اليومية</h4>
                            <canvas id="dailyReportChart" height="200"></canvas>
                        </div>
                        <div class="card-3d">
                            <h4 class="text-lg font-bold mb-4">المبيعات حسب الفئة</h4>
                            <canvas id="categoryReportChart" height="200"></canvas>
                        </div>
                    </div>
                    
                    <!-- تقرير الربح والخسارة -->
                    <div class="card-3d">
                        <h4 class="text-lg font-bold mb-4">تقرير الربح والخسارة</h4>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>التاريخ</th>
                                        <th>إجمالي المبيعات</th>
                                        <th>تكلفة البضاعة</th>
                                        <th>الربح الإجمالي</th>
                                        <th>المصاريف</th>
                                        <th>صافي الربح</th>
                                    </tr>
                                </thead>
                                <tbody id="profitLossTable">
                                    <!-- البيانات تظهر هنا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- صفحة العملاء والمديونيات -->
            <div class="page" id="customers">
                <div class="grid grid-cols-2 gap-6">
                    <!-- قائمة العملاء -->
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                                </svg>
                                <span>إدارة العملاء</span>
                            </h3>
                            <button class="btn btn-primary" onclick="openCustomerModal()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span>إضافة عميل</span>
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <input type="text" class="form-input" id="customerSearch" 
                                   placeholder="ابحث عن عميل" onkeyup="searchCustomers()">
                        </div>
                        
                        <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>الاسم</th>
                                        <th>الهاتف</th>
                                        <th>الرصيد</th>
                                        <th>إجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="customersTable">
                                    <!-- البيانات تظهر هنا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- المديونيات -->
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                                </svg>
                                <span>المديونيات</span>
                            </h3>
                            <button class="btn btn-secondary" onclick="openPaymentModal()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                                <span>سداد دفعة</span>
                            </button>
                        </div>
                        
                        <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>العميل</th>
                                        <th>المبلغ</th>
                                        <th>آخر سداد</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody id="debtsTable">
                                    <!-- البيانات تظهر هنا -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- سجل المدفوعات -->
                        <div class="mt-6">
                            <h4 class="text-lg font-bold mb-4">سجل المدفوعات</h4>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>التاريخ</th>
                                            <th>العميل</th>
                                            <th>المبلغ</th>
                                            <th>الطريقة</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentsTable">
                                        <!-- البيانات تظهر هنا -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- صفحة الإعدادات -->
            <div class="page" id="settings">
                <div class="grid grid-cols-2 gap-6">
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                                </svg>
                                <span>إعدادات المتجر</span>
                            </h3>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="form-group">
                                <label class="form-label">اسم المتجر</label>
                                <input type="text" class="form-input" id="storeName" value="متجري">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">العنوان</label>
                                <textarea class="form-input" id="storeAddress" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">رقم الهاتف</label>
                                <input type="text" class="form-input" id="storePhone">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">نسبة الضريبة (%)</label>
                                <input type="number" class="form-input" id="taxRateSetting" value="14">
                            </div>
                            
                            <button class="btn btn-primary w-full" onclick="saveStoreSettings()">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                                </svg>
                                <span>حفظ الإعدادات</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- إدارة البيانات -->
                    <div class="card-3d">
                        <div class="card-header">
                            <h3 class="card-title">إدارة البيانات</h3>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold mb-2">تصدير البيانات</h4>
                                <p class="text-sm text-gray-400 mb-3">احفظ نسخة احتياطية من جميع بياناتك</p>
                                <button class="btn btn-secondary w-full" onclick="exportData()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                                    </svg>
                                    <span>تصدير جميع البيانات</span>
                                </button>
                            </div>
                            
                            <div>
                                <h4 class="font-bold mb-2">استيراد البيانات</h4>
                                <p class="text-sm text-gray-400 mb-3">استر بيانات من نسخة احتياطية</p>
                                <input type="file" class="form-input" id="importFile" accept=".json">
                                <button class="btn btn-warning w-full mt-2" onclick="importData()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
                                    </svg>
                                    <span>استيراد البيانات</span>
                                </button>
                            </div>
                            
                            <div>
                                <h4 class="font-bold mb-2 text-red-400">خطر</h4>
                                <p class="text-sm text-gray-400 mb-3">حذف جميع البيانات بشكل دائم</p>
                                <button class="btn btn-danger w-full" onclick="resetSystem()">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </svg>
                                    <span>حذف جميع البيانات</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- زر الفعل العائم -->
        <div class="fab" onclick="quickAction()">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
        </div>

        <!-- الماسح الضوئي -->
        <div class="scanner-overlay" id="scannerOverlay">
            <div class="scanner-container">
                <div class="card-header">
                    <h3 class="card-title">ماسح الباركود</h3>
                    <button class="btn btn-secondary btn-small" onclick="closeScanner()">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
                <div id="scanner"></div>
            </div>
        </div>
    </div>

    <!-- نافذة التنبيه -->
    <div class="alert" id="alert">
        <div class="alert-icon">
            <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
        </div>
        <div class="alert-content">
            <div class="alert-title" id="alertTitle">تم!</div>
            <div class="alert-message" id="alertMessage">تمت العملية بنجاح</div>
        </div>
    </div>

    <!-- البرنامج النصي -->
    <script>
        // ============================================
        // المتغيرات العامة وقاعدة البيانات
        // ============================================

        let db = {
            products: [],
            customers: [],
            sales: [],
            settings: {},
            user: null
        };

        let cart = [];
        let currentScanner = null;
        let charts = {};

        // ============================================
        // نظام المصادقة وإدارة المستخدمين
        // ============================================

        // دالة لفحص قوة كلمة المرور
        function checkPasswordStrength(password) {
            let strength = 0;
            const requirements = {
                length: false,
                upper: false,
                lower: false,
                number: false,
                special: false
            };
            
            if (password.length >= 8) {
                strength++;
                requirements.length = true;
            }
            
            if (/[A-Z]/.test(password)) {
                strength++;
                requirements.upper = true;
            }
            
            if (/[a-z]/.test(password)) {
                strength++;
                requirements.lower = true;
            }
            
            if (/[0-9]/.test(password)) {
                strength++;
                requirements.number = true;
            }
            
            if (/[^A-Za-z0-9]/.test(password)) {
                strength++;
                requirements.special = true;
            }
            
            return { strength, requirements };
        }

        // تحديث عرض قوة كلمة المرور
        function updatePasswordStrength(password) {
            const { strength, requirements } = checkPasswordStrength(password);
            const strengthFill = document.getElementById('passwordStrengthFill');
            const strengthText = document.getElementById('passwordStrengthText');
            
            strengthFill.className = 'password-strength-fill';
            if (strength === 0) {
                strengthText.textContent = 'ضعيفة';
            } else if (strength <= 2) {
                strengthFill.classList.add('weak');
                strengthText.textContent = 'ضعيفة';
            } else if (strength === 3) {
                strengthFill.classList.add('fair');
                strengthText.textContent = 'متوسطة';
            } else if (strength === 4) {
                strengthFill.classList.add('good');
                strengthText.textContent = 'جيدة';
            } else {
                strengthFill.classList.add('strong');
                strengthText.textContent = 'قوية';
            }
            
            document.getElementById('reqLength').className = requirements.length ? 'valid' : 'invalid';
            document.getElementById('reqUpper').className = requirements.upper ? 'valid' : 'invalid';
            document.getElementById('reqLower').className = requirements.lower ? 'valid' : 'invalid';
            document.getElementById('reqNumber').className = requirements.number ? 'valid' : 'invalid';
            document.getElementById('reqSpecial').className = requirements.special ? 'valid' : 'invalid';
        }

        // تحقق من تطابق كلمتي المرور
        function checkPasswordMatch() {
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const matchMessage = document.getElementById('passwordMatch');
            
            if (confirmPassword && password !== confirmPassword) {
                matchMessage.style.display = 'block';
                return false;
            } else {
                matchMessage.style.display = 'none';
                return true;
            }
        }

        // فحص إذا كان اسم المستخدم مستخدم مسبقاً
        function isUsernameTaken(username) {
            const users = JSON.parse(localStorage.getItem('fawateer_users')) || [];
            return users.some(user => user.username === username);
        }

        // إنشاء حساب جديد
        function createAccount(fullName, username, email, phone, password, accountType) {
            if (isUsernameTaken(username)) {
                showAlert('error', 'خطأ', 'اسم المستخدم موجود مسبقاً. الرجاء اختيار اسم آخر.');
                return false;
            }
            
            const users = JSON.parse(localStorage.getItem('fawateer_users')) || [];
            const userId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
            
            const newUser = {
                id: userId,
                fullName: fullName,
                username: username,
                email: email || null,
                phone: phone || null,
                password: password,
                accountType: accountType,
                createdAt: new Date().toISOString(),
                isActive: true,
                lastLogin: null,
                permissions: getDefaultPermissions(accountType)
            };
            
            users.push(newUser);
            localStorage.setItem('fawateer_users', JSON.stringify(users));
            
            // تسجيل دخول تلقائي
            db.user = {
                id: newUser.id,
                name: newUser.fullName,
                username: newUser.username,
                role: newUser.accountType
            };
            
            const session = {
                user: db.user,
                timestamp: new Date().getTime()
            };
            localStorage.setItem('fawateer_session', JSON.stringify(session));
            
            return true;
        }

        // الحصول على الصلاحيات الافتراضية حسب نوع الحساب
        function getDefaultPermissions(accountType) {
            const permissions = {
                viewDashboard: true,
                manageSales: true,
                manageInventory: false,
                manageCustomers: false,
                viewReports: false,
                manageUsers: false,
                manageSettings: false
            };
            
            switch(accountType) {
                case 'owner':
                    permissions.manageInventory = true;
                    permissions.manageCustomers = true;
                    permissions.viewReports = true;
                    permissions.manageUsers = true;
                    permissions.manageSettings = true;
                    break;
                case 'admin':
                    permissions.manageInventory = true;
                    permissions.manageCustomers = true;
                    permissions.viewReports = true;
                    permissions.manageUsers = false;
                    permissions.manageSettings = true;
                    break;
                case 'cashier':
                    permissions.manageInventory = false;
                    permissions.manageCustomers = true;
                    permissions.viewReports = false;
                    permissions.manageUsers = false;
                    permissions.manageSettings = false;
                    break;
                case 'inventory':
                    permissions.manageInventory = true;
                    permissions.manageCustomers = false;
                    permissions.viewReports = true;
                    permissions.manageUsers = false;
                    permissions.manageSettings = false;
                    break;
            }
            
            return permissions;
        }

        // نظام تسجيل الدخول
        function login(username, password) {
            const users = JSON.parse(localStorage.getItem('fawateer_users')) || [];
            const user = users.find(u => u.username === username && u.password === password && u.isActive);
            
            if (user) {
                db.user = {
                    id: user.id,
                    name: user.fullName,
                    username: user.username,
                    role: user.accountType,
                    permissions: user.permissions
                };
                
                user.lastLogin = new Date().toISOString();
                localStorage.setItem('fawateer_users', JSON.stringify(users));
                
                const session = {
                    user: db.user,
                    timestamp: new Date().getTime()
                };
                localStorage.setItem('fawateer_session', JSON.stringify(session));
                
                showApp();
                showAlert('success', 'مرحباً بعودتك!', 'تم تسجيل الدخول بنجاح');
                return true;
            }
            
            // المستخدم الافتراضي للتوافق
            if (username === 'admin' && password === 'admin') {
                db.user = {
                    id: 1,
                    name: 'المسؤول',
                    username: 'admin',
                    role: 'admin'
                };
                
                const session = {
                    user: db.user,
                    timestamp: new Date().getTime()
                };
                localStorage.setItem('fawateer_session', JSON.stringify(session));
                
                showApp();
                showAlert('success', 'مرحباً بعودتك!', 'تم تسجيل الدخول بنجاح');
                return true;
            }
            
            showAlert('error', 'خطأ في المصادقة', 'اسم المستخدم أو كلمة المرور غير صحيحة');
            return false;
        }

        function logout() {
            localStorage.removeItem('fawateer_session');
            db.user = null;
            cart = [];
            showLogin();
        }

        function initAuth() {
            const session = localStorage.getItem('fawateer_session');
            if (session) {
                const { user, timestamp } = JSON.parse(session);
                const now = new Date().getTime();
                const hoursElapsed = (now - timestamp) / (1000 * 60 * 60);
                
                if (hoursElapsed < 24) {
                    const users = JSON.parse(localStorage.getItem('fawateer_users')) || [];
                    const userExists = users.some(u => u.username === user.username);
                    
                    if (userExists || user.username === 'admin') {
                        db.user = user;
                        showApp();
                        return;
                    }
                }
            }
            
            showLogin();
        }

        // ============================================
        // إدارة واجهة إنشاء الحساب
        // ============================================

        function showCreateAccountModal() {
            document.getElementById('createAccountModal').classList.add('active');
            document.getElementById('createAccountForm').reset();
            document.getElementById('passwordStrengthFill').style.width = '0%';
            document.getElementById('passwordStrengthText').textContent = 'ضعيفة';
            document.querySelectorAll('.password-requirements li').forEach(li => {
                li.className = 'invalid';
            });
            document.getElementById('passwordMatch').style.display = 'none';
        }

        function hideCreateAccountModal() {
            document.getElementById('createAccountModal').classList.remove('active');
        }

        // ============================================
        // نظام التنبيهات
        // ============================================

        function showAlert(type, title, message) {
            const alert = document.getElementById('alert');
            const alertTitle = document.getElementById('alertTitle');
            const alertMessage = document.getElementById('alertMessage');
            
            alert.className = `alert alert-${type}`;
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            alert.classList.add('active');
            
            setTimeout(() => {
                alert.classList.remove('active');
            }, 3000);
        }

        // ============================================
        // التهيئة وإعداد مستمعي الأحداث
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            // مستمعي الأحداث الجديدة
            document.getElementById('showCreateAccount').addEventListener('click', function(e) {
                e.preventDefault();
                showCreateAccountModal();
            });
            
            document.getElementById('backToLogin').addEventListener('click', function(e) {
                e.preventDefault();
                hideCreateAccountModal();
            });
            
            document.getElementById('closeCreateAccount').addEventListener('click', function(e) {
                e.preventDefault();
                hideCreateAccountModal();
            });
            
            document.getElementById('newPassword').addEventListener('input', function(e) {
                updatePasswordStrength(e.target.value);
            });
            
            document.getElementById('confirmPassword').addEventListener('input', function(e) {
                checkPasswordMatch();
            });
            
            document.getElementById('createAccountForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fullName = document.getElementById('fullName').value.trim();
                const username = document.getElementById('newUsername').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const password = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const accountType = document.getElementById('accountType').value;
                const termsAgreed = document.getElementById('termsAgreement').checked;
                
                if (!fullName || !username || !password || !confirmPassword || !accountType) {
                    showAlert('error', 'خطأ', 'يرجى ملء جميع الحقول المطلوبة');
                    return;
                }
                
                if (!termsAgreed) {
                    showAlert('error', 'خطأ', 'يجب الموافقة على الشروط والأحكام');
                    return;
                }
                
                const { strength } = checkPasswordStrength(password);
                if (strength < 3) {
                    showAlert('error', 'خطأ', 'كلمة المرور ضعيفة. الرجاء اختيار كلمة مرور أقوى');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showAlert('error', 'خطأ', 'كلمتا المرور غير متطابقتين');
                    return;
                }
                
                if (username.includes(' ')) {
                    showAlert('error', 'خطأ', 'اسم المستخدم لا يمكن أن يحتوي على مسافات');
                    return;
                }
                
                const success = createAccount(fullName, username, email, phone, password, accountType);
                
                if (success) {
                    showAlert('success', 'تم بنجاح', 'تم إنشاء الحساب بنجاح وتسجيل الدخول تلقائياً');
                    hideCreateAccountModal();
                    
                    // إذا كان هذا أول مستخدم، أظهر دليل الترحيب
                    const users = JSON.parse(localStorage.getItem('fawateer_users')) || [];
                    if (users.length === 1) {
                        setTimeout(() => {
                            showWelcomeGuide();
                        }, 1000);
                    }
                }
            });
            
            // مستمعي الأحداث الأصلية
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                login(username, password);
            });
            
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });
            
            // تهيئة النظام
            initAuth();
        });

        // ============================================
        // بقية دوال النظام الأصلية
        // ============================================

        // ... جميع الدوال الأصلية تبقى كما هي دون تغيير ...
        // بما فيهم: showPage, openProductModal, openCustomerModal, etc.

        window.showPage = function(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`.nav-link[data-page="${pageId}"]`).classList.add('active');
        };

        window.hideWelcomeGuide = function() {
            document.getElementById('welcomeGuide').style.display = 'none';
            document.getElementById('statsContainer').style.display = 'grid';
            document.getElementById('chartsContainer').style.display = 'grid';
            document.getElementById('recentSalesContainer').style.display = 'block';
        };

        // ... باقي الكود الأصلي ...

    </script>
</body>
</html>
