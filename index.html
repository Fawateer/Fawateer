<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fawateer - Ultimate Retail Management System</title>
    <!-- Chart.js for dashboard visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- HTML5 QR Code Scanner -->
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        /* ====== CSS RESET & BASE STYLES ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #7c3aed;
            --primary-dark: #5b21b6;
            --primary-light: #a78bfa;
            --secondary-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --darker-bg: #0a0f1c;
            --card-bg: rgba(30, 41, 59, 0.7);
            --card-border: rgba(255, 255, 255, 0.1);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --glass-border: 1px solid rgba(255, 255, 255, 0.18);
            --transition-smooth: all 0.3s ease;
            --border-radius: 12px;
            --border-radius-sm: 8px;
        }

        body {
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ====== GLASSMORPHISM EFFECTS ====== */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        /* ====== TYPOGRAPHY ====== */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
        }

        h2 {
            font-size: 1.8rem;
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--text-primary);
        }

        .text-muted {
            color: var(--text-muted);
        }

        /* ====== LAYOUT & GRID SYSTEM ====== */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        @media (max-width: 1024px) {
            .grid-4 {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        /* ====== BUTTONS ====== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
            cursor: pointer;
            transition: var(--transition-smooth);
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
        }

        .btn-secondary {
            background: rgba(30, 41, 59, 0.8);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(51, 65, 85, 0.8);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(90deg, var(--success-color), #0da271);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(90deg, var(--warning-color), #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(90deg, var(--danger-color), #dc2626);
            color: white;
        }

        .btn-icon {
            padding: 0.5rem;
            border-radius: 50%;
            width: 40px;
            height: 40px;
        }

        /* ====== FORMS & INPUTS ====== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition-smooth);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
        }

        .form-control::placeholder {
            color: var(--text-muted);
        }

        /* ====== NAVIGATION & SIDEBAR ====== */
        .app-header {
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(15, 23, 42, 0.85);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 0.5rem 0;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-sm);
            background: transparent;
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            transition: var(--transition-smooth);
        }

        .nav-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-tab.active {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* ====== MAIN CONTENT AREA ====== */
        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 120px);
        }

        .view-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .view-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ====== CARDS ====== */
        .card {
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .card-title {
            font-size: 1.3rem;
            color: var(--text-primary);
        }

        /* ====== DASHBOARD SPECIFIC ====== */
        .kpi-card {
            text-align: center;
            padding: 1.5rem;
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .kpi-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .kpi-trend {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.9rem;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            margin-top: 0.5rem;
        }

        .trend-up {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
        }

        .trend-down {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* ====== TABLES ====== */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--border-radius-sm);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: rgba(15, 23, 42, 0.9);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .data-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        /* ====== POS SPECIFIC ====== */
        .pos-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 1.5rem;
        }

        @media (max-width: 992px) {
            .pos-container {
                grid-template-columns: 1fr;
            }
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .product-card {
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .product-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }

        .product-image {
            height: 120px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .product-price {
            color: var(--primary-light);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .cart-container {
            height: 100%;
        }

        .cart-items {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .cart-item-name {
            font-weight: 500;
        }

        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-totals {
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .total-row.grand-total {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-light);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 1rem;
            margin-top: 1rem;
        }

        /* ====== SCANNER MODAL ====== */
        .scanner-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .scanner-modal.active {
            display: flex;
        }

        .scanner-container {
            width: 90%;
            max-width: 800px;
            padding: 2rem;
            text-align: center;
        }

        .scanner-frame {
            width: 100%;
            height: 400px;
            border: 3px solid var(--primary-color);
            border-radius: var(--border-radius);
            margin: 2rem auto;
            position: relative;
            overflow: hidden;
        }

        .scanner-frame::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px dashed rgba(124, 58, 237, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        /* ====== CUSTOM SVG ICONS ====== */
        .icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* ====== UTILITIES ====== */
        .d-none {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }
        .p-3 { padding: 1.5rem; }
        .p-4 { padding: 2rem; }

        /* ====== ALERTS & NOTIFICATIONS ====== */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius-sm);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border-left: 4px solid var(--success-color);
            color: var(--text-primary);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.2);
            border-left: 4px solid var(--warning-color);
            color: var(--text-primary);
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.2);
            border-left: 4px solid var(--danger-color);
            color: var(--text-primary);
        }

        .alert-info {
            background: rgba(6, 182, 212, 0.2);
            border-left: 4px solid var(--secondary-color);
            color: var(--text-primary);
        }

        /* ====== MODALS ====== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        /* ====== PRINT RECEIPT STYLES ====== */
        @media print {
            body * {
                visibility: hidden;
            }
            .receipt-print, .receipt-print * {
                visibility: visible;
            }
            .receipt-print {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
                color: black;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="view-container active">
        <div class="container" style="max-width: 400px; padding-top: 5rem;">
            <div class="glass-panel p-4">
                <div class="logo mb-4" style="justify-content: center;">
                    <svg class="logo-icon" viewBox="0 0 100 100">
                        <path fill="#7c3aed" d="M50 10 L90 30 L90 70 L50 90 L10 70 L10 30 Z"/>
                        <path fill="#a78bfa" d="M50 30 L70 40 L70 60 L50 70 L30 60 L30 40 Z"/>
                        <path fill="#ffffff" d="M50 45 L60 50 L50 55 L40 50 Z"/>
                    </svg>
                    <h1>Fawateer</h1>
                </div>
                <p class="text-center text-muted mb-4">The Ultimate Retail Management System</p>
                
                <div id="loginForm">
                    <h2 class="text-center mb-4">Sign In</h2>
                    <div class="form-group">
                        <label class="form-label" for="username">Username</label>
                        <input type="text" id="username" class="form-control" placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password">
                    </div>
                    <div class="form-group">
                        <button id="loginBtn" class="btn btn-primary" style="width: 100%;">Login</button>
                    </div>
                    <p class="text-center text-muted">Don't have an account? <a href="#" id="showRegister" style="color: var(--primary-light);">Register</a></p>
                </div>

                <div id="registerForm" class="d-none">
                    <h2 class="text-center mb-4">Create Account</h2>
                    <div class="form-group">
                        <label class="form-label" for="regName">Full Name</label>
                        <input type="text" id="regName" class="form-control" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="regUsername">Username</label>
                        <input type="text" id="regUsername" class="form-control" placeholder="Choose a username">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="regPassword">Password</label>
                        <input type="password" id="regPassword" class="form-control" placeholder="Choose a password">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="regConfirmPassword">Confirm Password</label>
                        <input type="password" id="regConfirmPassword" class="form-control" placeholder="Confirm your password">
                    </div>
                    <div class="form-group">
                        <button id="registerBtn" class="btn btn-primary" style="width: 100%;">Create Account</button>
                    </div>
                    <p class="text-center text-muted">Already have an account? <a href="#" id="showLogin" style="color: var(--primary-light);">Sign In</a></p>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <p class="text-muted">Demo Credentials: admin / admin123</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appScreen" class="view-container">
        <!-- Header -->
        <header class="app-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <svg class="logo-icon" viewBox="0 0 100 100">
                            <path fill="#7c3aed" d="M50 10 L90 30 L90 70 L50 90 L10 70 L10 30 Z"/>
                            <path fill="#a78bfa" d="M50 30 L70 40 L70 60 L50 70 L30 60 L30 40 Z"/>
                            <path fill="#ffffff" d="M50 45 L60 50 L50 55 L40 50 Z"/>
                        </svg>
                        <h1>Fawateer</h1>
                    </div>
                    
                    <nav class="nav-tabs">
                        <button class="nav-tab active" data-view="dashboard">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                            </svg>
                            Dashboard
                        </button>
                        <button class="nav-tab" data-view="inventory">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z"/>
                            </svg>
                            Inventory
                        </button>
                        <button class="nav-tab" data-view="pos">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3zm7 16H5V8h14v11zm-7-8c-1.66 0-3-1.34-3-3H7c0 2.76 2.24 5 5 5s5-2.24 5-5h-2c0 1.66-1.34 3-3 3z"/>
                            </svg>
                            POS
                        </button>
                        <button class="nav-tab" data-view="scanner">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M4.5 4.5v2.25h2.25v-2.25H4.5zM4.5 17.25v2.25h2.25v-2.25H4.5zM17.25 4.5v2.25h2.25v-2.25h-2.25zM17.25 17.25v2.25h2.25v-2.25h-2.25zM3 3h3v3H3V3zm15 0h3v3h-3V3zm0 15h3v3h-3v-3zM3 18h3v3H3v-3zM18 9H6v6h12V9z"/>
                            </svg>
                            Price Checker
                        </button>
                        <button class="nav-tab" data-view="accounting">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                            </svg>
                            Accounting
                        </button>
                        <button class="nav-tab" data-view="crm">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                            </svg>
                            CRM
                        </button>
                        <button class="nav-tab" data-view="database">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                            </svg>
                            Database
                        </button>
                    </nav>
                    
                    <div class="user-menu">
                        <span id="currentUser" class="text-muted">Admin</span>
                        <button id="logoutBtn" class="btn btn-secondary btn-icon">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Dashboard View -->
                <div id="dashboardView" class="view-container active">
                    <div class="grid grid-4 mb-4">
                        <div class="glass-card kpi-card">
                            <div class="kpi-label">Today's Sales</div>
                            <div class="kpi-value" id="salesToday">$0.00</div>
                            <div class="kpi-trend trend-up">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                                </svg>
                                <span>+12%</span>
                            </div>
                        </div>
                        <div class="glass-card kpi-card">
                            <div class="kpi-label">Monthly Profit</div>
                            <div class="kpi-value" id="monthlyProfit">$0.00</div>
                            <div class="kpi-trend trend-up">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                                </svg>
                                <span>+8%</span>
                            </div>
                        </div>
                        <div class="glass-card kpi-card">
                            <div class="kpi-label">Total Orders</div>
                            <div class="kpi-value" id="totalOrders">0</div>
                            <div class="kpi-trend trend-down">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M16 18l2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"/>
                                </svg>
                                <span>-3%</span>
                            </div>
                        </div>
                        <div class="glass-card kpi-card">
                            <div class="kpi-label">Low Stock Items</div>
                            <div class="kpi-value" id="lowStockCount">0</div>
                            <div class="kpi-trend trend-up">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3zm0 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm1-9h-2v6h2V8zm0 8h-2v2h2v-2z"/>
                                </svg>
                                <span>+5</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-2 mb-4">
                        <div class="glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Sales Trend</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                        <div class="glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Top Selling Products</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="topProductsChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Transactions</h3>
                            <button class="btn btn-secondary" id="refreshTransactions">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Date</th>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentTransactions">
                                    <!-- Transactions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Inventory View -->
                <div id="inventoryView" class="view-container">
                    <div class="card-header mb-4">
                        <h2>Inventory Management</h2>
                        <div>
                            <button class="btn btn-primary" id="addProductBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                Add Product
                            </button>
                            <button class="btn btn-secondary ml-2" id="exportInventoryBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-4 mb-4">
                        <select id="categoryFilter" class="form-control">
                            <option value="all">All Categories</option>
                            <option value="supermarket">Supermarket</option>
                            <option value="hardware">Hardware</option>
                            <option value="plumbing">Plumbing</option>
                            <option value="electrical">Electrical</option>
                        </select>
                        <input type="text" id="searchInventory" class="form-control" placeholder="Search products...">
                        <select id="stockFilter" class="form-control">
                            <option value="all">All Stock Levels</option>
                            <option value="low">Low Stock Only</option>
                            <option value="out">Out of Stock</option>
                        </select>
                        <button class="btn btn-secondary" id="applyInventoryFilters">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                            </svg>
                            Apply Filters
                        </button>
                    </div>

                    <div class="glass-card">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>SKU</th>
                                        <th>Product Name</th>
                                        <th>Category</th>
                                        <th>Wholesale Price</th>
                                        <th>Retail Price</th>
                                        <th>Stock</th>
                                        <th>Expiry Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryTable">
                                    <!-- Inventory items will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- POS View -->
                <div id="posView" class="view-container">
                    <div class="card-header mb-4">
                        <h2>Point of Sale</h2>
                        <div>
                            <button class="btn btn-success" id="completeSaleBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                </svg>
                                Complete Sale
                            </button>
                            <button class="btn btn-danger ml-2" id="clearCartBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                </svg>
                                Clear Cart
                            </button>
                        </div>
                    </div>

                    <div class="pos-container">
                        <div class="glass-card p-3">
                            <div class="mb-3">
                                <input type="text" id="productSearch" class="form-control" placeholder="Search or scan product...">
                            </div>
                            <div class="product-grid" id="posProductGrid">
                                <!-- Products will be loaded here -->
                            </div>
                        </div>

                        <div class="glass-card cart-container">
                            <div class="card-header">
                                <h3 class="card-title">Shopping Cart</h3>
                                <span id="cartCount">0 items</span>
                            </div>
                            
                            <div class="cart-items" id="cartItems">
                                <!-- Cart items will be loaded here -->
                            </div>
                            
                            <div class="cart-totals">
                                <div class="total-row">
                                    <span>Subtotal:</span>
                                    <span id="subtotal">$0.00</span>
                                </div>
                                <div class="total-row">
                                    <span>Tax (10%):</span>
                                    <span id="taxAmount">$0.00</span>
                                </div>
                                <div class="total-row">
                                    <span>Discount:</span>
                                    <span id="discountAmount">$0.00</span>
                                </div>
                                <div class="total-row grand-total">
                                    <span>Total:</span>
                                    <span id="totalAmount">$0.00</span>
                                </div>
                                
                                <div class="grid grid-2 mt-3">
                                    <input type="number" id="discountInput" class="form-control" placeholder="Discount %" min="0" max="100">
                                    <button class="btn btn-secondary" id="applyDiscountBtn">Apply</button>
                                </div>
                                
                                <div class="mt-3">
                                    <select id="customerSelect" class="form-control mb-2">
                                        <option value="cash">Cash Customer</option>
                                        <!-- Customer options will be loaded here -->
                                    </select>
                                    <button class="btn btn-primary" id="printReceiptBtn" style="width: 100%;">
                                        <svg class="icon" viewBox="0 0 24 24">
                                            <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                                        </svg>
                                        Print Receipt
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scanner View -->
                <div id="scannerView" class="view-container">
                    <div class="text-center mb-4">
                        <h2>Price Checker Shield</h2>
                        <p class="text-muted">High-speed barcode scanner for instant price checking</p>
                    </div>
                    
                    <div class="glass-card p-4">
                        <div class="grid grid-2 mb-4">
                            <button class="btn btn-primary" id="startScannerBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M4.5 4.5v2.25h2.25v-2.25H4.5zM4.5 17.25v2.25h2.25v-2.25H4.5zM17.25 4.5v2.25h2.25v-2.25h-2.25zM17.25 17.25v2.25h2.25v-2.25h-2.25zM3 3h3v3H3V3zm15 0h3v3h-3V3zm0 15h3v3h-3v-3zM3 18h3v3H3v-3zM18 9H6v6h12V9z"/>
                                </svg>
                                Start Scanner
                            </button>
                            <button class="btn btn-secondary" id="stopScannerBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M6 6h12v12H6z"/>
                                </svg>
                                Stop Scanner
                            </button>
                        </div>
                        
                        <div class="scanner-frame" id="scannerFrame">
                            <!-- Scanner will be rendered here -->
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="text-center">Scanned Product</h3>
                            <div id="scannedProductInfo" class="glass-card p-3 mt-2">
                                <div class="text-center text-muted">
                                    No product scanned yet
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accounting View -->
                <div id="accountingView" class="view-container">
                    <div class="card-header mb-4">
                        <h2>Accounting & Reports</h2>
                        <div>
                            <button class="btn btn-primary" id="addExpenseBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                Add Expense
                            </button>
                            <button class="btn btn-secondary ml-2" id="generateReportBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                                </svg>
                                Generate Report
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-2 mb-4">
                        <div class="glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Income vs Expenses</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="incomeExpenseChart"></canvas>
                            </div>
                        </div>
                        <div class="glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Monthly Profit</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="profitChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-2 mb-4">
                        <div class="glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Recent Expenses</h3>
                                <button class="btn btn-secondary btn-icon" id="refreshExpenses">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Category</th>
                                            <th>Description</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody id="expensesTable">
                                        <!-- Expenses will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Daily Sales</h3>
                                <select id="salesPeriod" class="form-control" style="width: auto;">
                                    <option value="7">Last 7 Days</option>
                                    <option value="30">Last 30 Days</option>
                                    <option value="90">Last 90 Days</option>
                                </select>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Sales</th>
                                            <th>Transactions</th>
                                            <th>Avg. Sale</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dailySalesTable">
                                        <!-- Daily sales will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CRM View -->
                <div id="crmView" class="view-container">
                    <div class="card-header mb-4">
                        <h2>Customer Relationship Management</h2>
                        <div>
                            <button class="btn btn-primary" id="addCustomerBtn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                Add Customer
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-2 mb-4">
                        <div class="glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Customer Ledger</h3>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Customer</th>
                                            <th>Phone</th>
                                            <th>Total Purchases</th>
                                            <th>Credit Balance</th>
                                            <th>Last Purchase</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customerTable">
                                        <!-- Customers will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Credit Sales & Payments</h3>
                                <button class="btn btn-secondary btn-icon" id="addPaymentBtn">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Customer</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody id="creditTransactionsTable">
                                        <!-- Credit transactions will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card">
                        <div class="card-header">
                            <h3 class="card-title">Customer Details</h3>
                        </div>
                        <div id="customerDetails" class="p-3">
                            <div class="text-center text-muted">
                                Select a customer to view details
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Database View -->
                <div id="databaseView" class="view-container">
                    <div class="card-header mb-4">
                        <h2>Database Management</h2>
                        <p class="text-muted">Import, export, and backup your business data</p>
                    </div>

                    <div class="grid grid-2 mb-4">
                        <div class="glass-card p-3">
                            <h3 class="card-title mb-3">Export Data</h3>
                            <p class="text-muted mb-3">Export your data in various formats for backup or analysis.</p>
                            <div class="grid grid-2">
                                <button class="btn btn-success" id="exportJSONBtn">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                                    </svg>
                                    Export as JSON
                                </button>
                                <button class="btn btn-primary" id="exportCSVBtn">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                                    </svg>
                                    Export as CSV
                                </button>
                            </div>
                        </div>
                        <div class="glass-card p-3">
                            <h3 class="card-title mb-3">Import Data</h3>
                            <p class="text-muted mb-3">Import data from previous backups or other systems.</p>
                            <div class="grid grid-2">
                                <div class="form-group">
                                    <input type="file" id="importFile" class="form-control" accept=".json,.csv">
                                </div>
                                <button class="btn btn-warning" id="importDataBtn">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
                                    </svg>
                                    Import Data
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card">
                        <div class="card-header">
                            <h3 class="card-title">System Statistics</h3>
                        </div>
                        <div class="grid grid-4 p-3">
                            <div class="text-center">
                                <div class="kpi-value" id="totalProducts">0</div>
                                <div class="kpi-label">Products</div>
                            </div>
                            <div class="text-center">
                                <div class="kpi-value" id="totalCustomers">0</div>
                                <div class="kpi-label">Customers</div>
                            </div>
                            <div class="text-center">
                                <div class="kpi-value" id="totalTransactions">0</div>
                                <div class="kpi-label">Transactions</div>
                            </div>
                            <div class="text-center">
                                <div class="kpi-value" id="dbSize">0 KB</div>
                                <div class="kpi-label">Database Size</div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Data Backup & Restore</h3>
                        </div>
                        <div class="p-3">
                            <div class="alert alert-warning">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3zm0 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm1-9h-2v6h2V8zm0 8h-2v2h2v-2z"/>
                                </svg>
                                <div>
                                    <strong>Important:</strong> Regularly backup your data to prevent loss. 
                                    We recommend creating backups after each business day.
                                </div>
                            </div>
                            
                            <div class="grid grid-3 mt-3">
                                <button class="btn btn-secondary" id="backupNowBtn">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                                    </svg>
                                    Backup Now
                                </button>
                                <button class="btn btn-danger" id="clearAllDataBtn">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </svg>
                                    Clear All Data
                                </button>
                                <button class="btn btn-success" id="restoreDefaultsBtn">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
                                    </svg>
                                    Restore Defaults
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Scanner Modal -->
        <div id="scannerModal" class="scanner-modal">
            <div class="scanner-container">
                <h2>Price Checker Scanner</h2>
                <p class="text-muted">Position barcode within the frame for scanning</p>
                <div class="scanner-frame" id="scannerModalFrame"></div>
                <div class="mt-4">
                    <button class="btn btn-danger" id="closeScannerBtn">Close Scanner</button>
                </div>
            </div>
        </div>

        <!-- Product Modal -->
        <div id="productModal" class="modal">
            <div class="modal-content glass-panel">
                <div class="modal-header">
                    <h3 id="modalTitle">Add New Product</h3>
                    <button class="close-modal" id="closeProductModal">&times;</button>
                </div>
                <div class="p-3">
                    <form id="productForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="productName">Product Name *</label>
                                <input type="text" id="productName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="productCategory">Category *</label>
                                <select id="productCategory" class="form-control" required>
                                    <option value="supermarket">Supermarket</option>
                                    <option value="hardware">Hardware</option>
                                    <option value="plumbing">Plumbing</option>
                                    <option value="electrical">Electrical</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="productSKU">SKU *</label>
                                <input type="text" id="productSKU" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="productBarcode">Barcode</label>
                                <input type="text" id="productBarcode" class="form-control">
                            </div>
                        </div>
                        
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="wholesalePrice">Wholesale Price *</label>
                                <input type="number" id="wholesalePrice" class="form-control" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="retailPrice">Retail Price *</label>
                                <input type="number" id="retailPrice" class="form-control" step="0.01" min="0" required>
                            </div>
                        </div>
                        
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="stockQuantity">Stock Quantity *</label>
                                <input type="number" id="stockQuantity" class="form-control" min="0" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="expiryDate">Expiry Date</label>
                                <input type="date" id="expiryDate" class="form-control">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="productDescription">Description</label>
                            <textarea id="productDescription" class="form-control" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Save Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Receipt Modal -->
        <div id="receiptModal" class="modal">
            <div class="modal-content glass-panel">
                <div class="modal-header">
                    <h3>Sale Receipt</h3>
                    <button class="close-modal" id="closeReceiptModal">&times;</button>
                </div>
                <div class="p-3 receipt-print">
                    <div class="text-center mb-3">
                        <h2>Fawateer</h2>
                        <p>The Ultimate Retail Management System</p>
                        <hr>
                    </div>
                    
                    <div class="mb-3">
                        <div><strong>Receipt #:</strong> <span id="receiptNumber">000001</span></div>
                        <div><strong>Date:</strong> <span id="receiptDate">2023-10-01</span></div>
                        <div><strong>Time:</strong> <span id="receiptTime">10:30 AM</span></div>
                    </div>
                    
                    <table style="width: 100%; margin-bottom: 1rem;">
                        <thead>
                            <tr>
                                <th style="text-align: left;">Item</th>
                                <th style="text-align: right;">Qty</th>
                                <th style="text-align: right;">Price</th>
                                <th style="text-align: right;">Total</th>
                            </tr>
                        </thead>
                        <tbody id="receiptItems">
                            <!-- Receipt items will be loaded here -->
                        </tbody>
                    </table>
                    
                    <hr>
                    
                    <div style="text-align: right;">
                        <div><strong>Subtotal:</strong> <span id="receiptSubtotal">$0.00</span></div>
                        <div><strong>Tax (10%):</strong> <span id="receiptTax">$0.00</span></div>
                        <div><strong>Discount:</strong> <span id="receiptDiscount">$0.00</span></div>
                        <div style="font-size: 1.2em; font-weight: bold; margin-top: 0.5rem;">
                            <strong>Total:</strong> <span id="receiptTotal">$0.00</span>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="text-center mt-3">
                        <p>Thank you for your business!</p>
                        <p>Please come again</p>
                    </div>
                </div>
                <div class="p-3">
                    <button class="btn btn-primary" id="printReceiptFinalBtn" style="width: 100%;">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                        </svg>
                        Print Receipt
                    </button>
                </div>
            </div>
        </div>

        <!-- Customer Modal -->
        <div id="customerModal" class="modal">
            <div class="modal-content glass-panel">
                <div class="modal-header">
                    <h3 id="customerModalTitle">Add New Customer</h3>
                    <button class="close-modal" id="closeCustomerModal">&times;</button>
                </div>
                <div class="p-3">
                    <form id="customerForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="customerName">Full Name *</label>
                                <input type="text" id="customerName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="customerPhone">Phone Number *</label>
                                <input type="tel" id="customerPhone" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="customerEmail">Email Address</label>
                            <input type="email" id="customerEmail" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="customerAddress">Address</label>
                            <textarea id="customerAddress" class="form-control" rows="2"></textarea>
                        </div>
                        
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="customerCreditLimit">Credit Limit ($)</label>
                                <input type="number" id="customerCreditLimit" class="form-control" min="0" step="0.01" value="1000">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="customerDiscount">Discount (%)</label>
                                <input type="number" id="customerDiscount" class="form-control" min="0" max="100" step="0.1" value="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Save Customer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Expense Modal -->
        <div id="expenseModal" class="modal">
            <div class="modal-content glass-panel">
                <div class="modal-header">
                    <h3>Add New Expense</h3>
                    <button class="close-modal" id="closeExpenseModal">&times;</button>
                </div>
                <div class="p-3">
                    <form id="expenseForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="expenseCategory">Category *</label>
                                <select id="expenseCategory" class="form-control" required>
                                    <option value="rent">Rent</option>
                                    <option value="salary">Salary</option>
                                    <option value="utilities">Utilities</option>
                                    <option value="supplies">Supplies</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="expenseAmount">Amount *</label>
                                <input type="number" id="expenseAmount" class="form-control" step="0.01" min="0" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="expenseDescription">Description *</label>
                            <input type="text" id="expenseDescription" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="expenseDate">Date *</label>
                            <input type="date" id="expenseDate" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Save Expense</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Payment Modal -->
        <div id="paymentModal" class="modal">
            <div class="modal-content glass-panel">
                <div class="modal-header">
                    <h3>Add Payment</h3>
                    <button class="close-modal" id="closePaymentModal">&times;</button>
                </div>
                <div class="p-3">
                    <form id="paymentForm">
                        <div class="form-group">
                            <label class="form-label" for="paymentCustomer">Customer *</label>
                            <select id="paymentCustomer" class="form-control" required>
                                <!-- Customer options will be loaded here -->
                            </select>
                        </div>
                        
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label" for="paymentAmount">Amount *</label>
                                <input type="number" id="paymentAmount" class="form-control" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="paymentDate">Date *</label>
                                <input type="date" id="paymentDate" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="paymentMethod">Payment Method *</label>
                            <select id="paymentMethod" class="form-control" required>
                                <option value="cash">Cash</option>
                                <option value="card">Card</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="paymentNotes">Notes</label>
                            <textarea id="paymentNotes" class="form-control" rows="2"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Record Payment</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; z-index: 2000; max-width: 400px;"></div>
    </div>

    <script>
        // ====== MODULE: CORE APPLICATION ======
        class FawateerApp {
            constructor() {
                this.currentUser = null;
                this.isAuthenticated = false;
                this.currentView = 'dashboard';
                this.modules = {
                    auth: new AuthModule(),
                    inventory: new InventoryModule(),
                    pos: new POSModule(),
                    scanner: new ScannerModule(),
                    accounting: new AccountingModule(),
                    crm: new CRMModule(),
                    database: new DatabaseModule(),
                    ui: new UIModule()
                };
                this.init();
            }

            init() {
                this.loadUserSession();
                this.bindEvents();
                this.loadDemoData();
                this.updateDashboard();
            }

            loadUserSession() {
                const user = localStorage.getItem('fawateer_user');
                if (user) {
                    this.currentUser = JSON.parse(user);
                    this.isAuthenticated = true;
                    this.showAppScreen();
                } else {
                    this.showLoginScreen();
                }
            }

            showLoginScreen() {
                document.getElementById('loginScreen').classList.add('active');
                document.getElementById('appScreen').classList.remove('active');
            }

            showAppScreen() {
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('appScreen').classList.add('active');
                this.updateCurrentUserDisplay();
                this.switchView('dashboard');
            }

            updateCurrentUserDisplay() {
                if (this.currentUser) {
                    document.getElementById('currentUser').textContent = this.currentUser.name;
                }
            }

            bindEvents() {
                // Login/Register events
                document.getElementById('loginBtn').addEventListener('click', () => this.handleLogin());
                document.getElementById('registerBtn').addEventListener('click', () => this.handleRegister());
                document.getElementById('showRegister').addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('loginForm').classList.add('d-none');
                    document.getElementById('registerForm').classList.remove('d-none');
                });
                document.getElementById('showLogin').addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('registerForm').classList.add('d-none');
                    document.getElementById('loginForm').classList.remove('d-none');
                });
                document.getElementById('logoutBtn').addEventListener('click', () => this.handleLogout());

                // Navigation events
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const view = e.target.closest('.nav-tab').dataset.view;
                        this.switchView(view);
                    });
                });

                // Bind other module events
                this.modules.ui.bindEvents(this);
                this.modules.inventory.bindEvents(this);
                this.modules.pos.bindEvents(this);
                this.modules.scanner.bindEvents(this);
                this.modules.accounting.bindEvents(this);
                this.modules.crm.bindEvents(this);
                this.modules.database.bindEvents(this);
            }

            handleLogin() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (this.modules.auth.login(username, password)) {
                    this.currentUser = this.modules.auth.getCurrentUser();
                    this.isAuthenticated = true;
                    localStorage.setItem('fawateer_user', JSON.stringify(this.currentUser));
                    this.showAppScreen();
                    this.showAlert('Successfully logged in!', 'success');
                } else {
                    this.showAlert('Invalid username or password', 'danger');
                }
            }

            handleRegister() {
                const name = document.getElementById('regName').value;
                const username = document.getElementById('regUsername').value;
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;
                
                if (password !== confirmPassword) {
                    this.showAlert('Passwords do not match', 'danger');
                    return;
                }
                
                if (this.modules.auth.register(name, username, password)) {
                    this.showAlert('Account created successfully! Please login.', 'success');
                    document.getElementById('registerForm').classList.add('d-none');
                    document.getElementById('loginForm').classList.remove('d-none');
                } else {
                    this.showAlert('Username already exists', 'danger');
                }
            }

            handleLogout() {
                this.modules.auth.logout();
                this.currentUser = null;
                this.isAuthenticated = false;
                localStorage.removeItem('fawateer_user');
                this.showLoginScreen();
                this.showAlert('Successfully logged out', 'info');
            }

            switchView(viewName) {
                // Update active tab
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.view === viewName) {
                        tab.classList.add('active');
                    }
                });

                // Update active view
                document.querySelectorAll('.view-container').forEach(view => {
                    view.classList.remove('active');
                });
                
                document.getElementById(`${viewName}View`).classList.add('active');
                this.currentView = viewName;

                // Load view-specific data
                switch(viewName) {
                    case 'dashboard':
                        this.updateDashboard();
                        break;
                    case 'inventory':
                        this.modules.inventory.renderInventoryTable();
                        break;
                    case 'pos':
                        this.modules.pos.renderProducts();
                        this.modules.pos.updateCartDisplay();
                        break;
                    case 'scanner':
                        // Initialize scanner if needed
                        break;
                    case 'accounting':
                        this.modules.accounting.renderExpenses();
                        this.modules.accounting.renderDailySales();
                        this.modules.accounting.updateCharts();
                        break;
                    case 'crm':
                        this.modules.crm.renderCustomers();
                        this.modules.crm.renderCreditTransactions();
                        break;
                    case 'database':
                        this.modules.database.updateStats();
                        break;
                }
            }

            updateDashboard() {
                const today = new Date().toISOString().split('T')[0];
                const transactions = this.modules.accounting.getTransactions();
                const inventory = this.modules.inventory.getAllProducts();
                
                // Calculate today's sales
                const todaySales = transactions
                    .filter(t => t.date === today)
                    .reduce((sum, t) => sum + t.total, 0);
                
                // Calculate monthly profit
                const currentMonth = new Date().getMonth();
                const monthlyTransactions = transactions.filter(t => {
                    const transactionMonth = new Date(t.date).getMonth();
                    return transactionMonth === currentMonth;
                });
                const monthlyIncome = monthlyTransactions.reduce((sum, t) => sum + t.total, 0);
                const monthlyExpenses = this.modules.accounting.getMonthlyExpenses();
                const monthlyProfit = monthlyIncome - monthlyExpenses;
                
                // Count low stock items
                const lowStockCount = inventory.filter(p => p.stockQuantity < 10).length;
                
                // Update dashboard values
                document.getElementById('salesToday').textContent = `$${todaySales.toFixed(2)}`;
                document.getElementById('monthlyProfit').textContent = `$${monthlyProfit.toFixed(2)}`;
                document.getElementById('totalOrders').textContent = transactions.length;
                document.getElementById('lowStockCount').textContent = lowStockCount;
                
                // Update recent transactions
                this.modules.ui.renderRecentTransactions(transactions.slice(-5).reverse());
                
                // Update charts
                this.modules.ui.updateDashboardCharts(transactions, inventory);
            }

            loadDemoData() {
                // Load demo data if no data exists
                if (!localStorage.getItem('fawateer_inventory')) {
                    this.modules.inventory.loadDemoProducts();
                }
                
                if (!localStorage.getItem('fawateer_customers')) {
                    this.modules.crm.loadDemoCustomers();
                }
                
                if (!localStorage.getItem('fawateer_transactions')) {
                    this.modules.accounting.loadDemoTransactions();
                }
                
                if (!localStorage.getItem('fawateer_expenses')) {
                    this.modules.accounting.loadDemoExpenses();
                }
            }

            showAlert(message, type = 'info') {
                const alertContainer = document.getElementById('alertContainer');
                const alertId = 'alert-' + Date.now();
                
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.id = alertId;
                alert.innerHTML = `
                    <svg class="icon" viewBox="0 0 24 24">
                        ${this.getAlertIcon(type)}
                    </svg>
                    <div>${message}</div>
                `;
                
                alertContainer.appendChild(alert);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    const alertElement = document.getElementById(alertId);
                    if (alertElement) {
                        alertElement.style.opacity = '0';
                        alertElement.style.transition = 'opacity 0.3s';
                        setTimeout(() => {
                            if (alertElement.parentNode) {
                                alertElement.parentNode.removeChild(alertElement);
                            }
                        }, 300);
                    }
                }, 5000);
            }

            getAlertIcon(type) {
                switch(type) {
                    case 'success':
                        return '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>';
                    case 'danger':
                        return '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>';
                    case 'warning':
                        return '<path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>';
                    default:
                        return '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>';
                }
            }
        }

        // ====== MODULE: AUTHENTICATION ======
        class AuthModule {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('fawateer_users')) || [];
                this.currentUser = null;
                
                // Add default admin user if no users exist
                if (this.users.length === 0) {
                    this.users.push({
                        id: 1,
                        name: 'Administrator',
                        username: 'admin',
                        password: 'admin123', // In production, this should be hashed
                        role: 'admin',
                        createdAt: new Date().toISOString()
                    });
                    this.saveUsers();
                }
            }

            login(username, password) {
                const user = this.users.find(u => u.username === username && u.password === password);
                if (user) {
                    this.currentUser = user;
                    return true;
                }
                return false;
            }

            register(name, username, password) {
                // Check if username already exists
                if (this.users.some(u => u.username === username)) {
                    return false;
                }
                
                const newUser = {
                    id: this.users.length + 1,
                    name,
                    username,
                    password, // In production, this should be hashed
                    role: 'user',
                    createdAt: new Date().toISOString()
                };
                
                this.users.push(newUser);
                this.saveUsers();
                return true;
            }

            logout() {
                this.currentUser = null;
            }

            getCurrentUser() {
                return this.currentUser;
            }

            saveUsers() {
                localStorage.setItem('fawateer_users', JSON.stringify(this.users));
            }
        }

        // ====== MODULE: INVENTORY MANAGEMENT ======
        class InventoryModule {
            constructor() {
                this.products = JSON.parse(localStorage.getItem('fawateer_inventory')) || [];
                this.categories = ['supermarket', 'hardware', 'plumbing', 'electrical', 'other'];
                this.nextProductId = this.products.length > 0 ? Math.max(...this.products.map(p => p.id)) + 1 : 1;
            }

            bindEvents(app) {
                document.getElementById('addProductBtn').addEventListener('click', () => {
                    this.openProductModal();
                });
                
                document.getElementById('exportInventoryBtn').addEventListener('click', () => {
                    this.exportInventory();
                });
                
                document.getElementById('applyInventoryFilters').addEventListener('click', () => {
                    this.renderInventoryTable();
                });
                
                document.getElementById('closeProductModal').addEventListener('click', () => {
                    document.getElementById('productModal').classList.remove('active');
                });
                
                document.getElementById('productForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveProduct();
                });
                
                // Product search
                document.getElementById('searchInventory').addEventListener('input', () => {
                    this.renderInventoryTable();
                });
            }

            getAllProducts() {
                return this.products;
            }

            getProductById(id) {
                return this.products.find(p => p.id == id);
            }

            getProductByBarcode(barcode) {
                return this.products.find(p => p.barcode === barcode);
            }

            getProductsByCategory(category) {
                if (category === 'all') return this.products;
                return this.products.filter(p => p.category === category);
            }

            addProduct(productData) {
                const newProduct = {
                    id: this.nextProductId++,
                    ...productData,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.products.push(newProduct);
                this.saveInventory();
                return newProduct;
            }

            updateProduct(id, productData) {
                const index = this.products.findIndex(p => p.id == id);
                if (index !== -1) {
                    this.products[index] = {
                        ...this.products[index],
                        ...productData,
                        updatedAt: new Date().toISOString()
                    };
                    this.saveInventory();
                    return true;
                }
                return false;
            }

            deleteProduct(id) {
                const index = this.products.findIndex(p => p.id == id);
                if (index !== -1) {
                    this.products.splice(index, 1);
                    this.saveInventory();
                    return true;
                }
                return false;
            }

            updateStock(id, quantityChange) {
                const product = this.getProductById(id);
                if (product) {
                    const newQuantity = product.stockQuantity + quantityChange;
                    if (newQuantity >= 0) {
                        product.stockQuantity = newQuantity;
                        product.updatedAt = new Date().toISOString();
                        this.saveInventory();
                        return true;
                    }
                }
                return false;
            }

            saveInventory() {
                localStorage.setItem('fawateer_inventory', JSON.stringify(this.products));
            }

            openProductModal(productId = null) {
                const modal = document.getElementById('productModal');
                const title = document.getElementById('modalTitle');
                const form = document.getElementById('productForm');
                
                if (productId) {
                    // Edit mode
                    title.textContent = 'Edit Product';
                    const product = this.getProductById(productId);
                    if (product) {
                        document.getElementById('productName').value = product.name;
                        document.getElementById('productCategory').value = product.category;
                        document.getElementById('productSKU').value = product.sku;
                        document.getElementById('productBarcode').value = product.barcode || '';
                        document.getElementById('wholesalePrice').value = product.wholesalePrice;
                        document.getElementById('retailPrice').value = product.retailPrice;
                        document.getElementById('stockQuantity').value = product.stockQuantity;
                        document.getElementById('expiryDate').value = product.expiryDate || '';
                        document.getElementById('productDescription').value = product.description || '';
                        
                        form.dataset.editId = productId;
                    }
                } else {
                    // Add mode
                    title.textContent = 'Add New Product';
                    form.reset();
                    delete form.dataset.editId;
                    
                    // Generate a random SKU
                    document.getElementById('productSKU').value = 'SKU' + Math.random().toString(36).substr(2, 9).toUpperCase();
                }
                
                modal.classList.add('active');
            }

            saveProduct() {
                const form = document.getElementById('productForm');
                const productData = {
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    sku: document.getElementById('productSKU').value,
                    barcode: document.getElementById('productBarcode').value,
                    wholesalePrice: parseFloat(document.getElementById('wholesalePrice').value),
                    retailPrice: parseFloat(document.getElementById('retailPrice').value),
                    stockQuantity: parseInt(document.getElementById('stockQuantity').value),
                    expiryDate: document.getElementById('expiryDate').value,
                    description: document.getElementById('productDescription').value
                };
                
                if (form.dataset.editId) {
                    // Update existing product
                    this.updateProduct(form.dataset.editId, productData);
                    window.app.showAlert('Product updated successfully!', 'success');
                } else {
                    // Add new product
                    this.addProduct(productData);
                    window.app.showAlert('Product added successfully!', 'success');
                }
                
                document.getElementById('productModal').classList.remove('active');
                this.renderInventoryTable();
                
                // Update POS if open
                if (window.app.currentView === 'pos') {
                    window.app.modules.pos.renderProducts();
                }
            }

            renderInventoryTable() {
                const tableBody = document.getElementById('inventoryTable');
                const categoryFilter = document.getElementById('categoryFilter').value;
                const stockFilter = document.getElementById('stockFilter').value;
                const searchQuery = document.getElementById('searchInventory').value.toLowerCase();
                
                let filteredProducts = this.products;
                
                // Apply category filter
                if (categoryFilter !== 'all') {
                    filteredProducts = filteredProducts.filter(p => p.category === categoryFilter);
                }
                
                // Apply stock filter
                if (stockFilter === 'low') {
                    filteredProducts = filteredProducts.filter(p => p.stockQuantity < 10);
                } else if (stockFilter === 'out') {
                    filteredProducts = filteredProducts.filter(p => p.stockQuantity === 0);
                }
                
                // Apply search filter
                if (searchQuery) {
                    filteredProducts = filteredProducts.filter(p => 
                        p.name.toLowerCase().includes(searchQuery) ||
                        p.sku.toLowerCase().includes(searchQuery) ||
                        (p.barcode && p.barcode.toLowerCase().includes(searchQuery))
                    );
                }
                
                tableBody.innerHTML = '';
                
                if (filteredProducts.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="8" class="text-center">No products found</td>
                        </tr>
                    `;
                    return;
                }
                
                filteredProducts.forEach(product => {
                    const row = document.createElement('tr');
                    const stockClass = product.stockQuantity === 0 ? 'text-danger' : 
                                      product.stockQuantity < 10 ? 'text-warning' : '';
                    
                    row.innerHTML = `
                        <td>${product.sku}</td>
                        <td>${product.name}</td>
                        <td><span class="badge">${product.category}</span></td>
                        <td>$${product.wholesalePrice.toFixed(2)}</td>
                        <td><strong>$${product.retailPrice.toFixed(2)}</strong></td>
                        <td class="${stockClass}">${product.stockQuantity}</td>
                        <td>${product.expiryDate || 'N/A'}</td>
                        <td>
                            <button class="btn btn-secondary btn-icon edit-product" data-id="${product.id}">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                            </button>
                            <button class="btn btn-danger btn-icon delete-product" data-id="${product.id}">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners to action buttons
                tableBody.querySelectorAll('.edit-product').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const productId = e.target.closest('button').dataset.id;
                        this.openProductModal(productId);
                    });
                });
                
                tableBody.querySelectorAll('.delete-product').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const productId = e.target.closest('button').dataset.id;
                        if (confirm('Are you sure you want to delete this product?')) {
                            this.deleteProduct(productId);
                            window.app.showAlert('Product deleted successfully!', 'success');
                            this.renderInventoryTable();
                        }
                    });
                });
            }

            exportInventory() {
                const data = JSON.stringify(this.products, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fawateer-inventory-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                window.app.showAlert('Inventory exported successfully!', 'success');
            }

            loadDemoProducts() {
                const demoProducts = [
                    {
                        id: 1,
                        name: "Premium Coffee 500g",
                        category: "supermarket",
                        sku: "COFFEE001",
                        barcode: "123456789012",
                        wholesalePrice: 8.50,
                        retailPrice: 12.99,
                        stockQuantity: 45,
                        expiryDate: "2024-12-31",
                        description: "Premium arabica coffee beans"
                    },
                    {
                        id: 2,
                        name: "Hammer",
                        category: "hardware",
                        sku: "HAMMER001",
                        barcode: "234567890123",
                        wholesalePrice: 6.25,
                        retailPrice: 9.99,
                        stockQuantity: 22,
                        description: "16oz claw hammer"
                    },
                    {
                        id: 3,
                        name: "Pipe Wrench",
                        category: "plumbing",
                        sku: "WRENCH001",
                        barcode: "345678901234",
                        wholesalePrice: 15.75,
                        retailPrice: 24.99,
                        stockQuantity: 8,
                        description: "10-inch adjustable pipe wrench"
                    },
                    {
                        id: 4,
                        name: "LED Light Bulb",
                        category: "electrical",
                        sku: "BULB001",
                        barcode: "456789012345",
                        wholesalePrice: 2.25,
                        retailPrice: 4.99,
                        stockQuantity: 120,
                        description: "9W LED bulb, equivalent to 60W"
                    },
                    {
                        id: 5,
                        name: "Organic Olive Oil",
                        category: "supermarket",
                        sku: "OIL001",
                        barcode: "567890123456",
                        wholesalePrice: 7.80,
                        retailPrice: 14.50,
                        stockQuantity: 3,
                        expiryDate: "2024-06-30",
                        description: "Extra virgin organic olive oil"
                    },
                    {
                        id: 6,
                        name: "Screwdriver Set",
                        category: "hardware",
                        sku: "SCREW001",
                        barcode: "678901234567",
                        wholesalePrice: 12.50,
                        retailPrice: 19.99,
                        stockQuantity: 15,
                        description: "6-piece precision screwdriver set"
                    },
                    {
                        id: 7,
                        name: "PVC Pipe 1/2\"",
                        category: "plumbing",
                        sku: "PIPE001",
                        barcode: "789012345678",
                        wholesalePrice: 3.20,
                        retailPrice: 5.99,
                        stockQuantity: 85,
                        description: "10ft PVC pipe, 1/2 inch diameter"
                    },
                    {
                        id: 8,
                        name: "Extension Cord",
                        category: "electrical",
                        sku: "CORD001",
                        barcode: "890123456789",
                        wholesalePrice: 8.90,
                        retailPrice: 15.99,
                        stockQuantity: 18,
                        description: "15ft heavy-duty extension cord"
                    }
                ];
                
                this.products = demoProducts;
                this.nextProductId = demoProducts.length + 1;
                this.saveInventory();
            }
        }

        // ====== MODULE: POINT OF SALE ======
        class POSModule {
            constructor() {
                this.cart = [];
                this.currentDiscount = 0;
                this.taxRate = 0.10; // 10% tax
                this.receiptCounter = parseInt(localStorage.getItem('fawateer_receipt_counter')) || 1;
            }

            bindEvents(app) {
                // Product search
                document.getElementById('productSearch').addEventListener('input', (e) => {
                    this.filterProducts(e.target.value);
                });
                
                // Cart actions
                document.getElementById('clearCartBtn').addEventListener('click', () => {
                    this.clearCart();
                });
                
                document.getElementById('applyDiscountBtn').addEventListener('click', () => {
                    const discountInput = document.getElementById('discountInput');
                    this.applyDiscount(parseFloat(discountInput.value) || 0);
                    discountInput.value = '';
                });
                
                document.getElementById('completeSaleBtn').addEventListener('click', () => {
                    this.completeSale();
                });
                
                document.getElementById('printReceiptBtn').addEventListener('click', () => {
                    this.openReceiptModal();
                });
                
                document.getElementById('printReceiptFinalBtn').addEventListener('click', () => {
                    this.printReceipt();
                });
                
                document.getElementById('closeReceiptModal').addEventListener('click', () => {
                    document.getElementById('receiptModal').classList.remove('active');
                });
            }

            addToCart(productId, quantity = 1) {
                const product = window.app.modules.inventory.getProductById(productId);
                if (!product) {
                    window.app.showAlert('Product not found!', 'danger');
                    return false;
                }
                
                if (product.stockQuantity < quantity) {
                    window.app.showAlert(`Insufficient stock! Only ${product.stockQuantity} available.`, 'danger');
                    return false;
                }
                
                const existingItem = this.cart.find(item => item.productId == productId);
                
                if (existingItem) {
                    existingItem.quantity += quantity;
                    existingItem.total = existingItem.quantity * existingItem.price;
                } else {
                    this.cart.push({
                        productId: product.id,
                        name: product.name,
                        price: product.retailPrice,
                        quantity: quantity,
                        total: product.retailPrice * quantity
                    });
                }
                
                this.updateCartDisplay();
                window.app.showAlert(`${product.name} added to cart`, 'success');
                return true;
            }

            removeFromCart(productId, quantity = 1) {
                const itemIndex = this.cart.findIndex(item => item.productId == productId);
                
                if (itemIndex !== -1) {
                    if (this.cart[itemIndex].quantity <= quantity) {
                        this.cart.splice(itemIndex, 1);
                    } else {
                        this.cart[itemIndex].quantity -= quantity;
                        this.cart[itemIndex].total = this.cart[itemIndex].quantity * this.cart[itemIndex].price;
                    }
                    
                    this.updateCartDisplay();
                    return true;
                }
                
                return false;
            }

            updateCartItemQuantity(productId, newQuantity) {
                if (newQuantity < 1) {
                    this.removeFromCart(productId);
                    return;
                }
                
                const product = window.app.modules.inventory.getProductById(productId);
                if (product && product.stockQuantity < newQuantity) {
                    window.app.showAlert(`Insufficient stock! Only ${product.stockQuantity} available.`, 'danger');
                    return;
                }
                
                const item = this.cart.find(item => item.productId == productId);
                if (item) {
                    item.quantity = newQuantity;
                    item.total = item.quantity * item.price;
                    this.updateCartDisplay();
                }
            }

            clearCart() {
                if (this.cart.length === 0) {
                    window.app.showAlert('Cart is already empty', 'info');
                    return;
                }
                
                if (confirm('Clear the entire cart?')) {
                    this.cart = [];
                    this.currentDiscount = 0;
                    this.updateCartDisplay();
                    window.app.showAlert('Cart cleared', 'success');
                }
            }

            applyDiscount(percentage) {
                if (percentage < 0 || percentage > 100) {
                    window.app.showAlert('Discount must be between 0 and 100%', 'danger');
                    return;
                }
                
                this.currentDiscount = percentage;
                this.updateCartDisplay();
                window.app.showAlert(`${percentage}% discount applied`, 'success');
            }

            calculateTotals() {
                const subtotal = this.cart.reduce((sum, item) => sum + item.total, 0);
                const discountAmount = subtotal * (this.currentDiscount / 100);
                const taxableAmount = subtotal - discountAmount;
                const taxAmount = taxableAmount * this.taxRate;
                const total = taxableAmount + taxAmount;
                
                return {
                    subtotal,
                    discountAmount,
                    taxAmount,
                    total
                };
            }

            updateCartDisplay() {
                const cartItemsContainer = document.getElementById('cartItems');
                const totals = this.calculateTotals();
                
                // Update cart count
                document.getElementById('cartCount').textContent = `${this.cart.length} items`;
                
                // Update cart items
                cartItemsContainer.innerHTML = '';
                
                if (this.cart.length === 0) {
                    cartItemsContainer.innerHTML = `
                        <div class="text-center text-muted p-3">
                            Cart is empty
                        </div>
                    `;
                } else {
                    this.cart.forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'cart-item';
                        itemElement.innerHTML = `
                            <div>
                                <div class="cart-item-name">${item.name}</div>
                                <div class="text-muted">$${item.price.toFixed(2)} each</div>
                            </div>
                            <div class="cart-item-qty">
                                <button class="qty-btn decrease-qty" data-id="${item.productId}">-</button>
                                <span>${item.quantity}</span>
                                <button class="qty-btn increase-qty" data-id="${item.productId}">+</button>
                                <span style="margin-left: 1rem; font-weight: bold;">$${item.total.toFixed(2)}</span>
                            </div>
                        `;
                        cartItemsContainer.appendChild(itemElement);
                    });
                    
                    // Add event listeners to quantity buttons
                    cartItemsContainer.querySelectorAll('.decrease-qty').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const productId = e.target.closest('button').dataset.id;
                            this.removeFromCart(productId, 1);
                        });
                    });
                    
                    cartItemsContainer.querySelectorAll('.increase-qty').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const productId = e.target.closest('button').dataset.id;
                            this.addToCart(productId, 1);
                        });
                    });
                }
                
                // Update totals
                document.getElementById('subtotal').textContent = `$${totals.subtotal.toFixed(2)}`;
                document.getElementById('taxAmount').textContent = `$${totals.taxAmount.toFixed(2)}`;
                document.getElementById('discountAmount').textContent = `$${totals.discountAmount.toFixed(2)}`;
                document.getElementById('totalAmount').textContent = `$${totals.total.toFixed(2)}`;
            }

            renderProducts() {
                const productGrid = document.getElementById('posProductGrid');
                const products = window.app.modules.inventory.getAllProducts();
                
                productGrid.innerHTML = '';
                
                if (products.length === 0) {
                    productGrid.innerHTML = `
                        <div class="text-center text-muted p-4">
                            No products available. Add products in the Inventory section.
                        </div>
                    `;
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'glass-card product-card p-2';
                    productCard.dataset.id = product.id;
                    
                    productCard.innerHTML = `
                        <div class="product-image">
                            <svg class="icon" width="48" height="48" viewBox="0 0 24 24">
                                <path fill="var(--primary-light)" d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11.5z"/>
                            </svg>
                        </div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">$${product.retailPrice.toFixed(2)}</div>
                        <div class="text-muted" style="font-size: 0.8rem;">Stock: ${product.stockQuantity}</div>
                    `;
                    
                    productCard.addEventListener('click', () => {
                        this.addToCart(product.id, 1);
                    });
                    
                    productGrid.appendChild(productCard);
                });
            }

            filterProducts(searchTerm) {
                const productCards = document.querySelectorAll('.product-card');
                const searchLower = searchTerm.toLowerCase();
                
                productCards.forEach(card => {
                    const productName = card.querySelector('.product-name').textContent.toLowerCase();
                    const productId = card.dataset.id;
                    const product = window.app.modules.inventory.getProductById(productId);
                    
                    const matches = productName.includes(searchLower) ||
                                   product.sku.toLowerCase().includes(searchLower) ||
                                   (product.barcode && product.barcode.includes(searchTerm));
                    
                    card.style.display = matches ? 'block' : 'none';
                });
            }

            completeSale() {
                if (this.cart.length === 0) {
                    window.app.showAlert('Cart is empty', 'warning');
                    return;
                }
                
                // Check stock availability
                for (const item of this.cart) {
                    const product = window.app.modules.inventory.getProductById(item.productId);
                    if (product.stockQuantity < item.quantity) {
                        window.app.showAlert(`Insufficient stock for ${product.name}! Only ${product.stockQuantity} available.`, 'danger');
                        return;
                    }
                }
                
                // Update stock levels
                for (const item of this.cart) {
                    window.app.modules.inventory.updateStock(item.productId, -item.quantity);
                }
                
                // Create transaction record
                const totals = this.calculateTotals();
                const transaction = {
                    id: this.receiptCounter,
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toLocaleTimeString(),
                    items: [...this.cart],
                    subtotal: totals.subtotal,
                    tax: totals.taxAmount,
                    discount: totals.discountAmount,
                    total: totals.total,
                    paymentMethod: 'cash',
                    status: 'completed'
                };
                
                // Save transaction
                window.app.modules.accounting.addTransaction(transaction);
                
                // Increment receipt counter
                this.receiptCounter++;
                localStorage.setItem('fawateer_receipt_counter', this.receiptCounter.toString());
                
                // Clear cart
                this.cart = [];
                this.currentDiscount = 0;
                this.updateCartDisplay();
                
                // Show success message and receipt
                window.app.showAlert('Sale completed successfully!', 'success');
                this.openReceiptModal(transaction);
                
                // Update dashboard
                window.app.updateDashboard();
            }

            openReceiptModal(transaction = null) {
                const modal = document.getElementById('receiptModal');
                
                if (transaction) {
                    // Populate receipt data
                    document.getElementById('receiptNumber').textContent = transaction.id.toString().padStart(6, '0');
                    document.getElementById('receiptDate').textContent = transaction.date;
                    document.getElementById('receiptTime').textContent = transaction.time;
                    
                    const receiptItems = document.getElementById('receiptItems');
                    receiptItems.innerHTML = '';
                    
                    transaction.items.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.name}</td>
                            <td style="text-align: right;">${item.quantity}</td>
                            <td style="text-align: right;">$${item.price.toFixed(2)}</td>
                            <td style="text-align: right;">$${item.total.toFixed(2)}</td>
                        `;
                        receiptItems.appendChild(row);
                    });
                    
                    document.getElementById('receiptSubtotal').textContent = `$${transaction.subtotal.toFixed(2)}`;
                    document.getElementById('receiptTax').textContent = `$${transaction.tax.toFixed(2)}`;
                    document.getElementById('receiptDiscount').textContent = `$${transaction.discount.toFixed(2)}`;
                    document.getElementById('receiptTotal').textContent = `$${transaction.total.toFixed(2)}`;
                }
                
                modal.classList.add('active');
            }

            printReceipt() {
                window.print();
            }
        }

        // ====== MODULE: BARCODE SCANNER ======
        class ScannerModule {
            constructor() {
                this.scanner = null;
                this.isScanning = false;
            }

            bindEvents(app) {
                document.getElementById('startScannerBtn').addEventListener('click', () => {
                    this.startScanner();
                });
                
                document.getElementById('stopScannerBtn').addEventListener('click', () => {
                    this.stopScanner();
                });
                
                document.getElementById('closeScannerBtn').addEventListener('click', () => {
                    this.stopScanner();
                    document.getElementById('scannerModal').classList.remove('active');
                });
            }

            startScanner() {
                if (this.isScanning) return;
                
                const modal = document.getElementById('scannerModal');
                const scannerFrame = document.getElementById('scannerModalFrame');
                
                modal.classList.add('active');
                
                // Initialize scanner
                this.scanner = new Html5Qrcode("scannerModalFrame");
                
                const config = {
                    fps: 10,
                    qrbox: { width: 250, height: 250 },
                    rememberLastUsedCamera: true
                };
                
                this.scanner.start(
                    { facingMode: "environment" },
                    config,
                    this.onScanSuccess.bind(this),
                    this.onScanError.bind(this)
                ).then(() => {
                    this.isScanning = true;
                }).catch(err => {
                    console.error("Scanner error:", err);
                    window.app.showAlert('Failed to start scanner: ' + err, 'danger');
                });
            }

            stopScanner() {
                if (this.scanner && this.isScanning) {
                    this.scanner.stop().then(() => {
                        this.isScanning = false;
                        this.scanner = null;
                    }).catch(err => {
                        console.error("Failed to stop scanner:", err);
                    });
                }
            }

            onScanSuccess(decodedText, decodedResult) {
                // Stop scanner after successful scan
                this.stopScanner();
                
                // Find product by barcode
                const product = window.app.modules.inventory.getProductByBarcode(decodedText);
                
                if (product) {
                    // Display product info
                    const productInfo = document.getElementById('scannedProductInfo');
                    productInfo.innerHTML = `
                        <div class="grid grid-2">
                            <div>
                                <h4>${product.name}</h4>
                                <div class="text-muted">SKU: ${product.sku}</div>
                                <div class="text-muted">Category: ${product.category}</div>
                            </div>
                            <div style="text-align: right;">
                                <div class="product-price">$${product.retailPrice.toFixed(2)}</div>
                                <div class="${product.stockQuantity < 10 ? 'text-warning' : ''}">
                                    Stock: ${product.stockQuantity}
                                </div>
                            </div>
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-primary add-to-cart-scanned" data-id="${product.id}">
                                Add to Cart
                            </button>
                        </div>
                    `;
                    
                    // Add event listener to add to cart button
                    productInfo.querySelector('.add-to-cart-scanned').addEventListener('click', () => {
                        window.app.modules.pos.addToCart(product.id, 1);
                        window.app.switchView('pos');
                        document.getElementById('scannerModal').classList.remove('active');
                    });
                    
                    window.app.showAlert(`Product scanned: ${product.name}`, 'success');
                } else {
                    window.app.showAlert('Product not found for barcode: ' + decodedText, 'warning');
                }
                
                // Close scanner modal after a short delay
                setTimeout(() => {
                    document.getElementById('scannerModal').classList.remove('active');
                }, 3000);
            }

            onScanError(error) {
                // Handle scan errors silently
                console.debug("Scan error:", error);
            }
        }

        // ====== MODULE: ACCOUNTING & REPORTS ======
        class AccountingModule {
            constructor() {
                this.transactions = JSON.parse(localStorage.getItem('fawateer_transactions')) || [];
                this.expenses = JSON.parse(localStorage.getItem('fawateer_expenses')) || [];
                this.nextTransactionId = this.transactions.length > 0 ? Math.max(...this.transactions.map(t => t.id)) + 1 : 1;
                this.nextExpenseId = this.expenses.length > 0 ? Math.max(...this.expenses.map(e => e.id)) + 1 : 1;
            }

            bindEvents(app) {
                document.getElementById('addExpenseBtn').addEventListener('click', () => {
                    this.openExpenseModal();
                });
                
                document.getElementById('generateReportBtn').addEventListener('click', () => {
                    this.generateReport();
                });
                
                document.getElementById('refreshExpenses').addEventListener('click', () => {
                    this.renderExpenses();
                });
                
                document.getElementById('salesPeriod').addEventListener('change', () => {
                    this.renderDailySales();
                });
                
                document.getElementById('closeExpenseModal').addEventListener('click', () => {
                    document.getElementById('expenseModal').classList.remove('active');
                });
                
                document.getElementById('expenseForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveExpense();
                });
                
                document.getElementById('refreshTransactions').addEventListener('click', () => {
                    app.updateDashboard();
                });
            }

            getTransactions() {
                return this.transactions;
            }

            addTransaction(transaction) {
                const newTransaction = {
                    id: this.nextTransactionId++,
                    ...transaction
                };
                
                this.transactions.push(newTransaction);
                this.saveTransactions();
                return newTransaction;
            }

            getExpenses() {
                return this.expenses;
            }

            addExpense(expenseData) {
                const newExpense = {
                    id: this.nextExpenseId++,
                    ...expenseData
                };
                
                this.expenses.push(newExpense);
                this.saveExpenses();
                return newExpense;
            }

            getMonthlyExpenses() {
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                return this.expenses.reduce((sum, expense) => {
                    const expenseDate = new Date(expense.date);
                    if (expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear) {
                        return sum + expense.amount;
                    }
                    return sum;
                }, 0);
            }

            saveTransactions() {
                localStorage.setItem('fawateer_transactions', JSON.stringify(this.transactions));
            }

            saveExpenses() {
                localStorage.setItem('fawateer_expenses', JSON.stringify(this.expenses));
            }

            openExpenseModal() {
                document.getElementById('expenseModal').classList.add('active');
                document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            }

            saveExpense() {
                const expenseData = {
                    date: document.getElementById('expenseDate').value,
                    category: document.getElementById('expenseCategory').value,
                    description: document.getElementById('expenseDescription').value,
                    amount: parseFloat(document.getElementById('expenseAmount').value)
                };
                
                this.addExpense(expenseData);
                document.getElementById('expenseModal').classList.remove('active');
                document.getElementById('expenseForm').reset();
                
                window.app.showAlert('Expense added successfully!', 'success');
                this.renderExpenses();
                this.updateCharts();
            }

            renderExpenses() {
                const tableBody = document.getElementById('expensesTable');
                const recentExpenses = [...this.expenses].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);
                
                tableBody.innerHTML = '';
                
                if (recentExpenses.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center">No expenses recorded</td>
                        </tr>
                    `;
                    return;
                }
                
                recentExpenses.forEach(expense => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${expense.date}</td>
                        <td><span class="badge">${expense.category}</span></td>
                        <td>${expense.description}</td>
                        <td>$${expense.amount.toFixed(2)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            renderDailySales() {
                const tableBody = document.getElementById('dailySalesTable');
                const days = parseInt(document.getElementById('salesPeriod').value);
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - days);
                
                // Group transactions by date
                const dailySales = {};
                
                this.transactions.forEach(transaction => {
                    const transactionDate = new Date(transaction.date);
                    if (transactionDate >= startDate && transactionDate <= endDate) {
                        const dateStr = transaction.date;
                        if (!dailySales[dateStr]) {
                            dailySales[dateStr] = {
                                sales: 0,
                                transactions: 0,
                                total: 0
                            };
                        }
                        
                        dailySales[dateStr].sales += transaction.total;
                        dailySales[dateStr].transactions += 1;
                        dailySales[dateStr].total += transaction.total;
                    }
                });
                
                // Convert to array and sort by date
                const dailySalesArray = Object.entries(dailySales).map(([date, data]) => ({
                    date,
                    ...data
                })).sort((a, b) => new Date(b.date) - new Date(a.date));
                
                tableBody.innerHTML = '';
                
                if (dailySalesArray.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center">No sales data for selected period</td>
                        </tr>
                    `;
                    return;
                }
                
                dailySalesArray.forEach(day => {
                    const avgSale = day.transactions > 0 ? day.sales / day.transactions : 0;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${day.date}</td>
                        <td>$${day.sales.toFixed(2)}</td>
                        <td>${day.transactions}</td>
                        <td>$${avgSale.toFixed(2)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            updateCharts() {
                // Update income vs expense chart
                this.updateIncomeExpenseChart();
                
                // Update profit chart
                this.updateProfitChart();
            }

            updateIncomeExpenseChart() {
                const ctx = document.getElementById('incomeExpenseChart').getContext('2d');
                
                // Get last 6 months data
                const months = [];
                const incomeData = [];
                const expenseData = [];
                
                const currentDate = new Date();
                for (let i = 5; i >= 0; i--) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                    const monthName = date.toLocaleDateString('en-US', { month: 'short' });
                    months.push(monthName);
                    
                    // Calculate income for month
                    const monthIncome = this.transactions
                        .filter(t => {
                            const transactionDate = new Date(t.date);
                            return transactionDate.getMonth() === date.getMonth() && 
                                   transactionDate.getFullYear() === date.getFullYear();
                        })
                        .reduce((sum, t) => sum + t.total, 0);
                    
                    incomeData.push(monthIncome);
                    
                    // Calculate expenses for month
                    const monthExpenses = this.expenses
                        .filter(e => {
                            const expenseDate = new Date(e.date);
                            return expenseDate.getMonth() === date.getMonth() && 
                                   expenseDate.getFullYear() === date.getFullYear();
                        })
                        .reduce((sum, e) => sum + e.amount, 0);
                    
                    expenseData.push(monthExpenses);
                }
                
                // Destroy existing chart if it exists
                if (window.incomeExpenseChart) {
                    window.incomeExpenseChart.destroy();
                }
                
                window.incomeExpenseChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Income',
                                data: incomeData,
                                backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                borderColor: 'rgb(16, 185, 129)',
                                borderWidth: 1
                            },
                            {
                                label: 'Expenses',
                                data: expenseData,
                                backgroundColor: 'rgba(239, 68, 68, 0.5)',
                                borderColor: 'rgb(239, 68, 68)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'rgb(248, 250, 252)'
                                }
                            }
                        }
                    }
                });
            }

            updateProfitChart() {
                const ctx = document.getElementById('profitChart').getContext('2d');
                
                // Get last 12 months profit data
                const months = [];
                const profitData = [];
                
                const currentDate = new Date();
                for (let i = 11; i >= 0; i--) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                    const monthName = date.toLocaleDateString('en-US', { month: 'short' });
                    months.push(monthName);
                    
                    // Calculate income for month
                    const monthIncome = this.transactions
                        .filter(t => {
                            const transactionDate = new Date(t.date);
                            return transactionDate.getMonth() === date.getMonth() && 
                                   transactionDate.getFullYear() === date.getFullYear();
                        })
                        .reduce((sum, t) => sum + t.total, 0);
                    
                    // Calculate expenses for month
                    const monthExpenses = this.expenses
                        .filter(e => {
                            const expenseDate = new Date(e.date);
                            return expenseDate.getMonth() === date.getMonth() && 
                                   expenseDate.getFullYear() === date.getFullYear();
                        })
                        .reduce((sum, e) => sum + e.amount, 0);
                    
                    profitData.push(monthIncome - monthExpenses);
                }
                
                // Destroy existing chart if it exists
                if (window.profitChart) {
                    window.profitChart.destroy();
                }
                
                window.profitChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Monthly Profit',
                            data: profitData,
                            backgroundColor: 'rgba(124, 58, 237, 0.1)',
                            borderColor: 'rgb(124, 58, 237)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    },
                                    color: 'rgb(203, 213, 225)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: 'rgb(203, 213, 225)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'rgb(248, 250, 252)'
                                }
                            }
                        }
                    }
                });
            }

            generateReport() {
                const reportDate = new Date().toISOString().split('T')[0];
                const reportData = {
                    generatedAt: new Date().toISOString(),
                    period: 'All Time',
                    summary: {
                        totalTransactions: this.transactions.length,
                        totalRevenue: this.transactions.reduce((sum, t) => sum + t.total, 0),
                        totalExpenses: this.expenses.reduce((sum, e) => sum + e.amount, 0),
                        netProfit: this.transactions.reduce((sum, t) => sum + t.total, 0) - this.expenses.reduce((sum, e) => sum + e.amount, 0)
                    },
                    transactions: this.transactions.slice(-50), // Last 50 transactions
                    expenses: this.expenses.slice(-50) // Last 50 expenses
                };
                
                const data = JSON.stringify(reportData, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fawateer-report-${reportDate}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                window.app.showAlert('Report generated successfully!', 'success');
            }

            loadDemoTransactions() {
                const demoTransactions = [
                    {
                        id: 1,
                        date: new Date().toISOString().split('T')[0],
                        time: '10:30 AM',
                        items: [
                            { productId: 1, name: "Premium Coffee 500g", price: 12.99, quantity: 2, total: 25.98 },
                            { productId: 5, name: "Organic Olive Oil", price: 14.50, quantity: 1, total: 14.50 }
                        ],
                        subtotal: 40.48,
                        tax: 4.05,
                        discount: 0,
                        total: 44.53,
                        paymentMethod: 'cash',
                        status: 'completed'
                    },
                    {
                        id: 2,
                        date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                        time: '2:15 PM',
                        items: [
                            { productId: 2, name: "Hammer", price: 9.99, quantity: 1, total: 9.99 },
                            { productId: 6, name: "Screwdriver Set", price: 19.99, quantity: 1, total: 19.99 },
                            { productId: 8, name: "Extension Cord", price: 15.99, quantity: 2, total: 31.98 }
                        ],
                        subtotal: 61.96,
                        tax: 6.20,
                        discount: 3.10,
                        total: 65.06,
                        paymentMethod: 'card',
                        status: 'completed'
                    }
                ];
                
                this.transactions = demoTransactions;
                this.nextTransactionId = demoTransactions.length + 1;
                this.saveTransactions();
            }

            loadDemoExpenses() {
                const demoExpenses = [
                    {
                        id: 1,
                        date: new Date().toISOString().split('T')[0],
                        category: 'rent',
                        description: 'Monthly store rent',
                        amount: 2500
                    },
                    {
                        id: 2,
                        date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                        category: 'salary',
                        description: 'Employee salaries',
                        amount: 3200
                    },
                    {
                        id: 3,
                        date: new Date(Date.now() - 2 * 86400000).toISOString().split('T')[0],
                        category: 'utilities',
                        description: 'Electricity bill',
                        amount: 450
                    }
                ];
                
                this.expenses = demoExpenses;
                this.nextExpenseId = demoExpenses.length + 1;
                this.saveExpenses();
            }
        }

        // ====== MODULE: CUSTOMER RELATIONSHIP MANAGEMENT ======
        class CRMModule {
            constructor() {
                this.customers = JSON.parse(localStorage.getItem('fawateer_customers')) || [];
                this.creditTransactions = JSON.parse(localStorage.getItem('fawateer_credit_transactions')) || [];
                this.nextCustomerId = this.customers.length > 0 ? Math.max(...this.customers.map(c => c.id)) + 1 : 1;
                this.nextCreditTransactionId = this.creditTransactions.length > 0 ? Math.max(...this.creditTransactions.map(ct => ct.id)) + 1 : 1;
            }

            bindEvents(app) {
                document.getElementById('addCustomerBtn').addEventListener('click', () => {
                    this.openCustomerModal();
                });
                
                document.getElementById('addPaymentBtn').addEventListener('click', () => {
                    this.openPaymentModal();
                });
                
                document.getElementById('closeCustomerModal').addEventListener('click', () => {
                    document.getElementById('customerModal').classList.remove('active');
                });
                
                document.getElementById('closePaymentModal').addEventListener('click', () => {
                    document.getElementById('paymentModal').classList.remove('active');
                });
                
                document.getElementById('customerForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveCustomer();
                });
                
                document.getElementById('paymentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.savePayment();
                });
            }

            getCustomers() {
                return this.customers;
            }

            getCustomerById(id) {
                return this.customers.find(c => c.id == id);
            }

            addCustomer(customerData) {
                const newCustomer = {
                    id: this.nextCustomerId++,
                    ...customerData,
                    creditBalance: 0,
                    totalPurchases: 0,
                    lastPurchaseDate: null,
                    createdAt: new Date().toISOString()
                };
                
                this.customers.push(newCustomer);
                this.saveCustomers();
                return newCustomer;
            }

            updateCustomer(id, customerData) {
                const index = this.customers.findIndex(c => c.id == id);
                if (index !== -1) {
                    this.customers[index] = {
                        ...this.customers[index],
                        ...customerData,
                        updatedAt: new Date().toISOString()
                    };
                    this.saveCustomers();
                    return true;
                }
                return false;
            }

            addCreditTransaction(transactionData) {
                const newTransaction = {
                    id: this.nextCreditTransactionId++,
                    ...transactionData
                };
                
                this.creditTransactions.push(newTransaction);
                
                // Update customer balance if needed
                if (transactionData.type === 'credit_sale' || transactionData.type === 'payment') {
                    const customer = this.getCustomerById(transactionData.customerId);
                    if (customer) {
                        if (transactionData.type === 'credit_sale') {
                            customer.creditBalance += transactionData.amount;
                            customer.totalPurchases += transactionData.amount;
                        } else if (transactionData.type === 'payment') {
                            customer.creditBalance -= transactionData.amount;
                        }
                        
                        customer.lastPurchaseDate = new Date().toISOString().split('T')[0];
                        this.saveCustomers();
                    }
                }
                
                this.saveCreditTransactions();
                return newTransaction;
            }

            saveCustomers() {
                localStorage.setItem('fawateer_customers', JSON.stringify(this.customers));
            }

            saveCreditTransactions() {
                localStorage.setItem('fawateer_credit_transactions', JSON.stringify(this.creditTransactions));
            }

            openCustomerModal(customerId = null) {
                const modal = document.getElementById('customerModal');
                const title = document.getElementById('customerModalTitle');
                const form = document.getElementById('customerForm');
                
                if (customerId) {
                    // Edit mode
                    title.textContent = 'Edit Customer';
                    const customer = this.getCustomerById(customerId);
                    if (customer) {
                        document.getElementById('customerName').value = customer.name;
                        document.getElementById('customerPhone').value = customer.phone;
                        document.getElementById('customerEmail').value = customer.email || '';
                        document.getElementById('customerAddress').value = customer.address || '';
                        document.getElementById('customerCreditLimit').value = customer.creditLimit || 1000;
                        document.getElementById('customerDiscount').value = customer.discount || 0;
                        
                        form.dataset.editId = customerId;
                    }
                } else {
                    // Add mode
                    title.textContent = 'Add New Customer';
                    form.reset();
                    delete form.dataset.editId;
                }
                
                modal.classList.add('active');
            }

            saveCustomer() {
                const form = document.getElementById('customerForm');
                const customerData = {
                    name: document.getElementById('customerName').value,
                    phone: document.getElementById('customerPhone').value,
                    email: document.getElementById('customerEmail').value,
                    address: document.getElementById('customerAddress').value,
                    creditLimit: parseFloat(document.getElementById('customerCreditLimit').value),
                    discount: parseFloat(document.getElementById('customerDiscount').value)
                };
                
                if (form.dataset.editId) {
                    // Update existing customer
                    this.updateCustomer(form.dataset.editId, customerData);
                    window.app.showAlert('Customer updated successfully!', 'success');
                } else {
                    // Add new customer
                    this.addCustomer(customerData);
                    window.app.showAlert('Customer added successfully!', 'success');
                }
                
                document.getElementById('customerModal').classList.remove('active');
                this.renderCustomers();
                
                // Update customer select in POS
                this.updateCustomerSelect();
            }

            openPaymentModal() {
                const modal = document.getElementById('paymentModal');
                const customerSelect = document.getElementById('paymentCustomer');
                
                // Populate customer dropdown
                customerSelect.innerHTML = '<option value="">Select Customer</option>';
                this.customers.forEach(customer => {
                    if (customer.creditBalance > 0) {
                        const option = document.createElement('option');
                        option.value = customer.id;
                        option.textContent = `${customer.name} (Balance: $${customer.creditBalance.toFixed(2)})`;
                        customerSelect.appendChild(option);
                    }
                });
                
                document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
                modal.classList.add('active');
            }

            savePayment() {
                const customerId = parseInt(document.getElementById('paymentCustomer').value);
                const amount = parseFloat(document.getElementById('paymentAmount').value);
                const date = document.getElementById('paymentDate').value;
                const method = document.getElementById('paymentMethod').value;
                const notes = document.getElementById('paymentNotes').value;
                
                if (!customerId || amount <= 0) {
                    window.app.showAlert('Please select a customer and enter a valid amount', 'danger');
                    return;
                }
                
                const customer = this.getCustomerById(customerId);
                if (!customer) {
                    window.app.showAlert('Customer not found', 'danger');
                    return;
                }
                
                if (amount > customer.creditBalance) {
                    window.app.showAlert(`Payment amount cannot exceed credit balance ($${customer.creditBalance.toFixed(2)})`, 'danger');
                    return;
                }
                
                const paymentData = {
                    customerId,
                    customerName: customer.name,
                    type: 'payment',
                    amount,
                    date,
                    method,
                    notes,
                    previousBalance: customer.creditBalance,
                    newBalance: customer.creditBalance - amount
                };
                
                this.addCreditTransaction(paymentData);
                
                document.getElementById('paymentModal').classList.remove('active');
                document.getElementById('paymentForm').reset();
                
                window.app.showAlert('Payment recorded successfully!', 'success');
                this.renderCustomers();
                this.renderCreditTransactions();
            }

            renderCustomers() {
                const tableBody = document.getElementById('customerTable');
                
                tableBody.innerHTML = '';
                
                if (this.customers.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">No customers found</td>
                        </tr>
                    `;
                    return;
                }
                
                this.customers.forEach(customer => {
                    const row = document.createElement('tr');
                    row.className = 'customer-row';
                    row.dataset.id = customer.id;
                    
                    row.innerHTML = `
                        <td>${customer.name}</td>
                        <td>${customer.phone}</td>
                        <td>$${customer.totalPurchases.toFixed(2)}</td>
                        <td class="${customer.creditBalance > 0 ? 'text-warning' : ''}">
                            $${customer.creditBalance.toFixed(2)}
                        </td>
                        <td>${customer.lastPurchaseDate || 'Never'}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add click event to customer rows
                tableBody.querySelectorAll('.customer-row').forEach(row => {
                    row.addEventListener('click', (e) => {
                        const customerId = row.dataset.id;
                        this.showCustomerDetails(customerId);
                    });
                });
            }

            renderCreditTransactions() {
                const tableBody = document.getElementById('creditTransactionsTable');
                const recentTransactions = [...this.creditTransactions]
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 10);
                
                tableBody.innerHTML = '';
                
                if (recentTransactions.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">No credit transactions</td>
                        </tr>
                    `;
                    return;
                }
                
                recentTransactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    const typeClass = transaction.type === 'payment' ? 'text-success' : 'text-warning';
                    const typeText = transaction.type === 'payment' ? 'Payment' : 'Credit Sale';
                    
                    row.innerHTML = `
                        <td>${transaction.date}</td>
                        <td>${transaction.customerName}</td>
                        <td class="${typeClass}">${typeText}</td>
                        <td>$${transaction.amount.toFixed(2)}</td>
                        <td>$${transaction.newBalance ? transaction.newBalance.toFixed(2) : transaction.previousBalance.toFixed(2)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            showCustomerDetails(customerId) {
                const customer = this.getCustomerById(customerId);
                if (!customer) return;
                
                const detailsContainer = document.getElementById('customerDetails');
                
                detailsContainer.innerHTML = `
                    <div class="grid grid-2">
                        <div>
                            <h4>${customer.name}</h4>
                            <div class="text-muted">${customer.phone}</div>
                            ${customer.email ? `<div class="text-muted">${customer.email}</div>` : ''}
                            ${customer.address ? `<div class="text-muted mt-1">${customer.address}</div>` : ''}
                        </div>
                        <div>
                            <div class="glass-card p-2 mb-2">
                                <div class="text-muted">Credit Limit</div>
                                <div class="kpi-value">$${customer.creditLimit.toFixed(2)}</div>
                            </div>
                            <div class="glass-card p-2">
                                <div class="text-muted">Discount</div>
                                <div class="kpi-value">${customer.discount}%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-2 mt-3">
                        <div class="glass-card p-2">
                            <div class="text-muted">Total Purchases</div>
                            <div class="kpi-value">$${customer.totalPurchases.toFixed(2)}</div>
                        </div>
                        <div class="glass-card p-2">
                            <div class="text-muted">Current Balance</div>
                            <div class="kpi-value ${customer.creditBalance > 0 ? 'text-warning' : ''}">
                                $${customer.creditBalance.toFixed(2)}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button class="btn btn-primary edit-customer-btn" data-id="${customer.id}">
                            Edit Customer
                        </button>
                        <button class="btn btn-success add-payment-btn" data-id="${customer.id}" ${customer.creditBalance <= 0 ? 'disabled' : ''}>
                            Add Payment
                        </button>
                    </div>
                `;
                
                // Add event listeners to buttons
                detailsContainer.querySelector('.edit-customer-btn').addEventListener('click', () => {
                    this.openCustomerModal(customerId);
                });
                
                detailsContainer.querySelector('.add-payment-btn').addEventListener('click', () => {
                    if (customer.creditBalance > 0) {
                        this.openPaymentModal();
                        document.getElementById('paymentCustomer').value = customerId;
                    }
                });
            }

            updateCustomerSelect() {
                const customerSelect = document.getElementById('customerSelect');
                if (!customerSelect) return;
                
                customerSelect.innerHTML = '<option value="cash">Cash Customer</option>';
                this.customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = customer.name;
                    customerSelect.appendChild(option);
                });
            }

            loadDemoCustomers() {
                const demoCustomers = [
                    {
                        id: 1,
                        name: "John Smith",
                        phone: "+1 (555) 123-4567",
                        email: "john.smith@example.com",
                        address: "123 Main St, New York, NY",
                        creditLimit: 5000,
                        discount: 5,
                        creditBalance: 1250.75,
                        totalPurchases: 8750.25,
                        lastPurchaseDate: new Date().toISOString().split('T')[0],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: "Sarah Johnson",
                        phone: "+1 (555) 987-6543",
                        email: "sarah.j@example.com",
                        address: "456 Oak Ave, Los Angeles, CA",
                        creditLimit: 3000,
                        discount: 2.5,
                        creditBalance: 0,
                        totalPurchases: 4200.50,
                        lastPurchaseDate: new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        name: "Mike Wilson",
                        phone: "+1 (555) 456-7890",
                        email: "mike.wilson@example.com",
                        address: "789 Pine Rd, Chicago, IL",
                        creditLimit: 10000,
                        discount: 10,
                        creditBalance: 3200.25,
                        totalPurchases: 15200.75,
                        lastPurchaseDate: new Date(Date.now() - 2 * 86400000).toISOString().split('T')[0],
                        createdAt: new Date().toISOString()
                    }
                ];
                
                this.customers = demoCustomers;
                this.nextCustomerId = demoCustomers.length + 1;
                this.saveCustomers();
                
                // Add demo credit transactions
                const demoCreditTransactions = [
                    {
                        id: 1,
                        customerId: 1,
                        customerName: "John Smith",
                        type: "credit_sale",
                        amount: 1250.75,
                        date: new Date().toISOString().split('T')[0],
                        description: "Monthly hardware supplies",
                        previousBalance: 0,
                        newBalance: 1250.75
                    },
                    {
                        id: 2,
                        customerId: 3,
                        customerName: "Mike Wilson",
                        type: "credit_sale",
                        amount: 3200.25,
                        date: new Date(Date.now() - 2 * 86400000).toISOString().split('T')[0],
                        description: "Electrical equipment",
                        previousBalance: 0,
                        newBalance: 3200.25
                    }
                ];
                
                this.creditTransactions = demoCreditTransactions;
                this.nextCreditTransactionId = demoCreditTransactions.length + 1;
                this.saveCreditTransactions();
            }
        }

        // ====== MODULE: DATABASE MANAGEMENT ======
        class DatabaseModule {
            constructor() {
                this.storageKeys = [
                    'fawateer_users',
                    'fawateer_inventory',
                    'fawateer_transactions',
                    'fawateer_expenses',
                    'fawateer_customers',
                    'fawateer_credit_transactions',
                    'fawateer_receipt_counter'
                ];
            }

            bindEvents(app) {
                document.getElementById('exportJSONBtn').addEventListener('click', () => {
                    this.exportAllData('json');
                });
                
                document.getElementById('exportCSVBtn').addEventListener('click', () => {
                    this.exportAllData('csv');
                });
                
                document.getElementById('importDataBtn').addEventListener('click', () => {
                    this.importData();
                });
                
                document.getElementById('backupNowBtn').addEventListener('click', () => {
                    this.createBackup();
                });
                
                document.getElementById('clearAllDataBtn').addEventListener('click', () => {
                    this.clearAllData();
                });
                
                document.getElementById('restoreDefaultsBtn').addEventListener('click', () => {
                    this.restoreDefaultData();
                });
            }

            exportAllData(format = 'json') {
                const data = {};
                
                this.storageKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    if (value) {
                        data[key] = JSON.parse(value);
                    }
                });
                
                let blob, filename;
                
                if (format === 'json') {
                    const jsonData = JSON.stringify(data, null, 2);
                    blob = new Blob([jsonData], { type: 'application/json' });
                    filename = `fawateer-backup-${new Date().toISOString().split('T')[0]}.json`;
                } else {
                    // For simplicity, we'll export inventory as CSV
                    const inventory = JSON.parse(localStorage.getItem('fawateer_inventory') || '[]');
                    const csvRows = [];
                    
                    // Headers
                    csvRows.push(['SKU', 'Name', 'Category', 'Wholesale Price', 'Retail Price', 'Stock', 'Expiry Date', 'Barcode'].join(','));
                    
                    // Data rows
                    inventory.forEach(item => {
                        csvRows.push([
                            item.sku,
                            `"${item.name}"`,
                            item.category,
                            item.wholesalePrice,
                            item.retailPrice,
                            item.stockQuantity,
                            item.expiryDate || '',
                            item.barcode || ''
                        ].join(','));
                    });
                    
                    const csvData = csvRows.join('\n');
                    blob = new Blob([csvData], { type: 'text/csv' });
                    filename = `fawateer-inventory-${new Date().toISOString().split('T')[0]}.csv`;
                }
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                window.app.showAlert(`Data exported successfully as ${format.toUpperCase()}!`, 'success');
            }

            importData() {
                const fileInput = document.getElementById('importFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    window.app.showAlert('Please select a file to import', 'warning');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const content = e.target.result;
                        let data;
                        
                        if (file.name.endsWith('.json')) {
                            data = JSON.parse(content);
                            
                            // Validate data structure
                            if (typeof data !== 'object') {
                                throw new Error('Invalid JSON format');
                            }
                            
                            // Import each key
                            Object.keys(data).forEach(key => {
                                if (this.storageKeys.includes(key)) {
                                    localStorage.setItem(key, JSON.stringify(data[key]));
                                }
                            });
                            
                            window.app.showAlert('Data imported successfully! Please refresh the page.', 'success');
                            
                        } else if (file.name.endsWith('.csv')) {
                            // For simplicity, we'll just show a message for CSV import
                            window.app.showAlert('CSV import requires specific formatting. Please use JSON for full data import.', 'info');
                        } else {
                            throw new Error('Unsupported file format');
                        }
                    } catch (error) {
                        window.app.showAlert(`Import failed: ${error.message}`, 'danger');
                    }
                };
                
                reader.readAsText(file);
                fileInput.value = '';
            }

            createBackup() {
                this.exportAllData('json');
            }

            clearAllData() {
                if (confirm('WARNING: This will delete ALL data including inventory, customers, and transactions. This action cannot be undone. Are you sure?')) {
                    this.storageKeys.forEach(key => {
                        localStorage.removeItem(key);
                    });
                    
                    // Reset receipt counter
                    localStorage.setItem('fawateer_receipt_counter', '1');
                    
                    window.app.showAlert('All data has been cleared. Refreshing application...', 'warning');
                    
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
            }

            restoreDefaultData() {
                if (confirm('This will restore demo data. Your current data will be replaced. Continue?')) {
                    // Clear existing data
                    this.storageKeys.forEach(key => {
                        localStorage.removeItem(key);
                    });
                    
                    // Reload page to trigger demo data creation
                    window.app.showAlert('Restoring default data...', 'info');
                    
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                }
            }

            updateStats() {
                const inventory = JSON.parse(localStorage.getItem('fawateer_inventory') || '[]');
                const customers = JSON.parse(localStorage.getItem('fawateer_customers') || '[]');
                const transactions = JSON.parse(localStorage.getItem('fawateer_transactions') || '[]');
                
                // Calculate total storage size
                let totalSize = 0;
                this.storageKeys.forEach(key => {
                    const item = localStorage.getItem(key);
                    if (item) {
                        totalSize += item.length * 2; // Approximate size in bytes (2 bytes per char for UTF-16)
                    }
                });
                
                document.getElementById('totalProducts').textContent = inventory.length;
                document.getElementById('totalCustomers').textContent = customers.length;
                document.getElementById('totalTransactions').textContent = transactions.length;
                document.getElementById('dbSize').textContent = `${(totalSize / 1024).toFixed(2)} KB`;
            }
        }

        // ====== MODULE: USER INTERFACE ======
        class UIModule {
            bindEvents(app) {
                // Close modals when clicking outside
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('active');
                        }
                    });
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Ctrl+F to focus search
                    if ((e.ctrlKey || e.metaKey) && e.key === 'f' && app.currentView === 'inventory') {
                        e.preventDefault();
                        document.getElementById('searchInventory').focus();
                    }
                    
                    // Ctrl+P to print receipt
                    if ((e.ctrlKey || e.metaKey) && e.key === 'p' && app.currentView === 'pos') {
                        e.preventDefault();
                        app.modules.pos.printReceipt();
                    }
                    
                    // Escape to close modals
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal.active').forEach(modal => {
                            modal.classList.remove('active');
                        });
                    }
                });
            }

            renderRecentTransactions(transactions) {
                const tableBody = document.getElementById('recentTransactions');
                
                tableBody.innerHTML = '';
                
                if (transactions.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">No recent transactions</td>
                        </tr>
                    `;
                    return;
                }
                
                transactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    const statusClass = transaction.status === 'completed' ? 'text-success' : 'text-warning';
                    
                    row.innerHTML = `
                        <td>${transaction.id.toString().padStart(6, '0')}</td>
                        <td>${transaction.date}</td>
                        <td>${transaction.customer || 'Walk-in Customer'}</td>
                        <td>$${transaction.total.toFixed(2)}</td>
                        <td class="${statusClass}">${transaction.status}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            updateDashboardCharts(transactions, inventory) {
                // Sales Trend Chart
                this.updateSalesChart(transactions);
                
                // Top Products Chart
                this.updateTopProductsChart(inventory);
            }

            updateSalesChart(transactions) {
                const ctx = document.getElementById('salesChart').getContext('2d');
                
                // Get last 7 days of sales
                const dates = [];
                const salesData = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    dates.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                    
                    const daySales = transactions
                        .filter(t => t.date === dateStr)
                        .reduce((sum, t) => sum + t.total, 0);
                    
                    salesData.push(daySales);
                }
                
                // Destroy existing chart if it exists
                if (window.salesChart) {
                    window.salesChart.destroy();
                }
                
                window.salesChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Daily Sales',
                            data: salesData,
                            backgroundColor: 'rgba(6, 182, 212, 0.1)',
                            borderColor: 'rgb(6, 182, 212)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    },
                                    color: 'rgb(203, 213, 225)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: 'rgb(203, 213, 225)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'rgb(248, 250, 252)'
                                }
                            }
                        }
                    }
                });
            }

            updateTopProductsChart(inventory) {
                const ctx = document.getElementById('topProductsChart').getContext('2d');
                
                // Sort by stock quantity (for demo, in real app use sales data)
                const topProducts = [...inventory]
                    .sort((a, b) => b.stockQuantity - a.stockQuantity)
                    .slice(0, 5);
                
                const productNames = topProducts.map(p => p.name.length > 15 ? p.name.substring(0, 15) + '...' : p.name);
                const stockData = topProducts.map(p => p.stockQuantity);
                
                // Destroy existing chart if it exists
                if (window.topProductsChart) {
                    window.topProductsChart.destroy();
                }
                
                window.topProductsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: productNames,
                        datasets: [{
                            label: 'Stock Level',
                            data: stockData,
                            backgroundColor: [
                                'rgba(124, 58, 237, 0.5)',
                                'rgba(6, 182, 212, 0.5)',
                                'rgba(16, 185, 129, 0.5)',
                                'rgba(245, 158, 11, 0.5)',
                                'rgba(239, 68, 68, 0.5)'
                            ],
                            borderColor: [
                                'rgb(124, 58, 237)',
                                'rgb(6, 182, 212)',
                                'rgb(16, 185, 129)',
                                'rgb(245, 158, 11)',
                                'rgb(239, 68, 68)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: 'rgb(203, 213, 225)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: 'rgb(203, 213, 225)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'rgb(248, 250, 252)'
                                }
                            }
                        }
                    }
                });
            }
        }

        // ====== INITIALIZE APPLICATION ======
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new FawateerApp();
        });
    </script>
</body>
</html>
